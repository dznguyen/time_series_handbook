
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chapter 3: Vector Autoregressive Methods &#8212; Time Series Analysis Handbook</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Chapter 4: Granger Causality Test" href="../04_GrangerCausality/04_GrangerCausality.html" />
    <link rel="prev" title="Chapter 2: Linear, Trend, and Momentum Forecasting" href="../02_LinearForecastingTrendandMomentumForecasting/02_LinearTrendandMomentumForecasting.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  
  <h1 class="site-logo" id="site-title">Time Series Analysis Handbook</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../Preface/Preface.html">
   Preface: Introduction to Time Series Analysis
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../00_Introduction/00_Introduction.html">
   Chapter 0: Advanced Time Series Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../01_AutoRegressiveIntegratedMovingAverage/01_AutoRegressiveIntegratedMovingAverage.html">
   Chapter 1: AutoRegressive Integrated Moving Average (ARIMA)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../02_LinearForecastingTrendandMomentumForecasting/02_LinearTrendandMomentumForecasting.html">
   Chapter 2: Linear, Trend, and Momentum Forecasting
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Chapter 3: Vector Autoregressive Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../04_GrangerCausality/04_GrangerCausality.html">
   Chapter 4: Granger Causality Test
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../05_SimplexandSmapProjections/05_Empirical%20Dynamic%20Modelling%20%28Simplex%20and%20SMap_Projections%29.html">
   Chapter 5 : Dynamical Forecasting Methods (Simplex and SMap Projections)
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../06_ConvergentCrossMappingandSugiharaCausality/ccm_sugihara.html">
   Chapter 6: Convergent Cross Mapping
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../06_ConvergentCrossMappingandSugiharaCausality/using_causal_ccm_package.html">
     Applying CCM Using causal-ccm package
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../07_CrosscorrelationsFourierTransformandWaveletTransform/07_CrosscorrelationsFourierTransformandWaveletTransform.html">
   Chapter 7: Cross-Correlations, Fourier Transform, and Wavelet Transform
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../08_WinningestMethods/lightgbm_m5_forecasting.html">
   Chapter 8: Winningest Methods in Time Series Forecasting
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../08_WinningestMethods/lightgbm_m5_tuning.html">
     Hyperparameter Tuning (Supplementary Notebook)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08_WinningestMethods/lightgbm_jena_forecasting.html">
     Temperature Forecasting (Supplementary Notebook)
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/README.html">
   Datasets
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/03_VectorAutoregressiveModels/03_VectorAutoregressiveMethods.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/phdinds-aim/time_series_handbook"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/phdinds-aim/time_series_handbook/issues/new?title=Issue%20on%20page%20%2F03_VectorAutoregressiveModels/03_VectorAutoregressiveMethods.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/phdinds-aim/time_series_handbook/main?urlpath=tree/03_VectorAutoregressiveModels/03_VectorAutoregressiveMethods.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#multivariate-time-series-model">
   Multivariate Time Series Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#definition-univariate-vs-multivariate-time-series">
     Definition: Univariate vs Multivariate Time Series
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-1-multivariate-time-series">
     Example 1: Multivariate Time Series
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#a-air-quality-data-from-uci">
       A. Air Quality Data from UCI
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#b-global-health-from-the-world-bank">
       B. Global Health from The World Bank
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#c-us-treasury-rates">
       C. US Treasury Rates
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#d-jena-climate-data">
       D. Jena Climate Data
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#foundations">
     Foundations
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#weak-stationarity-of-multivariate-time-series">
       Weak Stationarity of Multivariate Time Series
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#obtaining-cross-correlation-matrix-from-cross-covariance-matrix">
       Obtaining Cross-Correlation Matrix from Cross-Covariance Matrix
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vector-autoregressive-var-models">
   Vector Autoregressive (VAR) Models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#var-1-model">
     VAR(1) Model
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#structural-and-reduced-forms-of-the-var-model">
       Structural and Reduced Forms of the VAR model
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#structural-var-var-in-primitive-form">
         Structural VAR (VAR in primitive form)
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#reduced-form-var-var-in-standard-form">
         Reduced-form VAR (VAR in standard form)
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#vma-infinite-representation-and-stationarity">
       VMA infinite representation and Stationarity
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stationarity-of-the-var-1-model">
       Stationarity of the VAR(1) model
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#var-p-model">
     VAR(p) Model
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#properties">
       Properties
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stationarity-of-var-p-model">
       Stationarity of VAR(p) model
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#specification-of-a-var-model-choosing-the-order-p">
     Specification of a VAR model: Choosing the order
     <em>
      p
     </em>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#building-a-var-model">
   Building a VAR model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-2-forecasting-air-quality-data-co-no2-and-rh">
     Example 2: Forecasting Air Quality Data (CO, NO2 and RH)
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#check-stationarity">
       1. Check stationarity
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#kwiatkowskiphillipsschmidtshin-kpss-test">
         Kwiatkowski–Phillips–Schmidt–Shin (KPSS) test
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#augmented-dickey-fuller-adf-test">
         Augmented Dickey-Fuller (ADF) test
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#split-data-into-train-and-test-sets">
       2. Split data into train and test sets
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#select-order-p">
       3. Select order
       <em>
        p
       </em>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#fit-var-model-with-chosen-order">
       3. Fit VAR model with chosen order
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#get-forecast">
       4. Get forecast
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#performance-evaluation-comparison-with-arima-model">
       Performance Evaluation: Comparison with ARIMA model
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#structural-var-analysis">
   Structural VAR Analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#impulse-response-function-irf">
     Impulse Response Function (IRF)
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#irf-in-the-var-system-for-air-quality">
       IRF in the VAR system for Air Quality
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#forecast-error-variance-decomposition-fevd">
     Forecast Error Variance Decomposition (FEVD)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-3-forecasting-the-jena-climate-data">
     Example 3: Forecasting the Jena climate data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#load-dataset">
       Load dataset
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#check-stationarity-of-each-variable-using-adf-test">
       Check stationarity of each variable using ADF test
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Select order p
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#train-var-model-using-the-training-and-validation-data">
       Train VAR model using the training and validation data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#forecast-24-hour-weather-measurements-and-evaluate-performance-on-test-set">
       Forecast 24-hour weather measurements and evaluate performance on test set
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#forecast-24-hours-beyond-test-set">
       Forecast 24 hours beyond test set
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preview-to-the-next-chapter">
   Preview to the Next Chapter
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="chapter-3-vector-autoregressive-methods">
<h1>Chapter 3: Vector Autoregressive Methods<a class="headerlink" href="#chapter-3-vector-autoregressive-methods" title="Permalink to this headline">¶</a></h1>
<p>Prepared by: Maria Eloisa Ventura</p>
<p>Previously, we have introduced the classical approaches in forecasting single/univariate time series like the
ARIMA (autoregressive integrated moving-average) model and the simple linear regression model. We learned that stationarity is a condition that is necessary when using ARIMA while this need not be imposed when using the linear regression model. In this notebook, we extend the forecasting problem to a more generalized framework where we deal with <strong>multivariate time series</strong>–time series which has more than one time-dependent variable. More specifically, we introduce <strong>vector autoregressive (VAR)</strong> models and show how they can be used in forecasting mutivariate time series.</p>
<div class="section" id="multivariate-time-series-model">
<h2>Multivariate Time Series Model<a class="headerlink" href="#multivariate-time-series-model" title="Permalink to this headline">¶</a></h2>
<p>As shown in the previous chapters, one of the main advantages of using simple univariate methods (e.g., ARIMA) is the ability to forecast future values of one variable by only using past values of itself. However, we know that most if not all of the variables that we observe are actually dependent on other variables. Most of the time, the information that we gather is limited by our capacity to measure the variables of interest. For example, if we want to study weather in a particular city, we could measure temperature, humidity and precipitation over time. But if we only have a thermometer, then we’ll only be able to collect data for temperature, effectively reducing our dataset to a univariate time series.</p>
<p>Now, in cases where we have multiple time series (longitudinal measurements of more than one variable), we can actually use multivariate time series models to understand the relationships of the different variables over time.
By utilizing the additional information available from related series, these models can often provide better forecasts than the univariate time series models.</p>
<p>In this section, we cover the foundational information needed to understand Vector Autoregressive Models, a class of multivariate time series models, by using a framework similar to univariate time series laid out in the previous chapters, and extending it to the multivariate case.</p>
<div class="section" id="definition-univariate-vs-multivariate-time-series">
<h3>Definition: Univariate vs Multivariate Time Series<a class="headerlink" href="#definition-univariate-vs-multivariate-time-series" title="Permalink to this headline">¶</a></h3>
<p>Time series can either be univariate or multivariate. The term <strong>univariate time series</strong> consists of single observations recorded sequentially over equal time increments. When dealing with a univariate time series model (e.g., ARIMA), we usually refer to a model that contains lag values of itself as the independent variable.</p>
<p>On the other hand, a <strong>multivariate time series</strong> has more than one time-dependent variable. For a multivariate process, several related time series are observed simultaneously over time. As an extension of the univariate case, the multivariate time series model involves two or more input variables, and leverages the interrelationship among the different time series variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">statsmodels.tsa</span> <span class="k">as</span> <span class="nn">tsa</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.vector_ar.var_model</span> <span class="kn">import</span> <span class="n">VAR</span><span class="p">,</span> <span class="n">FEVD</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima_model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">acf</span><span class="p">,</span> <span class="n">adfuller</span><span class="p">,</span> <span class="n">ccf</span><span class="p">,</span> <span class="n">ccovf</span><span class="p">,</span> <span class="n">kpss</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">mvts_utils</span> <span class="k">as</span> <span class="nn">utils</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="example-1-multivariate-time-series">
<h3>Example 1: Multivariate Time Series<a class="headerlink" href="#example-1-multivariate-time-series" title="Permalink to this headline">¶</a></h3>
<div class="section" id="a-air-quality-data-from-uci">
<h4>A. Air Quality Data from UCI<a class="headerlink" href="#a-air-quality-data-from-uci" title="Permalink to this headline">¶</a></h4>
<p>The dataset contains hourly averaged measurements obtained from an Air Quality Chemical Multisensor Device which was located on the field of a polluted area at an Italian city. The dataset can be downloaded <strong><a class="reference external" href="https://archive.ics.uci.edu/ml/datasets/Air+Quality">here</a></strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aq_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&quot;../data/AirQualityUCI/AirQualityUCI.xlsx&quot;</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">]])</span>\
            <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date_Time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">interpolate</span><span class="p">()</span>
<span class="n">aq_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CO(GT)</th>
      <th>PT08.S1(CO)</th>
      <th>NMHC(GT)</th>
      <th>C6H6(GT)</th>
      <th>PT08.S2(NMHC)</th>
      <th>NOx(GT)</th>
      <th>PT08.S3(NOx)</th>
      <th>NO2(GT)</th>
      <th>PT08.S4(NO2)</th>
      <th>PT08.S5(O3)</th>
      <th>T</th>
      <th>RH</th>
      <th>AH</th>
      <th>Unnamed: 15</th>
      <th>Unnamed: 16</th>
    </tr>
    <tr>
      <th>Date_Time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2004-03-10 00:00:00 18:00:00</th>
      <td>2.6</td>
      <td>1360.00</td>
      <td>150.0</td>
      <td>11.881723</td>
      <td>1045.50</td>
      <td>166.0</td>
      <td>1056.25</td>
      <td>113.0</td>
      <td>1692.00</td>
      <td>1267.50</td>
      <td>13.6</td>
      <td>48.875001</td>
      <td>0.757754</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2004-03-10 00:00:00 19:00:00</th>
      <td>2.0</td>
      <td>1292.25</td>
      <td>112.0</td>
      <td>9.397165</td>
      <td>954.75</td>
      <td>103.0</td>
      <td>1173.75</td>
      <td>92.0</td>
      <td>1558.75</td>
      <td>972.25</td>
      <td>13.3</td>
      <td>47.700000</td>
      <td>0.725487</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plot_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CO(GT)&#39;</span><span class="p">,</span> <span class="s1">&#39;NO2(GT)&#39;</span><span class="p">,</span> <span class="s1">&#39;C6H6(GT)&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;RH&#39;</span><span class="p">]</span>
<span class="n">aq_df</span><span class="p">[</span><span class="n">plot_cols</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">)):</span> 
    <span class="n">ax</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">plot_cols</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_VectorAutoregressiveMethods_10_0.png" src="../_images/03_VectorAutoregressiveMethods_10_0.png" />
</div>
</div>
</div>
<div class="section" id="b-global-health-from-the-world-bank">
<h4>B. Global Health from The World Bank<a class="headerlink" href="#b-global-health-from-the-world-bank" title="Permalink to this headline">¶</a></h4>
<p>This dataset combines key health statistics from a variety of sources to provide a look at global health and population trends. It includes information on nutrition, reproductive health, education, immunization, and diseases from over 200 countries. The dataset can be downloaded <strong><a class="reference external" href="https://console.cloud.google.com/marketplace/product/the-world-bank/global-health?filter=solution-type:dataset&amp;filter=category:health&amp;id=f3c38e10-2c45-43c8-8a12-8d749ba987ee">here</a></strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ind_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/WorldBankHealth/WorldBankHealthPopulation_SeriesSummary.csv&#39;</span><span class="p">)</span>\
            <span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;series_code&#39;</span><span class="p">,</span> <span class="s1">&#39;indicator_name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">()</span>\
            <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;indicator_name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;series_code&#39;</span><span class="p">)</span>
<span class="n">hn_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/WorldBankHealth/WorldBankHealthPopulation_HealthNutritionPopulation.csv&#39;</span><span class="p">)</span>\
            <span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;indicator_code&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>

<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SH.XPD.KHEX.GD.ZS&#39;</span><span class="p">,</span> <span class="s1">&#39;SH.XPD.CHEX.GD.ZS&#39;</span><span class="p">,</span> <span class="s1">&#39;SH.XPD.GHED.GD.ZS&#39;</span><span class="p">]</span>
<span class="n">health_expenditure_df</span> <span class="o">=</span> <span class="n">hn_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2018</span><span class="p">),</span> <span class="n">cols</span><span class="p">]</span>\
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">ind_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">indicator_name</span>\
                           <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))))</span>
<span class="n">health_expenditure_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2000-1-1&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">health_expenditure_df</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;A-DEC&quot;</span><span class="p">)</span>
<span class="n">health_expenditure_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>indicator_code</th>
      <th>Capital_health_expenditure</th>
      <th>Current_health_expenditure</th>
      <th>Domestic_general_government_health_expenditure</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-12-31</th>
      <td>0.013654</td>
      <td>3.154818</td>
      <td>1.400685</td>
    </tr>
    <tr>
      <th>2001-12-31</th>
      <td>0.012675</td>
      <td>2.947059</td>
      <td>1.196554</td>
    </tr>
    <tr>
      <th>2002-12-31</th>
      <td>0.018476</td>
      <td>2.733301</td>
      <td>1.012481</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">health_expenditure_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">y_label</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Capital health expenditure&#39;</span><span class="p">,</span> <span class="s1">&#39;Current health expenditure&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Domestic general government</span><span class="se">\n</span><span class="s1"> health expenditure&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">)):</span> 
    <span class="n">ax</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">y_label</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2"> (% of GDP)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_VectorAutoregressiveMethods_13_0.png" src="../_images/03_VectorAutoregressiveMethods_13_0.png" />
</div>
</div>
</div>
<div class="section" id="c-us-treasury-rates">
<h4>C. US Treasury Rates<a class="headerlink" href="#c-us-treasury-rates" title="Permalink to this headline">¶</a></h4>
<p>January, 1982 – December, 2016  (Weekly)
https://essentialoftimeseries.com/data/
This sample dataset contains weekly data of US Treasury rates from January 1982 to December 2016. The dataset can be downloaded <strong><a class="reference external" href="https://essentialoftimeseries.com/data/">here</a></strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">treas_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">&quot;../data/USTreasuryRates/us-treasury-rates-weekly.xlsx&quot;</span><span class="p">)</span>
<span class="n">treas_df</span> <span class="o">=</span> <span class="n">treas_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Unnamed: 0&#39;</span><span class="p">:</span> <span class="s1">&#39;Date&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
<span class="n">treas_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">treas_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">treas_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1-month</th>
      <th>3-month</th>
      <th>6-month</th>
      <th>1-year</th>
      <th>2-year</th>
      <th>3-year</th>
      <th>5-year</th>
      <th>7-year</th>
      <th>10-year</th>
      <th>Excess CRSP Mkt Returns</th>
      <th>10-year Treasury Returns</th>
      <th>Term spread</th>
      <th>Change in term spread</th>
      <th>5-year Treasury Returns</th>
      <th>Unnamed: 15</th>
      <th>Excess 10-year Treasury Returns</th>
      <th>Term Spread</th>
      <th>VXO</th>
      <th>Delta VXO</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1982-01-08</th>
      <td>10.296</td>
      <td>12.08</td>
      <td>13.36</td>
      <td>13.80</td>
      <td>14.12</td>
      <td>14.32</td>
      <td>14.46</td>
      <td>14.54</td>
      <td>14.47</td>
      <td>-1.632</td>
      <td>NaN</td>
      <td>2.39</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-0.286662</td>
      <td>1.729559</td>
      <td>20.461911</td>
      <td>-0.003106</td>
    </tr>
    <tr>
      <th>1982-01-15</th>
      <td>10.296</td>
      <td>12.72</td>
      <td>13.89</td>
      <td>14.39</td>
      <td>14.67</td>
      <td>14.73</td>
      <td>14.79</td>
      <td>14.84</td>
      <td>14.76</td>
      <td>-2.212</td>
      <td>-2.9</td>
      <td>2.04</td>
      <td>-0.35</td>
      <td>1.65</td>
      <td>-2.556</td>
      <td>-3.758000</td>
      <td>4.464000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1982-01-22</th>
      <td>10.296</td>
      <td>13.47</td>
      <td>14.30</td>
      <td>14.72</td>
      <td>14.93</td>
      <td>14.92</td>
      <td>14.81</td>
      <td>14.80</td>
      <td>14.73</td>
      <td>-0.202</td>
      <td>0.3</td>
      <td>1.26</td>
      <td>-0.78</td>
      <td>0.10</td>
      <td>0.049</td>
      <td>-0.558000</td>
      <td>4.434000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data_df</span> <span class="o">=</span> <span class="n">treas_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
<span class="n">data_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;US Treasury yield (%)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_VectorAutoregressiveMethods_16_0.png" src="../_images/03_VectorAutoregressiveMethods_16_0.png" />
</div>
</div>
</div>
<div class="section" id="d-jena-climate-data">
<h4>D. Jena Climate Data<a class="headerlink" href="#d-jena-climate-data" title="Permalink to this headline">¶</a></h4>
<p>Time series dataset recorded at the Weather Station at the Max Planck Institute for Biogeochemistry in Jena, Germany from 2009 to 2016. It contains 14 different quantities (e.g., air temperature, atmospheric pressure, humidity, wind direction, and so on) were recorded every 10 minutes. You can download the data <strong><a class="reference external" href="https://www.kaggle.com/stytch16/jena-climate-2009-2016">here</a></strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jena_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/jena_climate_2009_2016.csv&#39;</span><span class="p">)</span>
<span class="n">jena_data</span><span class="p">[</span><span class="s1">&#39;Date Time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">jena_data</span><span class="p">[</span><span class="s1">&#39;Date Time&#39;</span><span class="p">])</span>
<span class="n">jena_data</span> <span class="o">=</span> <span class="n">jena_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date Time&#39;</span><span class="p">)</span>
<span class="n">jena_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">jena_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">jena_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1000</span><span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_VectorAutoregressiveMethods_19_0.png" src="../_images/03_VectorAutoregressiveMethods_19_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="foundations">
<h3>Foundations<a class="headerlink" href="#foundations" title="Permalink to this headline">¶</a></h3>
<p>Before we discuss VARs, we outline some fundamental concepts below that we will need to understand the model.</p>
<div class="section" id="weak-stationarity-of-multivariate-time-series">
<h4>Weak Stationarity of Multivariate Time Series<a class="headerlink" href="#weak-stationarity-of-multivariate-time-series" title="Permalink to this headline">¶</a></h4>
<p>As in the univariate case, one of the requirements that we need to satisfy before we can apply VAR models is stationarity–in particular, weak stationarity. Both in the univariate and multivariate case, the first two moments of the time series are time-invariant. More formally, we describe weak stationarity below.</p>
<p>Consider a <span class="math notranslate nohighlight">\(N\)</span>-dimensional time series, <span class="math notranslate nohighlight">\(\mathbf{y}_t = \left[y_{1,t}, y_{2,t}, ..., y_{N,t}\right]^\prime\)</span>. This is said to be weakly stationary if the first two moments are finite and constant through time, that is,</p>
<ol class="simple">
<li><p><span class="math notranslate nohighlight">\(E\left[\mathbf{y}_t\right] = \boldsymbol{\mu}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(E\left[(\mathbf{y}_t-\boldsymbol{\mu})(\mathbf{y}_t-\boldsymbol{\mu})^\prime\right] \equiv \boldsymbol\Gamma_0 &lt; \infty\)</span> for all <span class="math notranslate nohighlight">\(t\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(E\left[(\mathbf{y}_t-\boldsymbol{\mu})(\mathbf{y}_{t-h}-\boldsymbol{\mu})^\prime\right] \equiv \boldsymbol\Gamma_h\)</span> for all <span class="math notranslate nohighlight">\(t\)</span> and <span class="math notranslate nohighlight">\(h\)</span></p></li>
</ol>
<p>where the expectations are taken element-by-element over the joint distribution of <span class="math notranslate nohighlight">\(\mathbf{y}_t\)</span>:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\boldsymbol{\mu}\)</span> is the vector of means <span class="math notranslate nohighlight">\(\boldsymbol\mu = \left[\mu_1, \mu_2, ..., \mu_N \right]\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\boldsymbol\Gamma_0\)</span> is the <span class="math notranslate nohighlight">\(N\times N\)</span> covariance matrix where the <span class="math notranslate nohighlight">\(i\)</span>th diagonal element is the variance of <span class="math notranslate nohighlight">\(y_{i,t}\)</span>, and the <span class="math notranslate nohighlight">\((i, j)\)</span>th element is the covariance between <span class="math notranslate nohighlight">\(y_{i,t}\)</span> and <span class="math notranslate nohighlight">\({y_{j,t}}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\boldsymbol\Gamma_h\)</span> is the cross-covariance matrix at lag <span class="math notranslate nohighlight">\(h\)</span></p></li>
</ul>
</div>
<div class="section" id="obtaining-cross-correlation-matrix-from-cross-covariance-matrix">
<h4>Obtaining Cross-Correlation Matrix from Cross-Covariance Matrix<a class="headerlink" href="#obtaining-cross-correlation-matrix-from-cross-covariance-matrix" title="Permalink to this headline">¶</a></h4>
<p>When dealing with a multivariate time series, we can examine the predictability of one variable on another by looking at the relationship between them using the cross-covariance function (CCVF) and cross-correlation function (CCF). To do this, we begin by defining the cross-covariance between two variables, then we estimate the cross-correlation between one variable and another variable that is time-shifted. This informs us whether one time series may be related to the past lags of the other. In other words, CCF is used for identifying lags of one variable that might be useful as a predictor of the other variable.</p>
<p><strong>At lag 0</strong>:</p>
<p>Let <span class="math notranslate nohighlight">\(\mathbf\Gamma_0\)</span> be the covariance matrix at lag 0, <span class="math notranslate nohighlight">\(\mathbf D\)</span> be a <span class="math notranslate nohighlight">\(N\times N\)</span> diagonal matrix containing the standard deviations of <span class="math notranslate nohighlight">\(y_{i,t}\)</span> for <span class="math notranslate nohighlight">\(i=1, ..., N\)</span>. The correlation matrix of <span class="math notranslate nohighlight">\(\mathbf{y}_t\)</span> is defined as</p>
<div class="math notranslate nohighlight">
\[\boldsymbol\rho_0 = \mathbf D^{-1}\mathbf\Gamma_0\mathbf D^{-1}\]</div>
<p>where the <span class="math notranslate nohighlight">\((i, j)\)</span>th element of <span class="math notranslate nohighlight">\(\boldsymbol\rho_0\)</span> is the correlation coefficient between <span class="math notranslate nohighlight">\(y_{i,t}\)</span> and <span class="math notranslate nohighlight">\(y_{j,t}\)</span> at time <span class="math notranslate nohighlight">\(t\)</span>:</p>
<div class="math notranslate nohighlight">
\[\rho_{i,j}(0) = \dfrac{Cov\left[y_{i,t}, y_{j,t} \right]}{\sigma_{i,t} \sigma_{j,t}}\]</div>
<p><strong>At lag h</strong>:</p>
<p>Let <span class="math notranslate nohighlight">\(\boldsymbol\Gamma_h = E\left[(\mathbf{y}_t-\boldsymbol{\mu})(\mathbf{y}_{t-h}-\boldsymbol{\mu})^\prime\right]\)</span> be the lag-<span class="math notranslate nohighlight">\(h\)</span> covariance cross-covariance matrix of <span class="math notranslate nohighlight">\(\mathbf y_{t}\)</span>. The lag-<span class="math notranslate nohighlight">\(h\)</span> cross-correlation matrix is defined as</p>
<div class="math notranslate nohighlight">
\[\boldsymbol\rho_h = \mathbf D^{-1}\mathbf\Gamma_h\mathbf D^{-1}\]</div>
<p>The <span class="math notranslate nohighlight">\((i,j)\)</span>th element of <span class="math notranslate nohighlight">\(\boldsymbol\rho_h\)</span> is the correlation coefficient between <span class="math notranslate nohighlight">\(y_{i,t}\)</span> and <span class="math notranslate nohighlight">\(y_{j,t-h}\)</span>:</p>
<div class="math notranslate nohighlight">
\[\rho_{i,j}(h) = \dfrac{Cov\left[y_{i,t}, y_{j,t-h} \right]}{\sigma_{i,t} \sigma_{j,t}}\]</div>
<p><strong>What do we get from this?</strong></p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Correlation Coefficient</p></th>
<th class="text-align:left head"><p>Interpretation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p><span class="math notranslate nohighlight">\(\rho_{i,j}(0)\neq0\)</span></p></td>
<td class="text-align:left"><p><span class="math notranslate nohighlight">\(y_{i,t}\)</span> and <span class="math notranslate nohighlight">\(y_{j,t}\)</span> are <em>contemporaneously linearly correlated</em></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><span class="math notranslate nohighlight">\(\rho_{i,j}(h)=\rho_{j,i}(h)=0\)</span> for all <span class="math notranslate nohighlight">\(h\geq0\)</span></p></td>
<td class="text-align:left"><p><span class="math notranslate nohighlight">\(y_{i,t}\)</span> and <span class="math notranslate nohighlight">\(y_{j,t}\)</span> share <em>no linear relationship</em></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><span class="math notranslate nohighlight">\(\rho_{i,j}(h)=0\)</span> and <span class="math notranslate nohighlight">\(\rho_{j,i}(h)=0\)</span> for all <span class="math notranslate nohighlight">\(h&gt;0\)</span></p></td>
<td class="text-align:left"><p><span class="math notranslate nohighlight">\(y_{i,t}\)</span> and <span class="math notranslate nohighlight">\(y_{j,t}\)</span> are said to be linearly <em>uncoupled</em></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p><span class="math notranslate nohighlight">\(\rho_{i,j}(h)=0\)</span> for all <span class="math notranslate nohighlight">\(h&gt;0\)</span>, but <span class="math notranslate nohighlight">\(\rho_{j,i}(q)\neq0\)</span> for at least some <span class="math notranslate nohighlight">\(q&gt;0\)</span></p></td>
<td class="text-align:left"><p>There is a <em>unidirectional (linear) relationship</em> between <span class="math notranslate nohighlight">\(y_{i,t}\)</span> and <span class="math notranslate nohighlight">\(y_{j,t}\)</span>, where <span class="math notranslate nohighlight">\(y_{i,t}\)</span> does not depend on <span class="math notranslate nohighlight">\(y_{j,t}\)</span>, but <span class="math notranslate nohighlight">\(y_{j,t}\)</span> depends on (some) lagged values of <span class="math notranslate nohighlight">\(y_{i,t}\)</span></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p><span class="math notranslate nohighlight">\(\rho_{i,j}(h)\neq0\)</span> for at least some <span class="math notranslate nohighlight">\(h&gt;0\)</span> and <span class="math notranslate nohighlight">\(\rho_{j,i}(q)\neq0\)</span> for at least some <span class="math notranslate nohighlight">\(q&gt;0\)</span></p></td>
<td class="text-align:left"><p>There is a <em>bi-directional (feedback) linear relationship</em> between <span class="math notranslate nohighlight">\(y_{i,t}\)</span> and <span class="math notranslate nohighlight">\(y_{j,t}\)</span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section" id="vector-autoregressive-var-models">
<h2>Vector Autoregressive (VAR) Models<a class="headerlink" href="#vector-autoregressive-var-models" title="Permalink to this headline">¶</a></h2>
<p>The vector autoregressive (VAR) model is one of the most successful models for analysis of multivariate time series. It has been demonstrated to be successful in describing relationships and forecasting economic and financial time series, and providing more accurate forecasts than the univariate time series models and theory-based simultaneous equations models.</p>
<p>The structure of the VAR model is just the <strong>generalization of the univariate AR</strong> model. It is a system regression model that treats all the variables as endogenous, and allows each of the variables to depend on <span class="math notranslate nohighlight">\(p\)</span> lagged values of itself and of all the other variables in the system.</p>
<p>A VAR model of order <span class="math notranslate nohighlight">\(p\)</span> can be represented as</p>
<div class="math notranslate nohighlight">
\[\mathbf y_t=\mathbf a_0 + \mathbf A_1 \mathbf y_{t-1} + \mathbf A_2 \mathbf y_{t-2} + ... + \mathbf A_p \mathbf y_{t-p} + \mathbf u_t = \mathbf a_0  + \sum_{j=1}^{p} \mathbf A_j \mathbf y_{t-j} + \mathbf u_t\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf y_t\)</span> is a <span class="math notranslate nohighlight">\(N\times 1\)</span> vector containing <span class="math notranslate nohighlight">\(N\)</span> endogenous variables, <span class="math notranslate nohighlight">\(\mathbf a_0\)</span> is a <span class="math notranslate nohighlight">\(N\times 1\)</span> vector of constants, <span class="math notranslate nohighlight">\(\mathbf A_1, \mathbf A_2, ..., \mathbf A_p\)</span> are the <span class="math notranslate nohighlight">\(p\)</span> <span class="math notranslate nohighlight">\(N\times N\)</span> matrices of autoregressive coefficients, and <span class="math notranslate nohighlight">\(\mathbf u_t\)</span> is a <span class="math notranslate nohighlight">\(N\times 1\)</span> vector of white noise disturbances.</p>
<div class="section" id="var-1-model">
<h3>VAR(1) Model<a class="headerlink" href="#var-1-model" title="Permalink to this headline">¶</a></h3>
<p>To illustrate, let’s consider the simplest VAR model where we have <span class="math notranslate nohighlight">\(p=1\)</span>.</p>
<div class="section" id="structural-and-reduced-forms-of-the-var-model">
<h4>Structural and Reduced Forms of the VAR model<a class="headerlink" href="#structural-and-reduced-forms-of-the-var-model" title="Permalink to this headline">¶</a></h4>
<p>Consider the following bivariate system</p>
<div class="math notranslate nohighlight">
\[ y_{1,t} = b_{1,0} - b_{1,2}y_{2,t} +  \varphi_{1,1}y_{1,t-1} + \varphi_{1,2}y_{2,t-1} + \varepsilon_{1,t}\]</div>
<div class="math notranslate nohighlight">
\[ y_{2,t} = b_{2,0} - b_{2,1}y_{2,t} +  \varphi_{2,1}y_{1,t-1} + \varphi_{2,2}y_{2,t-1} + \varepsilon_{2,t}\]</div>
<p>where both <span class="math notranslate nohighlight">\(y_{1,t}\)</span> and <span class="math notranslate nohighlight">\(y_{2,t}\)</span> are assumed to be stationary, and <span class="math notranslate nohighlight">\(\varepsilon_{1,t}\)</span> and <span class="math notranslate nohighlight">\(\varepsilon_{2,t}\)</span> are the uncorrelated error terms with standard deviation <span class="math notranslate nohighlight">\(\sigma_{1,t}\)</span> and <span class="math notranslate nohighlight">\(\sigma_{2,t}\)</span>, respectively.</p>
<p>In matrix notation:
<img alt="../_images/bivariate1.png" src="../_images/bivariate1.png" /></p>
<p>Let
<img alt="../_images/bivariate2.png" src="../_images/bivariate2.png" /></p>
<p>then</p>
<div class="math notranslate nohighlight">
\[\mathbf B \mathbf y_t = \mathbf Q_0 + \mathbf Q_1 \mathbf y_{t-1} + \boldsymbol\varepsilon_t\]</div>
<div class="section" id="structural-var-var-in-primitive-form">
<h5>Structural VAR (VAR in primitive form)<a class="headerlink" href="#structural-var-var-in-primitive-form" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Described by equation above</p></li>
<li><p>Captures contemporaneous feedback effects (<span class="math notranslate nohighlight">\(b_{1,2}, b_{2,1}\)</span>)</p></li>
<li><p>Not very practical to use</p></li>
<li><p>Contemporaneous terms cannot be used in forecasting</p></li>
<li><p>Needs further manipulation to make it more useful (e.g. multiplying the matrix equation by <span class="math notranslate nohighlight">\(\mathbf B^{-1}\)</span>)</p></li>
</ul>
<p>Multiplying the matrix equation by <span class="math notranslate nohighlight">\(\mathbf B^{-1}\)</span>, we get</p>
<div class="math notranslate nohighlight">
\[\mathbf y_t = \mathbf a_0 + \mathbf A_1 \mathbf y_{t-1} + \mathbf u_t\]</div>
<p>or</p>
<div class="math notranslate nohighlight">
\[\mathbf y_t = \mathbf a_0 + \mathbf A_1 L\mathbf y_t + \mathbf u_t\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf a_0 = \mathbf B^{-1}\mathbf Q_0\)</span>, <span class="math notranslate nohighlight">\(\mathbf A_1 = \mathbf B^{-1}\mathbf Q_1\)</span>, <span class="math notranslate nohighlight">\(L\)</span> is the lag/backshift operator, and <span class="math notranslate nohighlight">\(\mathbf u_t = \mathbf B^{-1}\boldsymbol\varepsilon_t\)</span>, equivalently,</p>
<div class="math notranslate nohighlight">
\[ y_{1,t} = a_{1,0} + a_{1,1}y_{1,t-1} + a_{1,2}y_{2,t-1} + u_{1,t}\]</div>
<div class="math notranslate nohighlight">
\[ y_{2,t} = a_{2,0} + a_{2,1}y_{1,t-1} + a_{2,2}y_{2,t-1} + u_{2,t}\]</div>
</div>
<div class="section" id="reduced-form-var-var-in-standard-form">
<h5>Reduced-form VAR (VAR in standard form)<a class="headerlink" href="#reduced-form-var-var-in-standard-form" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>Described by equation above</p></li>
<li><p>Only dependent on lagged endogenous variables (no contemporaneous feedback)</p></li>
<li><p>Can be estimated using ordinary least squares (OLS)</p></li>
</ul>
</div>
</div>
<div class="section" id="vma-infinite-representation-and-stationarity">
<h4>VMA infinite representation and Stationarity<a class="headerlink" href="#vma-infinite-representation-and-stationarity" title="Permalink to this headline">¶</a></h4>
<p>Consider the reduced form, standard VAR(1) model</p>
<div class="math notranslate nohighlight">
\[\mathbf y_t = \mathbf a_0 + \mathbf A_1 \mathbf y_{t-1} + \mathbf u_t\]</div>
<p>Assuming that the process is weakly stationary and taking the expectation of <span class="math notranslate nohighlight">\(\mathbf y_t\)</span>, we have</p>
<div class="math notranslate nohighlight">
\[E\left[\mathbf y_t\right] = \mathbf a_0 + \mathbf A_1 E\left[\mathbf y_{t-1}\right]\]</div>
<p>where <span class="math notranslate nohighlight">\(E\left[\mathbf u_t\right]=0.\)</span> If we let <span class="math notranslate nohighlight">\(\tilde{\mathbf y}_{t}\equiv \mathbf y_t - \boldsymbol \mu\)</span> be the mean-corrected time-series, we can write the model as</p>
<div class="math notranslate nohighlight">
\[\tilde{\mathbf y}_{t} = \mathbf A_1 \tilde{\mathbf y}_{t-1} + \mathbf u_t\]</div>
<p>Substituting <span class="math notranslate nohighlight">\(\tilde{\mathbf y}_{t-1} = \mathbf A_1 \tilde{\mathbf y}_{t-2} + \mathbf u_{t-1}\)</span>,</p>
<div class="math notranslate nohighlight">
\[\tilde{\mathbf y}_{t} = \mathbf A_1 \left( \mathbf A_1 \tilde{\mathbf y}_{t-2} + \mathbf u_{t-1}\right)+ \mathbf u_t\]</div>
<p>If we keep iterating, we get</p>
<div class="math notranslate nohighlight">
\[\mathbf y_{t} = \boldsymbol\mu + \sum_{i=1}^{\infty} \mathbf A_1^i  \mathbf u_{t-i} + \mathbf u_t\]</div>
<p>Letting <span class="math notranslate nohighlight">\(\boldsymbol\Theta_i\equiv A_1^i\)</span>, we get the <strong>VMA infinite representation</strong></p>
<div class="math notranslate nohighlight">
\[\mathbf y_{t} = \boldsymbol\mu + \sum_{i=1}^{\infty} \boldsymbol\Theta_i  \mathbf u_{t-i} + \mathbf u_t\]</div>
</div>
<div class="section" id="stationarity-of-the-var-1-model">
<h4>Stationarity of the VAR(1) model<a class="headerlink" href="#stationarity-of-the-var-1-model" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>All the N eigenvalues of the matrix <span class="math notranslate nohighlight">\(A_1\)</span> must be less than 1 in modulus, to avoid that the coefficient matrix <span class="math notranslate nohighlight">\(A_1^j\)</span> from either exploding or converging to a nonzero matrix as <span class="math notranslate nohighlight">\(j\)</span> goes to infinity.</p></li>
<li><p>Provided that the covariance matrix of <span class="math notranslate nohighlight">\(u_t\)</span> exists, the requirement that all the eigenvalues of <span class="math notranslate nohighlight">\(A_1\)</span> are less than one in modulus is a necessary and sufficient condition for <span class="math notranslate nohighlight">\(y_t\)</span> to be stable, and thus, stationary.</p></li>
<li><p>All roots of <span class="math notranslate nohighlight">\(det\left(\mathbf I_N - \mathbf A_1 z\right)=0\)</span> must lie outside the unit circle.</p></li>
</ul>
</div>
</div>
<div class="section" id="var-p-model">
<h3>VAR(p) Model<a class="headerlink" href="#var-p-model" title="Permalink to this headline">¶</a></h3>
<p>Consider the VAR(p) model described by</p>
<div class="math notranslate nohighlight">
\[\mathbf y_t=\mathbf a_0 + \mathbf A_1 \mathbf y_{t-1} + \mathbf A_2 \mathbf y_{t-2} + ... + \mathbf A_p \mathbf y_{t-p} + \mathbf u_t = \mathbf a_0  + \sum_{j=1}^{p} \mathbf A_j \mathbf y_{t-j} + \mathbf u_t\]</div>
<p>Using the lag operator <span class="math notranslate nohighlight">\(L\)</span>, we get</p>
<div class="math notranslate nohighlight">
\[\tilde{\mathbf A} (L) \mathbf y_t = \mathbf a_0 + \mathbf u_t\]</div>
<p>where <span class="math notranslate nohighlight">\(\tilde{\mathbf A} (L) = (\mathbf I_N - A_1 L - ... - A_p L^p)\)</span>. Assuming that <span class="math notranslate nohighlight">\(\mathbf y_t\)</span> is weakly stationary, we obtain that</p>
<div class="math notranslate nohighlight">
\[\boldsymbol\mu = E\left[\mathbf y_t\right] = (\mathbf I_N - A_1 L - ... - A_p L^p)^{-1} \mathbf a_0\]</div>
<p>Defining <span class="math notranslate nohighlight">\(\tilde{\mathbf y}_t=\mathbf y_t -\boldsymbol\mu\)</span>, we have</p>
<div class="math notranslate nohighlight">
\[\tilde{\mathbf y}_t =  \mathbf A_1 \tilde{\mathbf y}_{t-1} + \mathbf A_2 \tilde{\mathbf y}_{t-2} + ... + \mathbf A_p \tilde{\mathbf y}_{t-p} + \mathbf u_t\]</div>
<div class="section" id="properties">
<h4>Properties<a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(Cov[\mathbf y_t, \mathbf u_t] = \Sigma_u\)</span>, the covariance matrix of <span class="math notranslate nohighlight">\(\mathbf u_t\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(Cov[\mathbf y_{t-h}, \mathbf u_t] = \mathbf 0\)</span> for any <span class="math notranslate nohighlight">\(h&gt;0\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\boldsymbol\Gamma_h = \mathbf A_1 \boldsymbol\Gamma_{h-1} +...+\mathbf A_p \boldsymbol\Gamma_{h-p}\)</span> for <span class="math notranslate nohighlight">\(h&gt;0\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\boldsymbol\rho_h = \boldsymbol \Psi_1 \boldsymbol\Gamma_{h-1} +...+\boldsymbol \Psi_p \boldsymbol\Gamma_{h-p}\)</span> for <span class="math notranslate nohighlight">\(h&gt;0\)</span>, where <span class="math notranslate nohighlight">\(\boldsymbol \Psi_i = \mathbf D^{-1/2}\mathbf A_i D^{-1/2}\)</span></p></li>
</ul>
</div>
<div class="section" id="stationarity-of-var-p-model">
<h4>Stationarity of VAR(p) model<a class="headerlink" href="#stationarity-of-var-p-model" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>All roots of <span class="math notranslate nohighlight">\(det\left(\mathbf I_N - \mathbf A_1 z - ...-  \mathbf A_p z^p\right)=0\)</span> must lie outside the unit circle.</p></li>
</ul>
</div>
</div>
<div class="section" id="specification-of-a-var-model-choosing-the-order-p">
<h3>Specification of a VAR model: Choosing the order <em>p</em><a class="headerlink" href="#specification-of-a-var-model-choosing-the-order-p" title="Permalink to this headline">¶</a></h3>
<p>Fitting a VAR model involves the selection of a single parameter: the model order or lag length <span class="math notranslate nohighlight">\(p\)</span>. The most common approach in selecting the best model is choosing the <span class="math notranslate nohighlight">\(p\)</span> that minimizes one or more information criteria evaluated over a range of model orders. The criterion consists of two terms: the first one characterizes the entropy rate or prediction error, and second one characterizes the number of freely estimated parameters in the model. Minimizing both terms will allow us to identify a model that accurately models the data while preventing overfitting (due to too many parameters).</p>
<p>Some of the commonly used information criteria include: Akaike Information Criterion (AIC), Schwarz’s Bayesian Information Criterion (BIC), Hannan-Quinn Criterion (HQ), and Akaike’s Final Prediction Error Criterion (FPE). The equation for each are shown below.</p>
<p><em>Akaike’s information criterion</em></p>
<div class="math notranslate nohighlight">
\[(M)\operatorname{AIC} = \operatorname{ln}|\tilde{\boldsymbol\Sigma}_u | + 2\dfrac{k}{T}\]</div>
<p><em>Schwarz’s Bayesian information criterion</em></p>
<div class="math notranslate nohighlight">
\[(M)\operatorname{BIC} = \operatorname{ln}|\tilde{\boldsymbol\Sigma}_u | + \dfrac{k}{T}\operatorname{ln}(T)\]</div>
<p><em>Hannan-Quinn’s information criterion</em></p>
<div class="math notranslate nohighlight">
\[(M)\operatorname{HQIC} = \operatorname{ln}|\tilde{\boldsymbol\Sigma}_u | + \dfrac{k}{T}\operatorname{ln}(\operatorname{ln}(T))\]</div>
<p><em>Final prediction error</em></p>
<div class="math notranslate nohighlight">
\[\operatorname{FPE}(p) = \left(\dfrac{T+Np+1}{T-Np+1} \right)^N |\tilde{\boldsymbol\Sigma}_u | \]</div>
<div class="math notranslate nohighlight">
\[\operatorname{ln}(\operatorname{FPE}(p)) = \operatorname{ln}|\tilde{\boldsymbol\Sigma}_u | + N \operatorname{ln}\left(\dfrac{T+Np+1}{T-Np+1} \right) \]</div>
<p>where <span class="math notranslate nohighlight">\(M\)</span> stands for multivariate, <span class="math notranslate nohighlight">\(\tilde{\boldsymbol\Sigma}_u\)</span> is the estimated covariance matrix of the residuals, <span class="math notranslate nohighlight">\(T\)</span> is the number of observations in the sample, and <span class="math notranslate nohighlight">\(k\)</span> is the total number of equations in the VAR(<span class="math notranslate nohighlight">\(p\)</span>) (i.e. <span class="math notranslate nohighlight">\(N^2p + N\)</span> where <span class="math notranslate nohighlight">\(N\)</span> is the number of equations and <span class="math notranslate nohighlight">\(p\)</span> is the number of lags).</p>
<p>Among the metrics above, AIC and BIC are the most widely used criteria, but BIC penalizes higher orders more. For moderate and large sample sizes, AIC and FPE are essentially equivalent, but FPE may outperform AIC for small sample sizes. HQ also penalizes higher order models more heavily than AIC, but less than BIC. However, under small sample conditions, AIC/FPE may outperform BIC and/or HQ in selecting true model order.</p>
<p>There are cases when AIC and FPE show no clear minimum over a range or model orders or lag lengths. In this case, there may be a clear “elbow” when we plot the values over model order. This may indicate a suitable model order.</p>
</div>
</div>
<div class="section" id="building-a-var-model">
<h2>Building a VAR model<a class="headerlink" href="#building-a-var-model" title="Permalink to this headline">¶</a></h2>
<p>In this section, we show how we can use the VAR model to forecast the air quality data. The following steps are shown below:</p>
<ol class="simple">
<li><p>Check for stationarity.</p></li>
<li><p>Split data into train and test sets.</p></li>
<li><p>Select the VAR order <em>p</em> that gives.</p></li>
<li><p>Fit VAR model of order <em>p</em> on the train set.</p></li>
<li><p>Generate forecast.</p></li>
<li><p>Evaluate model performance.</p></li>
</ol>
<div class="section" id="example-2-forecasting-air-quality-data-co-no2-and-rh">
<h3>Example 2: Forecasting Air Quality Data (CO, NO2 and RH)<a class="headerlink" href="#example-2-forecasting-air-quality-data-co-no2-and-rh" title="Permalink to this headline">¶</a></h3>
<p>For illustration, we consider the carbon monoxide, nitrous dioxide  and relative humidity time series from the Air Quality Dataset from 1 October 2014.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CO(GT)&#39;</span><span class="p">,</span> <span class="s1">&#39;NO2(GT)&#39;</span><span class="p">,</span> <span class="s1">&#39;RH&#39;</span><span class="p">]</span>
<span class="n">data_df</span> <span class="o">=</span> <span class="n">aq_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">aq_df</span><span class="o">.</span><span class="n">index</span><span class="o">&gt;</span><span class="s1">&#39;2004-10-01&#39;</span><span class="p">,</span><span class="n">cols</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_VectorAutoregressiveMethods_47_0.png" src="../_images/03_VectorAutoregressiveMethods_47_0.png" />
</div>
</div>
<p><strong>Quick inspection before we proceed with modeling…</strong></p>
<p>To find out whether the multivariate approach is better than treating the signals separately as univariate time series, we examine the relationship between the variables using CCF. The sample below shows the CCF for the last 100 data points of the Air quality data for CO, NO2 and RH.</p>
<p><em>CO and NO2</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_df</span> <span class="o">=</span> <span class="n">data_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:]</span>
<span class="n">ccf_y1_y2</span> <span class="o">=</span> <span class="n">ccf</span><span class="p">(</span><span class="n">sample_df</span><span class="p">[</span><span class="s1">&#39;CO(GT)&#39;</span><span class="p">],</span> <span class="n">sample_df</span><span class="p">[</span><span class="s1">&#39;NO2(GT)&#39;</span><span class="p">],</span> <span class="n">unbiased</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ccf_y2_y1</span> <span class="o">=</span> <span class="n">ccf</span><span class="p">(</span><span class="n">sample_df</span><span class="p">[</span><span class="s1">&#39;NO2(GT)&#39;</span><span class="p">],</span> <span class="n">sample_df</span><span class="p">[</span><span class="s1">&#39;CO(GT)&#39;</span><span class="p">],</span> <span class="n">unbiased</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">d</span><span class="o">=</span><span class="mi">1</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_df</span><span class="p">))[::</span><span class="n">d</span><span class="p">],</span> <span class="n">ccf_y1_y2</span><span class="p">[::</span><span class="n">d</span><span class="p">],</span> <span class="n">linefmt</span><span class="o">=</span><span class="s1">&#39;C1-&#39;</span><span class="p">,</span> <span class="n">markerfmt</span><span class="o">=</span><span class="s1">&#39;C1o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_df</span><span class="p">))[::</span><span class="n">d</span><span class="p">],</span> <span class="n">ccf_y2_y1</span><span class="p">[::</span><span class="n">d</span><span class="p">],</span> <span class="n">linefmt</span><span class="o">=</span><span class="s1">&#39;C1-&#39;</span><span class="p">,</span> <span class="n">markerfmt</span><span class="o">=</span><span class="s1">&#39;C1o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;lag $h$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\rho_{CO,NO2} (h)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\rho_{NO2,CO} (h)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_VectorAutoregressiveMethods_50_0.png" src="../_images/03_VectorAutoregressiveMethods_50_0.png" />
</div>
</div>
<p><em>CO and RH</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ccf_y1_y2</span> <span class="o">=</span> <span class="n">ccf</span><span class="p">(</span><span class="n">sample_df</span><span class="p">[</span><span class="s1">&#39;CO(GT)&#39;</span><span class="p">],</span> <span class="n">sample_df</span><span class="p">[</span><span class="s1">&#39;RH&#39;</span><span class="p">],</span> <span class="n">unbiased</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ccf_y2_y1</span> <span class="o">=</span> <span class="n">ccf</span><span class="p">(</span><span class="n">sample_df</span><span class="p">[</span><span class="s1">&#39;RH&#39;</span><span class="p">],</span> <span class="n">sample_df</span><span class="p">[</span><span class="s1">&#39;CO(GT)&#39;</span><span class="p">],</span> <span class="n">unbiased</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">d</span><span class="o">=</span><span class="mi">1</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_df</span><span class="p">))[::</span><span class="n">d</span><span class="p">],</span> <span class="n">ccf_y1_y2</span><span class="p">[::</span><span class="n">d</span><span class="p">],</span> <span class="n">linefmt</span><span class="o">=</span><span class="s1">&#39;C1-&#39;</span><span class="p">,</span> <span class="n">markerfmt</span><span class="o">=</span><span class="s1">&#39;C1o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_df</span><span class="p">))[::</span><span class="n">d</span><span class="p">],</span> <span class="n">ccf_y2_y1</span><span class="p">[::</span><span class="n">d</span><span class="p">],</span> <span class="n">linefmt</span><span class="o">=</span><span class="s1">&#39;C1-&#39;</span><span class="p">,</span> <span class="n">markerfmt</span><span class="o">=</span><span class="s1">&#39;C1o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;lag $h$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\rho_{CO,RH} (h)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\rho_{RH,CO} (h)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_VectorAutoregressiveMethods_52_0.png" src="../_images/03_VectorAutoregressiveMethods_52_0.png" />
</div>
</div>
<p><em>RH and NO2</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ccf_y1_y2</span> <span class="o">=</span> <span class="n">ccf</span><span class="p">(</span><span class="n">sample_df</span><span class="p">[</span><span class="s1">&#39;RH&#39;</span><span class="p">],</span> <span class="n">sample_df</span><span class="p">[</span><span class="s1">&#39;NO2(GT)&#39;</span><span class="p">],</span> <span class="n">unbiased</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ccf_y2_y1</span> <span class="o">=</span> <span class="n">ccf</span><span class="p">(</span><span class="n">sample_df</span><span class="p">[</span><span class="s1">&#39;NO2(GT)&#39;</span><span class="p">],</span> <span class="n">sample_df</span><span class="p">[</span><span class="s1">&#39;RH&#39;</span><span class="p">],</span> <span class="n">unbiased</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">d</span><span class="o">=</span><span class="mi">1</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_df</span><span class="p">))[::</span><span class="n">d</span><span class="p">],</span> <span class="n">ccf_y1_y2</span><span class="p">[::</span><span class="n">d</span><span class="p">],</span> <span class="n">linefmt</span><span class="o">=</span><span class="s1">&#39;C1-&#39;</span><span class="p">,</span> <span class="n">markerfmt</span><span class="o">=</span><span class="s1">&#39;C1o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_df</span><span class="p">))[::</span><span class="n">d</span><span class="p">],</span> <span class="n">ccf_y2_y1</span><span class="p">[::</span><span class="n">d</span><span class="p">],</span> <span class="n">linefmt</span><span class="o">=</span><span class="s1">&#39;C1-&#39;</span><span class="p">,</span> <span class="n">markerfmt</span><span class="o">=</span><span class="s1">&#39;C1o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;lag $h$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\rho_{RH,NO2} (h)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\rho_{NO2,RH} (h)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_VectorAutoregressiveMethods_54_0.png" src="../_images/03_VectorAutoregressiveMethods_54_0.png" />
</div>
</div>
<p><strong>Observation/s</strong>:</p>
<p>As shown in the plot above, we can see that there’s a relationship between:</p>
<ul class="simple">
<li><p>CO and some lagged values of RH and NO2</p></li>
<li><p>NO2 and some lagged values of RH and CO</p></li>
<li><p>RH and some lagged values of CO and NO2</p></li>
</ul>
<p>This shows that we can benefit from the multivariate approach, so we proceed with building the VAR model.</p>
<div class="section" id="check-stationarity">
<h4>1. Check stationarity<a class="headerlink" href="#check-stationarity" title="Permalink to this headline">¶</a></h4>
<p>To check for stationarity, we use the Kwiatkowski–Phillips–Schmidt–Shin (KPSS) test and the Augmented Dickey-Fuller (ADF) test. For the data to be suitable for VAR modelling, we need each of the variables in the multivariate time series to be stationary. In both tests, we need the test statistic to be less than the critical values to say that a time series (a variable) to be stationary.</p>
<div class="section" id="kwiatkowskiphillipsschmidtshin-kpss-test">
<h5>Kwiatkowski–Phillips–Schmidt–Shin (KPSS) test<a class="headerlink" href="#kwiatkowskiphillipsschmidtshin-kpss-test" title="Permalink to this headline">¶</a></h5>
<p>Recall: Null hypothesis is that an observable time series is stationary around a deterministic trend (i.e. trend-stationary) against the alternative of a unit root.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_stat</span><span class="p">,</span> <span class="n">p_val</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="n">cv_1pct</span><span class="p">,</span> <span class="n">cv_2p5pct</span><span class="p">,</span> <span class="n">cv_5pct</span><span class="p">,</span> <span class="n">cv_10pct</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span> 
    <span class="n">kpss_res</span> <span class="o">=</span> <span class="n">kpss</span><span class="p">(</span><span class="n">data_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">regression</span><span class="o">=</span><span class="s1">&#39;ct&#39;</span><span class="p">)</span>
    <span class="n">test_stat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpss_res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">p_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpss_res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cv_1pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpss_res</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s1">&#39;1%&#39;</span><span class="p">])</span>
    <span class="n">cv_2p5pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpss_res</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s1">&#39;1%&#39;</span><span class="p">])</span>
    <span class="n">cv_5pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpss_res</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s1">&#39;5%&#39;</span><span class="p">])</span>
    <span class="n">cv_10pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpss_res</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s1">&#39;10%&#39;</span><span class="p">])</span>
<span class="n">kpss_res_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Test statistic&#39;</span><span class="p">:</span> <span class="n">test_stat</span><span class="p">,</span> 
                           <span class="s1">&#39;p-value&#39;</span><span class="p">:</span> <span class="n">p_val</span><span class="p">,</span> 
                           <span class="s1">&#39;Critical value - 1%&#39;</span><span class="p">:</span> <span class="n">cv_1pct</span><span class="p">,</span>
                           <span class="s1">&#39;Critical value - 2.5%&#39;</span><span class="p">:</span> <span class="n">cv_2p5pct</span><span class="p">,</span>
                           <span class="s1">&#39;Critical value - 5%&#39;</span><span class="p">:</span> <span class="n">cv_5pct</span><span class="p">,</span>
                           <span class="s1">&#39;Critical value - 10%&#39;</span><span class="p">:</span> <span class="n">cv_10pct</span><span class="p">},</span> 
                         <span class="n">index</span><span class="o">=</span><span class="n">data_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">kpss_res_df</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CO(GT)</th>
      <th>NO2(GT)</th>
      <th>RH</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>0.0702</td>
      <td>0.3239</td>
      <td>0.1149</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.1000</td>
      <td>0.0100</td>
      <td>0.1000</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>0.2160</td>
      <td>0.2160</td>
      <td>0.2160</td>
    </tr>
    <tr>
      <th>Critical value - 2.5%</th>
      <td>0.2160</td>
      <td>0.2160</td>
      <td>0.2160</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>0.1460</td>
      <td>0.1460</td>
      <td>0.1460</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>0.1190</td>
      <td>0.1190</td>
      <td>0.1190</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Observation/s</strong>:</p>
<p>From the KPSS test, CO and RH are stationary.</p>
</div>
<div class="section" id="augmented-dickey-fuller-adf-test">
<h5>Augmented Dickey-Fuller (ADF) test<a class="headerlink" href="#augmented-dickey-fuller-adf-test" title="Permalink to this headline">¶</a></h5>
<p>Recall: Null hypothesis is that a unit root is present in a time series sample against the alternative that the time series is stationary.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_stat</span><span class="p">,</span> <span class="n">p_val</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="n">cv_1pct</span><span class="p">,</span> <span class="n">cv_5pct</span><span class="p">,</span> <span class="n">cv_10pct</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span> 
    <span class="n">adf_res</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">data_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
    <span class="n">test_stat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">p_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cv_1pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="s1">&#39;1%&#39;</span><span class="p">])</span>
    <span class="n">cv_5pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="s1">&#39;5%&#39;</span><span class="p">])</span>
    <span class="n">cv_10pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="s1">&#39;10%&#39;</span><span class="p">])</span>
<span class="n">adf_res_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Test statistic&#39;</span><span class="p">:</span> <span class="n">test_stat</span><span class="p">,</span> 
                           <span class="s1">&#39;p-value&#39;</span><span class="p">:</span> <span class="n">p_val</span><span class="p">,</span> 
                           <span class="s1">&#39;Critical value - 1%&#39;</span><span class="p">:</span> <span class="n">cv_1pct</span><span class="p">,</span>
                           <span class="s1">&#39;Critical value - 5%&#39;</span><span class="p">:</span> <span class="n">cv_5pct</span><span class="p">,</span>
                           <span class="s1">&#39;Critical value - 10%&#39;</span><span class="p">:</span> <span class="n">cv_10pct</span><span class="p">},</span> 
                         <span class="n">index</span><span class="o">=</span><span class="n">data_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">adf_res_df</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CO(GT)</th>
      <th>NO2(GT)</th>
      <th>RH</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>-7.0195</td>
      <td>-6.7695</td>
      <td>-6.8484</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>-3.4318</td>
      <td>-3.4318</td>
      <td>-3.4318</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>-2.8622</td>
      <td>-2.8622</td>
      <td>-2.8622</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>-2.5671</td>
      <td>-2.5671</td>
      <td>-2.5671</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Observation/s</strong>:</p>
<p>From the ADF test, CO, NO2 and RH are stationary.</p>
</div>
</div>
<div class="section" id="split-data-into-train-and-test-sets">
<h4>2. Split data into train and test sets<a class="headerlink" href="#split-data-into-train-and-test-sets" title="Permalink to this headline">¶</a></h4>
<p>We use the dataset from 01 October 2014 to predict the last 24 points (24 hrs/1 day) in the dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">forecast_length</span> <span class="o">=</span> <span class="mi">24</span> 
<span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">data_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="n">forecast_length</span><span class="p">],</span> <span class="n">data_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="n">forecast_length</span><span class="p">:]</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">test_df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">~</span><span class="n">test_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;-d&#39;</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;../data/AirQualityUCI/train_data.csv&#39;</span><span class="p">)</span>
<span class="n">test_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;../data/AirQualityUCI/test_data.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">train_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_VectorAutoregressiveMethods_68_0.png" src="../_images/03_VectorAutoregressiveMethods_68_0.png" />
</div>
</div>
</div>
<div class="section" id="select-order-p">
<h4>3. Select order <em>p</em><a class="headerlink" href="#select-order-p" title="Permalink to this headline">¶</a></h4>
<p>We compute the different multivariate information criteria (AIC, BIC, HQIC), and FPE. We pick the set of order parameters that correspond to the lowest values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aic</span><span class="p">,</span> <span class="n">bic</span><span class="p">,</span> <span class="n">fpe</span><span class="p">,</span> <span class="n">hqic</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">VAR</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span> 
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">aic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">aic</span><span class="p">)</span>
    <span class="n">bic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">bic</span><span class="p">)</span>
    <span class="n">fpe</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fpe</span><span class="p">)</span>
    <span class="n">hqic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">hqic</span><span class="p">)</span>
<span class="n">lags_metrics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;AIC&#39;</span><span class="p">:</span> <span class="n">aic</span><span class="p">,</span> 
                                <span class="s1">&#39;BIC&#39;</span><span class="p">:</span> <span class="n">bic</span><span class="p">,</span> 
                                <span class="s1">&#39;HQIC&#39;</span><span class="p">:</span> <span class="n">hqic</span><span class="p">,</span>
                                <span class="s1">&#39;FPE&#39;</span><span class="p">:</span> <span class="n">fpe</span><span class="p">},</span> 
                               <span class="n">index</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>    
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">lags_metrics_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_VectorAutoregressiveMethods_71_0.png" src="../_images/03_VectorAutoregressiveMethods_71_0.png" />
</div>
</div>
<p><strong>Observation/s</strong>:</p>
<p>We find BIC and HQIC to be lowest at <span class="math notranslate nohighlight">\(p=26\)</span>, and we also observe an elbow in the plots for AIC, and FPE, so we choose the number of lags to be 26.</p>
</div>
<div class="section" id="fit-var-model-with-chosen-order">
<h4>3. Fit VAR model with chosen order<a class="headerlink" href="#fit-var-model-with-chosen-order" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">var_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">26</span><span class="p">)</span>
<span class="n">var_model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 401 ms, sys: 39.9 ms, total: 441 ms
Wall time: 202 ms
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Summary of Regression Results   
==================================
Model:                         VAR
Method:                        OLS
Date:           Sun, 21, Feb, 2021
Time:                     00:47:42
--------------------------------------------------------------------
No. of Equations:         3.00000    BIC:                    7.42717
Nobs:                     4404.00    HQIC:                   7.20458
Log likelihood:          -34107.4    FPE:                    1191.88
AIC:                      7.08328    Det(Omega_mle):         1129.97
--------------------------------------------------------------------
Results for equation CO(GT)
==============================================================================
                 coefficient       std. error           t-stat            prob
------------------------------------------------------------------------------
const               0.241332         0.069966            3.449           0.001
L1.CO(GT)           0.961418         0.019229           49.999           0.000
L1.NO2(GT)          0.001992         0.000713            2.794           0.005
L1.RH               0.009321         0.002735            3.409           0.001
L2.CO(GT)          -0.279491         0.026156          -10.686           0.000
L2.NO2(GT)          0.000661         0.000970            0.682           0.495
L2.RH              -0.017300         0.004278           -4.044           0.000
L3.CO(GT)           0.098032         0.026251            3.734           0.000
L3.NO2(GT)         -0.000165         0.000970           -0.170           0.865
L3.RH               0.012764         0.004352            2.933           0.003
L4.CO(GT)          -0.001012         0.026285           -0.038           0.969
L4.NO2(GT)         -0.001148         0.000966           -1.189           0.234
L4.RH              -0.006423         0.004354           -1.475           0.140
L5.CO(GT)           0.054358         0.026291            2.068           0.039
L5.NO2(GT)         -0.001218         0.000966           -1.261           0.207
L5.RH               0.000664         0.004353            0.153           0.879
L6.CO(GT)          -0.017663         0.026308           -0.671           0.502
L6.NO2(GT)          0.000372         0.000966            0.385           0.700
L6.RH               0.000884         0.004351            0.203           0.839
L7.CO(GT)           0.004448         0.026302            0.169           0.866
L7.NO2(GT)          0.000921         0.000967            0.953           0.340
L7.RH              -0.000964         0.004353           -0.221           0.825
L8.CO(GT)          -0.001457         0.026288           -0.055           0.956
L8.NO2(GT)          0.000736         0.000968            0.760           0.447
L8.RH              -0.002357         0.004356           -0.541           0.588
L9.CO(GT)           0.018534         0.026296            0.705           0.481
L9.NO2(GT)         -0.001551         0.000969           -1.601           0.109
L9.RH               0.004720         0.004361            1.082           0.279
L10.CO(GT)         -0.003435         0.026289           -0.131           0.896
L10.NO2(GT)         0.001457         0.000969            1.503           0.133
L10.RH              0.003194         0.004366            0.732           0.464
L11.CO(GT)         -0.021526         0.026286           -0.819           0.413
L11.NO2(GT)        -0.001094         0.000969           -1.128           0.259
L11.RH             -0.001129         0.004367           -0.259           0.796
L12.CO(GT)          0.066587         0.026287            2.533           0.011
L12.NO2(GT)        -0.000285         0.000971           -0.293           0.769
L12.RH             -0.002315         0.004369           -0.530           0.596
L13.CO(GT)         -0.076568         0.026287           -2.913           0.004
L13.NO2(GT)         0.000551         0.000971            0.567           0.571
L13.RH              0.004622         0.004370            1.058           0.290
L14.CO(GT)          0.100874         0.026293            3.837           0.000
L14.NO2(GT)        -0.003074         0.000971           -3.165           0.002
L14.RH              0.001720         0.004371            0.394           0.694
L15.CO(GT)         -0.039783         0.026318           -1.512           0.131
L15.NO2(GT)         0.000926         0.000971            0.953           0.340
L15.RH             -0.002928         0.004370           -0.670           0.503
L16.CO(GT)          0.009289         0.026276            0.354           0.724
L16.NO2(GT)         0.000818         0.000969            0.845           0.398
L16.RH             -0.001466         0.004369           -0.336           0.737
L17.CO(GT)         -0.030972         0.026264           -1.179           0.238
L17.NO2(GT)         0.000273         0.000969            0.281           0.778
L17.RH              0.000574         0.004369            0.131           0.895
L18.CO(GT)          0.021964         0.026242            0.837           0.403
L18.NO2(GT)        -0.001183         0.000968           -1.222           0.222
L18.RH              0.003188         0.004366            0.730           0.465
L19.CO(GT)          0.048666         0.026200            1.858           0.063
L19.NO2(GT)        -0.000539         0.000966           -0.558           0.577
L19.RH             -0.010088         0.004362           -2.313           0.021
L20.CO(GT)         -0.065842         0.026213           -2.512           0.012
L20.NO2(GT)         0.000847         0.000965            0.878           0.380
L20.RH              0.008736         0.004363            2.002           0.045
L21.CO(GT)         -0.032047         0.026233           -1.222           0.222
L21.NO2(GT)         0.001082         0.000964            1.122           0.262
L21.RH             -0.004805         0.004360           -1.102           0.270
L22.CO(GT)          0.050969         0.026220            1.944           0.052
L22.NO2(GT)        -0.000471         0.000964           -0.489           0.625
L22.RH              0.000472         0.004360            0.108           0.914
L23.CO(GT)          0.071433         0.026226            2.724           0.006
L23.NO2(GT)         0.001170         0.000964            1.214           0.225
L23.RH             -0.003465         0.004361           -0.794           0.427
L24.CO(GT)          0.198774         0.026160            7.598           0.000
L24.NO2(GT)        -0.000280         0.000968           -0.289           0.772
L24.RH              0.001856         0.004361            0.425           0.670
L25.CO(GT)         -0.156857         0.026043           -6.023           0.000
L25.NO2(GT)         0.000666         0.000967            0.689           0.491
L25.RH              0.000979         0.004290            0.228           0.820
L26.CO(GT)         -0.047697         0.019186           -2.486           0.013
L26.NO2(GT)        -0.001958         0.000710           -2.757           0.006
L26.RH             -0.000747         0.002746           -0.272           0.786
==============================================================================

Results for equation NO2(GT)
==============================================================================
                 coefficient       std. error           t-stat            prob
------------------------------------------------------------------------------
const              12.417213         1.871552            6.635           0.000
L1.CO(GT)           1.600229         0.514359            3.111           0.002
L1.NO2(GT)          0.953169         0.019069           49.986           0.000
L1.RH               0.239537         0.073150            3.275           0.001
L2.CO(GT)          -2.404892         0.699653           -3.437           0.001
L2.NO2(GT)         -0.096250         0.025935           -3.711           0.000
L2.RH              -0.332820         0.114442           -2.908           0.004
L3.CO(GT)           0.154091         0.702192            0.219           0.826
L3.NO2(GT)          0.018241         0.025946            0.703           0.482
L3.RH               0.180558         0.116422            1.551           0.121
L4.CO(GT)           1.160555         0.703122            1.651           0.099
L4.NO2(GT)         -0.065148         0.025831           -2.522           0.012
L4.RH              -0.149770         0.116468           -1.286           0.198
L5.CO(GT)          -0.209355         0.703264           -0.298           0.766
L5.NO2(GT)          0.007011         0.025834            0.271           0.786
L5.RH               0.023622         0.116443            0.203           0.839
L6.CO(GT)           0.742858         0.703728            1.056           0.291
L6.NO2(GT)         -0.029688         0.025847           -1.149           0.251
L6.RH               0.014889         0.116384            0.128           0.898
L7.CO(GT)          -0.535398         0.703562           -0.761           0.447
L7.NO2(GT)          0.089765         0.025857            3.472           0.001
L7.RH              -0.106262         0.116432           -0.913           0.361
L8.CO(GT)          -1.025553         0.703193           -1.458           0.145
L8.NO2(GT)         -0.034196         0.025895           -1.321           0.187
L8.RH               0.127190         0.116517            1.092           0.275
L9.CO(GT)           0.313129         0.703395            0.445           0.656
L9.NO2(GT)          0.005236         0.025910            0.202           0.840
L9.RH              -0.136264         0.116667           -1.168           0.243
L10.CO(GT)         -0.507195         0.703213           -0.721           0.471
L10.NO2(GT)         0.000967         0.025922            0.037           0.970
L10.RH              0.209375         0.116786            1.793           0.073
L11.CO(GT)         -1.319501         0.703135           -1.877           0.061
L11.NO2(GT)         0.069145         0.025930            2.667           0.008
L11.RH             -0.053156         0.116828           -0.455           0.649
L12.CO(GT)          2.602906         0.703181            3.702           0.000
L12.NO2(GT)        -0.076889         0.025968           -2.961           0.003
L12.RH             -0.044469         0.116867           -0.381           0.704
L13.CO(GT)         -2.098667         0.703156           -2.985           0.003
L13.NO2(GT)         0.068250         0.025986            2.626           0.009
L13.RH              0.164246         0.116893            1.405           0.160
L14.CO(GT)          1.141015         0.703317            1.622           0.105
L14.NO2(GT)        -0.077485         0.025985           -2.982           0.003
L14.RH              0.121439         0.116918            1.039           0.299
L15.CO(GT)          0.157231         0.704010            0.223           0.823
L15.NO2(GT)         0.016822         0.025982            0.647           0.517
L15.RH             -0.173595         0.116888           -1.485           0.138
L16.CO(GT)          0.878201         0.702861            1.249           0.211
L16.NO2(GT)         0.003234         0.025923            0.125           0.901
L16.RH             -0.029109         0.116858           -0.249           0.803
L17.CO(GT)         -1.418159         0.702559           -2.019           0.044
L17.NO2(GT)         0.016251         0.025913            0.627           0.531
L17.RH             -0.015862         0.116863           -0.136           0.892
L18.CO(GT)          0.655452         0.701962            0.934           0.350
L18.NO2(GT)        -0.021180         0.025901           -0.818           0.414
L18.RH              0.128568         0.116801            1.101           0.271
L19.CO(GT)         -0.024839         0.700835           -0.035           0.972
L19.NO2(GT)         0.001731         0.025844            0.067           0.947
L19.RH             -0.247871         0.116687           -2.124           0.034
L20.CO(GT)         -0.810637         0.701198           -1.156           0.248
L20.NO2(GT)         0.008661         0.025806            0.336           0.737
L20.RH              0.082541         0.116699            0.707           0.479
L21.CO(GT)         -0.268031         0.701722           -0.382           0.702
L21.NO2(GT)         0.006716         0.025794            0.260           0.795
L21.RH             -0.148403         0.116634           -1.272           0.203
L22.CO(GT)          0.551561         0.701384            0.786           0.432
L22.NO2(GT)         0.029776         0.025786            1.155           0.248
L22.RH              0.137999         0.116639            1.183           0.237
L23.CO(GT)          0.396023         0.701541            0.565           0.572
L23.NO2(GT)         0.141030         0.025786            5.469           0.000
L23.RH             -0.095500         0.116666           -0.819           0.413
L24.CO(GT)          0.359015         0.699771            0.513           0.608
L24.NO2(GT)         0.081228         0.025886            3.138           0.002
L24.RH              0.027786         0.116658            0.238           0.812
L25.CO(GT)         -1.491610         0.696641           -2.141           0.032
L25.NO2(GT)        -0.067370         0.025857           -2.605           0.009
L25.RH             -0.015628         0.114756           -0.136           0.892
L26.CO(GT)          0.583311         0.513221            1.137           0.256
L26.NO2(GT)        -0.100912         0.018999           -5.311           0.000
L26.RH              0.021928         0.073465            0.298           0.765
==============================================================================

Results for equation RH
==============================================================================
                 coefficient       std. error           t-stat            prob
------------------------------------------------------------------------------
const               1.708989         0.393111            4.347           0.000
L1.CO(GT)          -0.043025         0.108039           -0.398           0.690
L1.NO2(GT)         -0.010353         0.004005           -2.585           0.010
L1.RH               1.209022         0.015365           78.688           0.000
L2.CO(GT)          -0.237686         0.146959           -1.617           0.106
L2.NO2(GT)          0.010539         0.005448            1.935           0.053
L2.RH              -0.290694         0.024038          -12.093           0.000
L3.CO(GT)           0.154914         0.147492            1.050           0.294
L3.NO2(GT)         -0.002859         0.005450           -0.525           0.600
L3.RH               0.052192         0.024454            2.134           0.033
L4.CO(GT)           0.095980         0.147688            0.650           0.516
L4.NO2(GT)          0.003434         0.005426            0.633           0.527
L4.RH              -0.021893         0.024464           -0.895           0.371
L5.CO(GT)          -0.035423         0.147718           -0.240           0.810
L5.NO2(GT)         -0.002389         0.005426           -0.440           0.660
L5.RH               0.037941         0.024458            1.551           0.121
L6.CO(GT)          -0.040464         0.147815           -0.274           0.784
L6.NO2(GT)          0.001410         0.005429            0.260           0.795
L6.RH              -0.074252         0.024446           -3.037           0.002
L7.CO(GT)          -0.012767         0.147780           -0.086           0.931
L7.NO2(GT)          0.007474         0.005431            1.376           0.169
L7.RH               0.040664         0.024456            1.663           0.096
L8.CO(GT)           0.080673         0.147703            0.546           0.585
L8.NO2(GT)          0.001860         0.005439            0.342           0.732
L8.RH              -0.076619         0.024474           -3.131           0.002
L9.CO(GT)           0.047686         0.147745            0.323           0.747
L9.NO2(GT)         -0.004802         0.005442           -0.882           0.378
L9.RH               0.063403         0.024505            2.587           0.010
L10.CO(GT)          0.050348         0.147707            0.341           0.733
L10.NO2(GT)         0.004929         0.005445            0.905           0.365
L10.RH             -0.044706         0.024530           -1.822           0.068
L11.CO(GT)          0.117202         0.147691            0.794           0.427
L11.NO2(GT)        -0.002450         0.005446           -0.450           0.653
L11.RH              0.050771         0.024539            2.069           0.039
L12.CO(GT)          0.081156         0.147700            0.549           0.583
L12.NO2(GT)        -0.002690         0.005454           -0.493           0.622
L12.RH             -0.040349         0.024547           -1.644           0.100
L13.CO(GT)         -0.028788         0.147695           -0.195           0.845
L13.NO2(GT)         0.000768         0.005458            0.141           0.888
L13.RH              0.020414         0.024553            0.831           0.406
L14.CO(GT)         -0.078942         0.147729           -0.534           0.593
L14.NO2(GT)        -0.002734         0.005458           -0.501           0.616
L14.RH             -0.000282         0.024558           -0.011           0.991
L15.CO(GT)         -0.144161         0.147874           -0.975           0.330
L15.NO2(GT)         0.002442         0.005457            0.448           0.654
L15.RH              0.030373         0.024552            1.237           0.216
L16.CO(GT)         -0.001777         0.147633           -0.012           0.990
L16.NO2(GT)         0.002061         0.005445            0.379           0.705
L16.RH             -0.049313         0.024546           -2.009           0.045
L17.CO(GT)          0.046799         0.147569            0.317           0.751
L17.NO2(GT)        -0.007569         0.005443           -1.391           0.164
L17.RH              0.033906         0.024547            1.381           0.167
L18.CO(GT)         -0.080688         0.147444           -0.547           0.584
L18.NO2(GT)         0.006073         0.005440            1.116           0.264
L18.RH              0.006116         0.024533            0.249           0.803
L19.CO(GT)          0.269110         0.147207            1.828           0.068
L19.NO2(GT)        -0.004253         0.005429           -0.784           0.433
L19.RH             -0.011621         0.024510           -0.474           0.635
L20.CO(GT)         -0.324511         0.147284           -2.203           0.028
L20.NO2(GT)         0.000789         0.005420            0.145           0.884
L20.RH              0.041952         0.024512            1.711           0.087
L21.CO(GT)          0.177418         0.147394            1.204           0.229
L21.NO2(GT)         0.005398         0.005418            0.996           0.319
L21.RH             -0.037378         0.024499           -1.526           0.127
L22.CO(GT)          0.124107         0.147323            0.842           0.400
L22.NO2(GT)        -0.006135         0.005416           -1.133           0.257
L22.RH              0.041857         0.024500            1.708           0.088
L23.CO(GT)         -0.041076         0.147356           -0.279           0.780
L23.NO2(GT)        -0.005205         0.005416           -0.961           0.337
L23.RH              0.047960         0.024505            1.957           0.050
L24.CO(GT)          0.171936         0.146984            1.170           0.242
L24.NO2(GT)         0.003821         0.005437            0.703           0.482
L24.RH              0.010637         0.024503            0.434           0.664
L25.CO(GT)         -0.302108         0.146326           -2.065           0.039
L25.NO2(GT)         0.007458         0.005431            1.373           0.170
L25.RH             -0.034121         0.024104           -1.416           0.157
L26.CO(GT)          0.150202         0.107800            1.393           0.164
L26.NO2(GT)        -0.008683         0.003991           -2.176           0.030
L26.RH             -0.041247         0.015431           -2.673           0.008
==============================================================================

Correlation matrix of residuals
             CO(GT)   NO2(GT)        RH
CO(GT)     1.000000  0.606004  0.150771
NO2(GT)    0.606004  1.000000  0.078143
RH         0.150771  0.078143  1.000000
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="get-forecast">
<h4>4. Get forecast<a class="headerlink" href="#get-forecast" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">forecast_var</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">var_model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
                                              <span class="n">steps</span><span class="o">=</span><span class="n">forecast_length</span><span class="p">),</span> 
                           <span class="n">columns</span><span class="o">=</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> 
                           <span class="n">index</span><span class="o">=</span><span class="n">test_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">forecast_var</span> <span class="o">=</span> <span class="n">forecast_var</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="o">+</span><span class="s1">&#39;-VAR&#39;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">forecast_var</span><span class="o">.</span><span class="n">columns</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train_df</span><span class="p">[[</span><span class="n">c</span><span class="p">]],</span> <span class="n">forecast_var</span><span class="p">[[</span><span class="n">c</span><span class="o">+</span><span class="s1">&#39;-VAR&#39;</span><span class="p">]]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2005-03-01&#39;</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="c1">#     plt.tight_layout()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_VectorAutoregressiveMethods_77_0.png" src="../_images/03_VectorAutoregressiveMethods_77_0.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_77_1.png" src="../_images/03_VectorAutoregressiveMethods_77_1.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_77_2.png" src="../_images/03_VectorAutoregressiveMethods_77_2.png" />
</div>
</div>
</div>
<div class="section" id="performance-evaluation-comparison-with-arima-model">
<h4>Performance Evaluation: Comparison with ARIMA model<a class="headerlink" href="#performance-evaluation-comparison-with-arima-model" title="Permalink to this headline">¶</a></h4>
<p>When using ARIMA, we treat each variable as a univariate time series, and we perform the forecasting for each variable: 1 for CO, 1 for NO2, and 1 for RH</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For model order selection, refer to Chapter 1</span>
<span class="n">selected_order</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;CO(GT)&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
                  <span class="s1">&#39;NO2(GT)&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
                  <span class="s1">&#39;RH&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">forecast_arima</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
    <span class="n">forecast_arima</span><span class="p">[</span><span class="n">c</span><span class="o">+</span><span class="s1">&#39;-ARIMA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">forecast_arima</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
                                                      <span class="n">test_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
                                                      <span class="n">order</span><span class="o">=</span><span class="n">selected_order</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="n">forecast_arima</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">forecast_arima</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">forecast_var</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">forecast_arima</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 4.32 s, sys: 268 ms, total: 4.58 s
Wall time: 1.48 s
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CO(GT)-ARIMA</th>
      <th>NO2(GT)-ARIMA</th>
      <th>RH-ARIMA</th>
    </tr>
    <tr>
      <th>Date_Time</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2005-04-03 15:00:00</th>
      <td>0.999865</td>
      <td>87.002935</td>
      <td>14.502893</td>
    </tr>
    <tr>
      <th>2005-04-03 16:00:00</th>
      <td>0.999729</td>
      <td>87.005870</td>
      <td>16.743239</td>
    </tr>
    <tr>
      <th>2005-04-03 17:00:00</th>
      <td>0.999594</td>
      <td>87.008806</td>
      <td>19.253414</td>
    </tr>
    <tr>
      <th>2005-04-03 18:00:00</th>
      <td>0.999458</td>
      <td>87.011741</td>
      <td>21.715709</td>
    </tr>
    <tr>
      <th>2005-04-03 19:00:00</th>
      <td>0.999323</td>
      <td>87.014676</td>
      <td>23.974483</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">forecasts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">forecast_arima</span><span class="p">,</span> <span class="n">forecast_var</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">plot_forecasts_static</span><span class="p">(</span><span class="n">train_df</span><span class="o">=</span><span class="n">train_df</span><span class="p">,</span>
                                          <span class="n">test_df</span><span class="o">=</span><span class="n">test_df</span><span class="p">,</span> 
                                          <span class="n">forecast_df</span><span class="o">=</span><span class="n">forecasts</span><span class="p">,</span> 
                                          <span class="n">column_name</span><span class="o">=</span><span class="n">c</span><span class="p">,</span>
                                          <span class="n">min_train_date</span><span class="o">=</span><span class="s1">&#39;2005-04-01&#39;</span><span class="p">,</span> 
                                          <span class="n">suffix</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-VAR&#39;</span><span class="p">,</span> <span class="s1">&#39;-ARIMA&#39;</span><span class="p">],</span>
                                          <span class="n">title</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_VectorAutoregressiveMethods_82_0.png" src="../_images/03_VectorAutoregressiveMethods_82_0.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_82_1.png" src="../_images/03_VectorAutoregressiveMethods_82_1.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_82_2.png" src="../_images/03_VectorAutoregressiveMethods_82_2.png" />
</div>
</div>
<p><strong>Performance Metrics</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">utils</span><span class="o">.</span><span class="n">test_performance_metrics</span><span class="p">(</span><span class="n">test_df</span><span class="p">,</span> <span class="n">forecast_var</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;-VAR&#39;</span><span class="p">),</span>
           <span class="n">utils</span><span class="o">.</span><span class="n">test_performance_metrics</span><span class="p">(</span><span class="n">test_df</span><span class="p">,</span> <span class="n">forecast_arima</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;-ARIMA&#39;</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CO(GT)-VAR</th>
      <th>NO2(GT)-VAR</th>
      <th>RH-VAR</th>
      <th>CO(GT)-ARIMA</th>
      <th>NO2(GT)-ARIMA</th>
      <th>RH-ARIMA</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MAE</th>
      <td>0.685005</td>
      <td>31.687612</td>
      <td>9.748883</td>
      <td>1.057097</td>
      <td>59.283376</td>
      <td>16.239017</td>
    </tr>
    <tr>
      <th>MSE</th>
      <td>1.180781</td>
      <td>1227.046604</td>
      <td>111.996306</td>
      <td>2.163021</td>
      <td>4404.904459</td>
      <td>333.622140</td>
    </tr>
    <tr>
      <th>MAPE</th>
      <td>43.508500</td>
      <td>29.811066</td>
      <td>35.565987</td>
      <td>56.960617</td>
      <td>46.190671</td>
      <td>51.199023</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Observation/s</strong>:</p>
<ul class="simple">
<li><p>MAE: VAR forecasts have lower errors than ARIMA forecasts for CO and NO2 but not in RH.</p></li>
<li><p>MSE: VAR forecasts have lower errors for all variables (CO, NO2 and RH).</p></li>
<li><p>MAPE: VAR forecasts have lower errors for all variables (CO, NO2 and RH).</p></li>
<li><p>Training time is significantly reduced when using VAR compared to ARIMA (&lt;0.1s run time for VAR while ~20s for ARIMA)</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="structural-var-analysis">
<h2>Structural VAR Analysis<a class="headerlink" href="#structural-var-analysis" title="Permalink to this headline">¶</a></h2>
<p>In addition to forecasting, VAR models are also used for structural inference and policy analysis. In macroeconomics, this structural analysis has been extensively employed to investigate the transmission mechanisms of macroeconomic shocks (e.g., monetary shocks, financial shocks) and test economic theories. There are particular assumptions imposed about the causal structure of the dataset, and the resulting causal impacts of unexpected shocks (also called innovations or perturbations) to a specific variable on the different variables in the model are summarized. In this section, we cover two of the common methods in summarizing the effects of these causal impacts: (1) impulse response functions, and (2): forecast error variance decompositions.</p>
<div class="section" id="impulse-response-function-irf">
<h3>Impulse Response Function (IRF)<a class="headerlink" href="#impulse-response-function-irf" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Coefficients of the VAR models are often difficult to interpret so practitioners often estimate the impulse response function.</p></li>
<li><p>IRFs trace out the time path of the effects of an exogenous shock to one (or more) of the endogenous variables on some or all of the other variables in a VAR system.</p></li>
<li><p>IRF traces out the response of the dependent variable of the VAR system to shocks (also called innovations or impulses) in the error terms.</p></li>
</ul>
<div class="section" id="irf-in-the-var-system-for-air-quality">
<h4>IRF in the VAR system for Air Quality<a class="headerlink" href="#irf-in-the-var-system-for-air-quality" title="Permalink to this headline">¶</a></h4>
<p>Let <span class="math notranslate nohighlight">\(y_{1,t}\)</span>, <span class="math notranslate nohighlight">\(y_{2,t}\)</span> and <span class="math notranslate nohighlight">\(y_{3,t}\)</span> be the time series corresponding to CO signal, NO2 signal, and RH signal, respectively. Consider the moving average representation of the system shown below:</p>
<p>Let
<img alt="../_images/irf_eq.png" src="../_images/irf_eq.png" /></p>
<p>Suppose <span class="math notranslate nohighlight">\(u_1\)</span> in the first equation increases by a value of one standard deviation.</p>
<ul class="simple">
<li><p>This shock will change <span class="math notranslate nohighlight">\(y_1\)</span> in the current as well as the future periods.</p></li>
<li><p>This shock will also have an impact on <span class="math notranslate nohighlight">\(y_2\)</span> and <span class="math notranslate nohighlight">\(y_3\)</span>.</p></li>
</ul>
<p>Suppose <span class="math notranslate nohighlight">\(u_2\)</span> in the second equation increases by a value of one standard deviation.</p>
<ul class="simple">
<li><p>This shock will change <span class="math notranslate nohighlight">\(y_2\)</span> in the current as well as the future periods.</p></li>
<li><p>This shock will also have an impact on <span class="math notranslate nohighlight">\(y_1\)</span> and <span class="math notranslate nohighlight">\(y_3\)</span>.</p></li>
</ul>
<p>Suppose <span class="math notranslate nohighlight">\(u_3\)</span> in the third equation increases by a value of one standard deviation.</p>
<ul class="simple">
<li><p>This shock will change <span class="math notranslate nohighlight">\(y_3\)</span> in the current as well as the future periods.</p></li>
<li><p>This shock will also have an impact on <span class="math notranslate nohighlight">\(y_1\)</span> and <span class="math notranslate nohighlight">\(y_2\)</span>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">irf</span> <span class="o">=</span> <span class="n">var_model</span><span class="o">.</span><span class="n">irf</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">irf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">orth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
              <span class="n">subplot_params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_VectorAutoregressiveMethods_91_0.png" src="../_images/03_VectorAutoregressiveMethods_91_0.png" />
</div>
</div>
<p><strong>Observation/s:</strong></p>
<p><em>Effects of exogenous perturbation/shocks (1SD) of a variable on itself:</em></p>
<ul class="simple">
<li><p>CO <span class="math notranslate nohighlight">\(\rightarrow\)</span> CO: A shock in the value of CO has a larger effect CO in the early hours but this decays over time.</p></li>
<li><p>NO2 <span class="math notranslate nohighlight">\(\rightarrow\)</span> NO2: A shock in the value of NO2 has a larger effect NO2 in the early hours but this decays over time.</p></li>
<li><p>RH <span class="math notranslate nohighlight">\(\rightarrow\)</span> RH: A shock in the value of RH has a largest effect in RH after 1 hour and this effect decays over time.</p></li>
</ul>
<p><em>Effects of exogenous perturbation/shocks of a variable on another:</em></p>
<ul class="simple">
<li><p>CO <span class="math notranslate nohighlight">\(\rightarrow\)</span> NO2: A shock in the value of CO has a largest effect in NO2 after 1 hour and this effect decays over time.</p></li>
<li><p>CO <span class="math notranslate nohighlight">\(\rightarrow\)</span> RH: A shock in the value of CO has an immediate effect in the value of RH. However, the effect decreases immediately after an hour, and the value seems to stay at around 0.2.</p></li>
<li><p>NO2 <span class="math notranslate nohighlight">\(\rightarrow\)</span> CO: A shock in NO2 only causes a small effect in the values of CO. There seems to be a delayed effect, peaking after 3 hours, but the magnitude is still small.</p></li>
<li><p>NO2 <span class="math notranslate nohighlight">\(\rightarrow\)</span> RH: A shock in NO2 causes a small (negative) effect in the values of RH. The magnitude seems to decline further after 6 hours. The value of the IRF reaches zero in about 7 hours.</p></li>
<li><p>RH <span class="math notranslate nohighlight">\(\rightarrow\)</span> CO: A shock in RH only causes a small effect in the values of CO.</p></li>
<li><p>RH <span class="math notranslate nohighlight">\(\rightarrow\)</span> NO2: A shock in the value of RH has a largest effect in NO2 after 1 hour and this effect decays over time. The value of the IRF reaches zero after 6 hours.</p></li>
</ul>
</div>
</div>
<div class="section" id="forecast-error-variance-decomposition-fevd">
<h3>Forecast Error Variance Decomposition (FEVD)<a class="headerlink" href="#forecast-error-variance-decomposition-fevd" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>FEVD indicates the amount of information each variable contributes to the other variables in the autoregression</p></li>
<li><p>While impulse response functions trace the effects of a shock to one endogenous variable on to the other variables in the VAR, variance decomposition separates the variation in an endogenous variable into the component shocks to the VAR.</p></li>
<li><p>It determines how much of the forecast error variance of each of the variables can be explained by exogenous shocks to the other variables.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fevd</span> <span class="o">=</span> <span class="n">var_model</span><span class="o">.</span><span class="n">fevd</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fevd</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_VectorAutoregressiveMethods_94_0.png" src="../_images/03_VectorAutoregressiveMethods_94_0.png" />
</div>
</div>
<p><strong>Observation/s:</strong></p>
<ul class="simple">
<li><p>For CO, the variance is mostly explained by exogenous shocks to CO. This decreases over time but only by a small amount.</p></li>
<li><p>For NO2, the variance is mostly explained by exogenous shocks to NO2 and CO.</p></li>
<li><p>For RH, the variance is mostly explained by exogenous shocks to RH. Over time, the contribution of the exogenous shocks to CO increases.</p></li>
</ul>
</div>
<div class="section" id="example-3-forecasting-the-jena-climate-data">
<h3>Example 3: Forecasting the Jena climate data<a class="headerlink" href="#example-3-forecasting-the-jena-climate-data" title="Permalink to this headline">¶</a></h3>
<p>We try to forecast the Jena climate data using the method outlined above. We will train the VAR model using hourly weather measurements from January 1, 2019 (00:10) up to December 29, 2014 (18:10). The performance of the model will be evaluated on the test set which contains data from December 29, 2014 (19:10) to December 31, 2014 (23:20) which is equivalent to 17,523 data points for each of the variables.</p>
<div class="section" id="load-dataset">
<h4>Load dataset<a class="headerlink" href="#load-dataset" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/train_series_datetime.csv&#39;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date Time&#39;</span><span class="p">)</span>
<span class="n">val_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/val_series_datetime.csv&#39;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date Time&#39;</span><span class="p">)</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/test_series_datetime.csv&#39;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date Time&#39;</span><span class="p">)</span>
<span class="n">train_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">val_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">val_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">test_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">test_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_val_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train_df</span><span class="p">,</span> <span class="n">val_df</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="check-stationarity-of-each-variable-using-adf-test">
<h4>Check stationarity of each variable using ADF test<a class="headerlink" href="#check-stationarity-of-each-variable-using-adf-test" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">test_stat</span><span class="p">,</span> <span class="n">p_val</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="n">cv_1pct</span><span class="p">,</span> <span class="n">cv_5pct</span><span class="p">,</span> <span class="n">cv_10pct</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">train_val_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span> 
    <span class="n">adf_res</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">train_val_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
    <span class="n">test_stat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">p_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cv_1pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="s1">&#39;1%&#39;</span><span class="p">])</span>
    <span class="n">cv_5pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="s1">&#39;5%&#39;</span><span class="p">])</span>
    <span class="n">cv_10pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="s1">&#39;10%&#39;</span><span class="p">])</span>
<span class="n">adf_res_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Test statistic&#39;</span><span class="p">:</span> <span class="n">test_stat</span><span class="p">,</span> 
                           <span class="s1">&#39;p-value&#39;</span><span class="p">:</span> <span class="n">p_val</span><span class="p">,</span> 
                           <span class="s1">&#39;Critical value - 1%&#39;</span><span class="p">:</span> <span class="n">cv_1pct</span><span class="p">,</span>
                           <span class="s1">&#39;Critical value - 5%&#39;</span><span class="p">:</span> <span class="n">cv_5pct</span><span class="p">,</span>
                           <span class="s1">&#39;Critical value - 10%&#39;</span><span class="p">:</span> <span class="n">cv_10pct</span><span class="p">},</span> 
                         <span class="n">index</span><span class="o">=</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">adf_res_df</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 3min 11s, sys: 25.8 s, total: 3min 37s
Wall time: 57.2 s
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>p (mbar)</th>
      <th>T (degC)</th>
      <th>Tpot (K)</th>
      <th>Tdew (degC)</th>
      <th>rh (%)</th>
      <th>VPmax (mbar)</th>
      <th>VPact (mbar)</th>
      <th>VPdef (mbar)</th>
      <th>sh (g/kg)</th>
      <th>H2OC (mmol/mol)</th>
      <th>rho (g/m**3)</th>
      <th>wv (m/s)</th>
      <th>max. wv (m/s)</th>
      <th>wd (deg)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>-15.5867</td>
      <td>-7.9586</td>
      <td>-8.3354</td>
      <td>-8.5750</td>
      <td>-17.7069</td>
      <td>-9.1945</td>
      <td>-9.0103</td>
      <td>-13.5492</td>
      <td>-9.0827</td>
      <td>-9.0709</td>
      <td>-9.3980</td>
      <td>-24.2424</td>
      <td>-24.3052</td>
      <td>-19.8394</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>-3.4305</td>
      <td>-3.4305</td>
      <td>-3.4305</td>
      <td>-3.4305</td>
      <td>-3.4305</td>
      <td>-3.4305</td>
      <td>-3.4305</td>
      <td>-3.4305</td>
      <td>-3.4305</td>
      <td>-3.4305</td>
      <td>-3.4305</td>
      <td>-3.4305</td>
      <td>-3.4305</td>
      <td>-3.4305</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>-2.8616</td>
      <td>-2.8616</td>
      <td>-2.8616</td>
      <td>-2.8616</td>
      <td>-2.8616</td>
      <td>-2.8616</td>
      <td>-2.8616</td>
      <td>-2.8616</td>
      <td>-2.8616</td>
      <td>-2.8616</td>
      <td>-2.8616</td>
      <td>-2.8616</td>
      <td>-2.8616</td>
      <td>-2.8616</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>-2.5668</td>
      <td>-2.5668</td>
      <td>-2.5668</td>
      <td>-2.5668</td>
      <td>-2.5668</td>
      <td>-2.5668</td>
      <td>-2.5668</td>
      <td>-2.5668</td>
      <td>-2.5668</td>
      <td>-2.5668</td>
      <td>-2.5668</td>
      <td>-2.5668</td>
      <td>-2.5668</td>
      <td>-2.5668</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">((</span><span class="n">adf_res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Test statistic&#39;</span><span class="p">]</span><span class="o">&lt;</span> <span class="n">adf_res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Critical value - 1%&#39;</span><span class="p">])</span> <span class="o">&amp;</span> 
<span class="p">(</span><span class="n">adf_res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Test statistic&#39;</span><span class="p">]</span><span class="o">&lt;</span> <span class="n">adf_res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Critical value - 5%&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
<span class="p">(</span> <span class="n">adf_res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Test statistic&#39;</span><span class="p">]</span><span class="o">&lt;</span> <span class="n">adf_res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Critical value - 10%&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>p (mbar)           True
T (degC)           True
Tpot (K)           True
Tdew (degC)        True
rh (%)             True
VPmax (mbar)       True
VPact (mbar)       True
VPdef (mbar)       True
sh (g/kg)          True
H2OC (mmol/mol)    True
rho (g/m**3)       True
wv (m/s)           True
max. wv (m/s)      True
wd (deg)           True
dtype: bool
</pre></div>
</div>
</div>
</div>
<p><strong>Observation/s</strong>:</p>
<p>From the values above, all the components of the Jena climate data are stationary, so we’ll use all the variables in our VAR model.</p>
</div>
<div class="section" id="id1">
<h4>Select order p<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">aic</span><span class="p">,</span> <span class="n">bic</span><span class="p">,</span> <span class="n">fpe</span><span class="p">,</span> <span class="n">hqic</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">VAR</span><span class="p">(</span><span class="n">train_val_df</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">aic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">aic</span><span class="p">)</span>
    <span class="n">bic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">bic</span><span class="p">)</span>
    <span class="n">fpe</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fpe</span><span class="p">)</span>
    <span class="n">hqic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">hqic</span><span class="p">)</span>
<span class="n">lags_metrics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;AIC&#39;</span><span class="p">:</span> <span class="n">aic</span><span class="p">,</span> 
                                <span class="s1">&#39;BIC&#39;</span><span class="p">:</span> <span class="n">bic</span><span class="p">,</span> 
                                <span class="s1">&#39;HQIC&#39;</span><span class="p">:</span> <span class="n">hqic</span><span class="p">,</span>
                                <span class="s1">&#39;FPE&#39;</span><span class="p">:</span> <span class="n">fpe</span><span class="p">},</span> 
                               <span class="n">index</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>    
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">lags_metrics_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 2min 57s, sys: 14.3 s, total: 3min 11s
Wall time: 1min
</pre></div>
</div>
<img alt="../_images/03_VectorAutoregressiveMethods_106_1.png" src="../_images/03_VectorAutoregressiveMethods_106_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lags_metrics_df</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AIC     51
BIC      5
HQIC    26
FPE     51
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lags_metrics_df</span><span class="p">[</span><span class="mi">25</span><span class="p">:]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AIC     51
BIC     26
HQIC    26
FPE     51
dtype: int64
</pre></div>
</div>
</div>
</div>
<p><strong>Observation/s</strong>:</p>
<p>The model order that resulted to the minimum value varies for each information criteria, showing no clear minimum. We see an elbow at <span class="math notranslate nohighlight">\(p=5\)</span>, but if we look at AIC and HQIC we’re observing another elbow/local minimum at <span class="math notranslate nohighlight">\(p=26\)</span>. So, we choose <span class="math notranslate nohighlight">\(p=26\)</span> as our lag length.</p>
</div>
<div class="section" id="train-var-model-using-the-training-and-validation-data">
<h4>Train VAR model using the training and validation data<a class="headerlink" href="#train-var-model-using-the-training-and-validation-data" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">var_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">26</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 1.38 s, sys: 151 ms, total: 1.53 s
Wall time: 631 ms
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_df</span><span class="p">)</span><span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_df</span><span class="p">))</span><span class="o">%</span><span class="k">24</span>).reshape((-1, 24))
<span class="n">fit_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">test_index</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_index</span><span class="p">))]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="forecast-24-hour-weather-measurements-and-evaluate-performance-on-test-set">
<h4>Forecast 24-hour weather measurements and evaluate performance on test set<a class="headerlink" href="#forecast-24-hour-weather-measurements-and-evaluate-performance-on-test-set" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">forecasts_df</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fit_index</span><span class="p">)):</span>
    <span class="n">forecast_var</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">var_model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train_val_df</span><span class="p">,</span> <span class="n">test_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">fit_index</span><span class="p">[</span><span class="n">n</span><span class="p">]]])</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">24</span><span class="p">),</span> 
                                <span class="n">columns</span><span class="o">=</span><span class="n">train_val_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> 
                                <span class="n">index</span><span class="o">=</span><span class="n">test_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_index</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">forecasts_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">forecast_var</span><span class="p">)</span>
<span class="n">forecasts_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">forecasts_df</span><span class="p">)</span>
<span class="n">forecasts_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">forecasts_df</span><span class="o">.</span><span class="n">columns</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;-VAR&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">train_val_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">train_val_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">forecasts_df</span><span class="p">[[</span><span class="n">c</span><span class="o">+</span><span class="s1">&#39;-VAR&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">train_val_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">train_val_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_VectorAutoregressiveMethods_115_0.png" src="../_images/03_VectorAutoregressiveMethods_115_0.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_115_1.png" src="../_images/03_VectorAutoregressiveMethods_115_1.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_115_2.png" src="../_images/03_VectorAutoregressiveMethods_115_2.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_115_3.png" src="../_images/03_VectorAutoregressiveMethods_115_3.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_115_4.png" src="../_images/03_VectorAutoregressiveMethods_115_4.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_115_5.png" src="../_images/03_VectorAutoregressiveMethods_115_5.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_115_6.png" src="../_images/03_VectorAutoregressiveMethods_115_6.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_115_7.png" src="../_images/03_VectorAutoregressiveMethods_115_7.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_115_8.png" src="../_images/03_VectorAutoregressiveMethods_115_8.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_115_9.png" src="../_images/03_VectorAutoregressiveMethods_115_9.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_115_10.png" src="../_images/03_VectorAutoregressiveMethods_115_10.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_115_11.png" src="../_images/03_VectorAutoregressiveMethods_115_11.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_115_12.png" src="../_images/03_VectorAutoregressiveMethods_115_12.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_115_13.png" src="../_images/03_VectorAutoregressiveMethods_115_13.png" />
</div>
</div>
<p><em><strong>Evaluate forecasts</strong></em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">utils</span><span class="o">.</span><span class="n">test_performance_metrics</span><span class="p">(</span><span class="n">test_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">forecasts_df</span><span class="o">.</span><span class="n">index</span><span class="p">],</span> <span class="n">forecasts_df</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;-VAR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">&#39;MAE&#39;</span><span class="p">,</span> <span class="s1">&#39;MSE&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>p (mbar)-VAR</th>
      <th>T (degC)-VAR</th>
      <th>Tpot (K)-VAR</th>
      <th>Tdew (degC)-VAR</th>
      <th>rh (%)-VAR</th>
      <th>VPmax (mbar)-VAR</th>
      <th>VPact (mbar)-VAR</th>
      <th>VPdef (mbar)-VAR</th>
      <th>sh (g/kg)-VAR</th>
      <th>H2OC (mmol/mol)-VAR</th>
      <th>rho (g/m**3)-VAR</th>
      <th>wv (m/s)-VAR</th>
      <th>max. wv (m/s)-VAR</th>
      <th>wd (deg)-VAR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MAE</th>
      <td>2.681284</td>
      <td>2.542025</td>
      <td>2.603187</td>
      <td>1.797102</td>
      <td>10.899944</td>
      <td>2.526237</td>
      <td>1.171625</td>
      <td>2.379343</td>
      <td>0.744665</td>
      <td>1.186948</td>
      <td>12.164486</td>
      <td>3.136091</td>
      <td>4.414089</td>
      <td>66.420597</td>
    </tr>
    <tr>
      <th>MSE</th>
      <td>238.321753</td>
      <td>652.733627</td>
      <td>618.458262</td>
      <td>102.257346</td>
      <td>9581.665059</td>
      <td>540.666240</td>
      <td>39.837241</td>
      <td>490.874048</td>
      <td>15.612470</td>
      <td>39.678736</td>
      <td>9986.126326</td>
      <td>17352.964659</td>
      <td>23404.318476</td>
      <td>87581.698748</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T_MAEs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_index</span><span class="p">)):</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">forecasts_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_index</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span>
    <span class="n">T_MAEs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">test_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;T (degC)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
                                            <span class="n">forecasts_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;T (degC)-VAR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;VAR(26) MAE: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">T_MAEs</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VAR(26) MAE: 2.5420250169753875
</pre></div>
</div>
</div>
</div>
<p><strong>Observation/s</strong>: The VAR(26) model outperformed the <a class="reference internal" href="../08_WinningestMethods/lightgbm_jena_forecasting.html"><span class="doc std std-doc">naive (MAE= 3.18), seasonal naive (MAE= 2.61)</span></a> and <a class="reference internal" href="../01_AutoRegressiveIntegratedMovingAverage/01_AutoRegressiveIntegratedMovingAverage.html"><span class="doc std std-doc">ARIMA (MAE= 3.19)</span></a> models.</p>
</div>
<div class="section" id="forecast-24-hours-beyond-test-set">
<h4>Forecast 24 hours beyond test set<a class="headerlink" href="#forecast-24-hours-beyond-test-set" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train_df</span><span class="p">,</span> <span class="n">val_df</span><span class="p">,</span> <span class="n">test_df</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">future_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">h</span><span class="si">}</span><span class="s1"> hour&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">forecast_var_future</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">var_model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">all_data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
                                                      <span class="n">steps</span><span class="o">=</span><span class="mi">24</span><span class="p">),</span> 
                                   <span class="n">columns</span><span class="o">=</span><span class="n">all_data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> 
                                   <span class="n">index</span><span class="o">=</span><span class="n">future_index</span><span class="p">)</span>

<span class="n">forecast_var_future</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">forecast_var_future</span><span class="o">.</span><span class="n">columns</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;-VAR&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">train_val_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">all_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">500</span><span class="p">:][</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">forecast_var_future</span><span class="p">[[</span><span class="n">c</span><span class="o">+</span><span class="s1">&#39;-VAR&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">train_val_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">train_val_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03_VectorAutoregressiveMethods_125_0.png" src="../_images/03_VectorAutoregressiveMethods_125_0.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_125_1.png" src="../_images/03_VectorAutoregressiveMethods_125_1.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_125_2.png" src="../_images/03_VectorAutoregressiveMethods_125_2.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_125_3.png" src="../_images/03_VectorAutoregressiveMethods_125_3.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_125_4.png" src="../_images/03_VectorAutoregressiveMethods_125_4.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_125_5.png" src="../_images/03_VectorAutoregressiveMethods_125_5.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_125_6.png" src="../_images/03_VectorAutoregressiveMethods_125_6.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_125_7.png" src="../_images/03_VectorAutoregressiveMethods_125_7.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_125_8.png" src="../_images/03_VectorAutoregressiveMethods_125_8.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_125_9.png" src="../_images/03_VectorAutoregressiveMethods_125_9.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_125_10.png" src="../_images/03_VectorAutoregressiveMethods_125_10.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_125_11.png" src="../_images/03_VectorAutoregressiveMethods_125_11.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_125_12.png" src="../_images/03_VectorAutoregressiveMethods_125_12.png" />
<img alt="../_images/03_VectorAutoregressiveMethods_125_13.png" src="../_images/03_VectorAutoregressiveMethods_125_13.png" />
</div>
</div>
</div>
</div>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>VAR methods are useful when dealing with multivariate time series, as they allow us to use the relationship between the different variable to forecast.</p></li>
<li><p>These models allow us to forecast the different variables simultaneously, with the added benefit of easy (only 1 hyperparameter) and fast training.</p></li>
<li><p>Using the fitted VAR model, we can also explain the relationship between variables, and how the perturbation in one variable affects the others by getting the impulse response functions and the variance decomposition of the forecasts.</p></li>
<li><p>However, the application of these models is limited due to the stationarity requirement for ALL the variables in the multivariate time series. This method won’t work well if there is at least one variable that’s non-stationary. When dealing with non-stationary multivariate time series, one can explore the use of vector error correction models (VECM).</p></li>
</ul>
</div>
<div class="section" id="preview-to-the-next-chapter">
<h2>Preview to the Next Chapter<a class="headerlink" href="#preview-to-the-next-chapter" title="Permalink to this headline">¶</a></h2>
<p>In the next chapter, we further extend the use of VAR models to explain the relationships between variables in a multivariate time series using <strong>Granger causality</strong>, which is one of the most common ways to describe causal mechanisms in time series data.</p>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p><strong>Main references</strong></p>
<ul class="simple">
<li><p>Lütkepohl, H. (2005). New introduction to multiple time series analysis. Berlin: Springer.</p></li>
<li><p>Kilian, L., &amp; Lütkepohl, H. (2018). Structural vector autoregressive analysis. Cambridge: Cambridge University Press.</p></li>
</ul>
<p><strong>Supplementary references</strong> are listed <span class="xref myst">here</span>.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./03_VectorAutoregressiveModels"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="../02_LinearForecastingTrendandMomentumForecasting/02_LinearTrendandMomentumForecasting.html" title="previous page">Chapter 2: Linear, Trend, and Momentum Forecasting</a>
    <a class='right-next' id="next-link" href="../04_GrangerCausality/04_GrangerCausality.html" title="next page">Chapter 4: Granger Causality Test</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By students of PhD in Data Science Batch 2023 at the Asian Institute of Management<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>