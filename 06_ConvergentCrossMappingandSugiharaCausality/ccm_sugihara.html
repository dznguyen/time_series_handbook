
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Convergent Cross Mapping / Sugihara Causality &#8212; Time Series Analysis Handbook</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Applying CCM Using causal-ccm package" href="using_causal_ccm_package.html" />
    <link rel="prev" title="Chapter 3: Vector Autoregressive Methods" href="../03_VectorAutoregressiveModels/03_VectorAutoregressiveMethods.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  
  <h1 class="site-logo" id="site-title">Time Series Analysis Handbook</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Time Series Handbook
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../00_Preface/Preface_AdvancedTimeSeriesAnalysis.html">
   Preface - Advanced Time Series Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../02_LinearForecastingTrendandMomentumForecasting/02_LinearTrendandMomentumForecasting.html">
   Chapter 2: Linear, Trend, and Momentum Forecasting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../03_VectorAutoregressiveModels/03_VectorAutoregressiveMethods.html">
   Chapter 3: Vector Autoregressive Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../03_VectorAutoregressiveModels/03_VectorAutoregressiveMethods.html#takeaways">
   Takeaways
  </a>
 </li>
 <li class="toctree-l1 current active collapsible-parent">
  <a class="current reference internal" href="#">
   Convergent Cross Mapping / Sugihara Causality
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="using_causal_ccm_package.html">
     Applying CCM Using causal-ccm package
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../07_CrosscorrelationsFourierTransformandWaveletTransform/07_CrosscorrelationsFourierTransformandWaveletTransform.html">
   Cross-Correlations, Fourier Transform, and Wavelet Transform
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../07_CrosscorrelationsFourierTransformandWaveletTransform/07_CrosscorrelationsFourierTransformandWaveletTransform.html#cross-correlation-between-two-signals">
   Cross-correlation Between Two Signals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../07_CrosscorrelationsFourierTransformandWaveletTransform/07_CrosscorrelationsFourierTransformandWaveletTransform.html#wavelet-transform">
   Wavelet Transform
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../07_CrosscorrelationsFourierTransformandWaveletTransform/07_CrosscorrelationsFourierTransformandWaveletTransform.html#using-accelerometer-and-gyroscopic-data">
   Using Accelerometer and Gyroscopic Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../07_CrosscorrelationsFourierTransformandWaveletTransform/07_CrosscorrelationsFourierTransformandWaveletTransform.html#conclusion">
   Conclusion
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../08_WinningestMethods/lightgbm_jena_forecasting.html">
   Final Handbook - Winningest Methods in Time Series Forecasting
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../08_WinningestMethods/lightgbm_m5_forecasting.html">
     Final Handbook - Winningest Methods in Time Series Forecasting
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08_WinningestMethods/lightgbm_m5_tuning.html">
     Final Handbook - Winningest Methods in Time Series Forecasting
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Data/README.html">
   Datasets
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/06_ConvergentCrossMappingandSugiharaCausality/ccm_sugihara.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/phdinds-aim/time_series_handbook"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/phdinds-aim/time_series_handbook/issues/new?title=Issue%20on%20page%20%2F06_ConvergentCrossMappingandSugiharaCausality/ccm_sugihara.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/phdinds-aim/time_series_handbook/main?urlpath=tree/06_ConvergentCrossMappingandSugiharaCausality/ccm_sugihara.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#causal-ccm-package">
   causal-ccm Package
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#why-understand-causality">
   Why understand causality?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#limitations-of-granger-causality">
   Limitations of Granger Causality
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ccm-addresses-limits-of-granger-s-causality">
   CCM addresses limits of Granger’s causality
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#related-concepts">
   Related Concepts
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deterministic-dynamical-systems">
     Deterministic Dynamical Systems
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#attractors">
     Attractors
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#takens-embedding-theorem-and-shadow-manifolds">
     Takens’ Embedding Theorem and Shadow Manifolds
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-and-why-does-ccm-work">
   How and why does CCM work?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#why-cross-mapping">
     Why Cross Mapping?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#why-convergence">
     Why Convergence?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#defining-our-sample-system">
   Defining our Sample System
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ccm-algorithm">
   CCM Algorithm
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#defining-ccm-functions">
     Defining CCM Functions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#functions-for-visualizing">
     Functions for Visualizing
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#applying-ccm-to-our-sample-systems">
   Applying CCM to our Sample Systems
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#can-ccm-predict-causality-in-our-test-system">
     Can CCM predict causality in our test system?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-betas-affect-causality-as-indicated-by-convergence">
     How Betas Affect Causality As Indicated By Convergence
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-if-asymmetrically-coupled-the-effect-is-only-in-one-direction">
     What if asymmetrically coupled (the effect is only in one direction)?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#effect-of-strong-forcing">
   Effect of “Strong Forcing”
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#application-in-real-world-systems">
   Application in Real World Systems
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nicolas-cage-films-and-number-of-drowned-victims-in-the-us">
     Nicolas Cage Films and Number of Drowned Victims in the US
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dam-system">
     Dam System
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#angat-dam-vs-rain">
       Angat Dam vs Rain
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#angat-dam-vs-nia">
       Angat Dam vs NIA
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#ipo-dam-vs-rain">
       Ipo Dam vs Rain
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#ipo-dam-vs-nia">
       Ipo Dam vs NIA
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#ipo-dam-vs-angat-dam">
       Ipo Dam vs Angat Dam
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dam-system-inferred-causal-relationships">
     Dam System Inferred Causal Relationships
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#jena-climate-data">
     Jena climate data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#climate-change">
     Climate change
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#co2-emissions-global-temperature-and-arctic-ice-area-non-ecological">
       CO2 emissions, global temperature, and arctic ice area (Non-ecological)
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inferred-climate-system-causal-relationships">
     Inferred Climate System Causal Relationships
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#limitations">
   Limitations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preview-to-the-next-chapter">
   Preview to the Next Chapter
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="convergent-cross-mapping-sugihara-causality">
<h1>Convergent Cross Mapping / Sugihara Causality<a class="headerlink" href="#convergent-cross-mapping-sugihara-causality" title="Permalink to this headline">¶</a></h1>
<p>In the previous chapters we talked about Simplex Projection, a forecasting technique that looks for similar trends in the past to forecast the future by computing for nearest neighbors on an embedding. In this chapter, we discuss  Convergent Cross Mapping (CCM) also formulated by <a class="reference external" href="https://science.sciencemag.org/content/338/6106/496">Sugihara et al., 2012</a> as a methodology that uses ideas from Simplex Projection to identify causality between variables in a complex dynamical system (e.g. ecosystem) using just time series data.</p>
<p>We will go through the key ideas of CCM, how it addresses, and the algorithm behind it. We will then test the CCM framework on simulated data where we will deliberately adjust the influence of one variable over the other. Finally, we will apply CCM on some real world data to infer the relationships between variables in a system.</p>
<p>Organized by: Prince Joseph Erneszer Javier</p>
<div class="section" id="causal-ccm-package">
<h2>causal-ccm Package<a class="headerlink" href="#causal-ccm-package" title="Permalink to this headline">¶</a></h2>
<p>This chapter explains the CCM methodology in detail. If you wish to apply this in your own projects, install the framework using <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">causal-ccm</span></code>. See <code class="docutils literal notranslate"><span class="pre">using_causal_ccm_package.ipynb</span></code> notebook for details how to use.</p>
</div>
<div class="section" id="why-understand-causality">
<h2>Why understand causality?<a class="headerlink" href="#why-understand-causality" title="Permalink to this headline">¶</a></h2>
<p>We define causality as the influence of one variable on another. Understanding causality is important because it allows us to:</p>
<ul class="simple">
<li><p>Explain phenomena that they are not necessarily supernatural/paranormal</p></li>
<li><p>Anticipate the future and make the necessary adjustments</p></li>
<li><p>Apply interventions in the system to achieve desired outcomes</p></li>
</ul>
</div>
<div class="section" id="limitations-of-granger-causality">
<h2>Limitations of Granger Causality<a class="headerlink" href="#limitations-of-granger-causality" title="Permalink to this headline">¶</a></h2>
<p>In chapter 4, we talked about a framework for establishing causality in a system called Granger Causality. However Granger Causality has its limitations.</p>
<p>The intuition behind Granger causality is that a variable A causes B if we have a model that improves prediction of B if we include A. This framework assumes that we can “separate” the information about A from the rest of the system. However, in many systems that have interacting parts, information about a variable may not necessarily be removable from the rest of the system. They are integrated or in other words, not separable.</p>
<p>Granger causality framework does not apply to cases where information about variables are not separable from the rest of the system especially for those whose causalities are weak to moderate (like in our test systems in the following sections). Finally, Granger Causality is dependent on the performance of a linear predictive model that assumes linear combination of variables. This model may not perform well for some systems that need nonlinear models to improve predictions.</p>
</div>
<div class="section" id="ccm-addresses-limits-of-granger-s-causality">
<h2>CCM addresses limits of Granger’s causality<a class="headerlink" href="#ccm-addresses-limits-of-granger-s-causality" title="Permalink to this headline">¶</a></h2>
<p>Convergent Cross Mapping is designed to identify and quantify causalities in systems whose variables are not separable. Beyond this, it is designed to identify and quantify weak to moderate causalities, which Granger Causality may miss. Finally, CCM is independent of a predictive model so we’re not at the mercy of model performance.</p>
</div>
<div class="section" id="related-concepts">
<h2>Related Concepts<a class="headerlink" href="#related-concepts" title="Permalink to this headline">¶</a></h2>
<p>We briefly discuss key concepts related to CCM.</p>
<div class="section" id="deterministic-dynamical-systems">
<h3>Deterministic Dynamical Systems<a class="headerlink" href="#deterministic-dynamical-systems" title="Permalink to this headline">¶</a></h3>
<p>“Deterministic” means there’s no randomness in the system (even if it may look random, e.g. chaos). “Dynamical” means the values or “states” of the system change over time. “System” means it’s a set of things that interact with each other.</p>
</div>
<div class="section" id="attractors">
<h3>Attractors<a class="headerlink" href="#attractors" title="Permalink to this headline">¶</a></h3>
<img src=https://fromsystosys.netlify.com/img/lorenz_custom_pers_small.gif>
An attractor is a "space" of states that the system tends to get attracted to as time goes on. When attractors can be thought of as curved spaces, they are called "manifolds." I like to think of attractors as a way to summarize our system, like an embedding layer in a neural network architecture. 
<p><em>Q: What do you think is the simplest type of attractor?</em></p>
</div>
<div class="section" id="takens-embedding-theorem-and-shadow-manifolds">
<h3>Takens’ Embedding Theorem and Shadow Manifolds<a class="headerlink" href="#takens-embedding-theorem-and-shadow-manifolds" title="Permalink to this headline">¶</a></h3>
<img src = https://www.researchgate.net/profile/Pablo_Verdes/publication/51595532/figure/fig4/AS:305687352627206@1449892952960/Color-online-Schematic-representation-of-the-measurement-process-and-reconstruction-of.png width=500>
Uzal, Lucas & Grinblat, G & Verdes, Pablo. (2011). Optimal reconstruction of dynamical systems: A noise amplification approach. Physical review. E, Statistical, nonlinear, and soft matter physics. 84. 016223. 10.1103/PhysRevE.84.016223. 
<p>From the term “shadow”, shadow manifolds are “projections” of the true system manifold on some variable <span class="math notranslate nohighlight">\(X\)</span>. What Takens’ theorem tells us is if <span class="math notranslate nohighlight">\(X\)</span> belongs to a system <span class="math notranslate nohighlight">\(S\)</span> then we can generate a shadow manifold of the true manifold <span class="math notranslate nohighlight">\(M_s\)</span> using vectors of lagged (historical) values of <span class="math notranslate nohighlight">\(X\)</span>. The points in this shadow manifold <span class="math notranslate nohighlight">\(M_x\)</span> will have a 1:1 correspondence with the points in the true (unknown) manifold <span class="math notranslate nohighlight">\(M_s\)</span>.</p>
</div>
</div>
<div class="section" id="how-and-why-does-ccm-work">
<h2>How and why does CCM work?<a class="headerlink" href="#how-and-why-does-ccm-work" title="Permalink to this headline">¶</a></h2>
<img src=https://media.springernature.com/lw785/springer-static/image/chp%3A10.1007%2F978-3-319-58895-7_27/MediaObjects/429072_1_En_27_Fig1_HTML.gif width=400>
Tsonis A.A., Deyle E.R., Ye H., Sugihara G. (2018) Convergent Cross Mapping: Theory and an Example. In: Tsonis A. (eds) Advances in Nonlinear Geosciences. Springer, Cham. https://doi.org/10.1007/978-3-319-58895-7_27
<div class="section" id="why-cross-mapping">
<h3>Why Cross Mapping?<a class="headerlink" href="#why-cross-mapping" title="Permalink to this headline">¶</a></h3>
<p>In a system <span class="math notranslate nohighlight">\(Y=f(X,Y)\)</span>, cross Mapping means given the points on the manifold of one variable <span class="math notranslate nohighlight">\(M_y\)</span>, we look for the corresponding points on <span class="math notranslate nohighlight">\(M_x\)</span>, i.e. points at the same time <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p>If <span class="math notranslate nohighlight">\(X\)</span> causes <span class="math notranslate nohighlight">\(Y\)</span>, then we say some information about <span class="math notranslate nohighlight">\(X\)</span> gets stored in <span class="math notranslate nohighlight">\(Y\)</span>. If this is the case, then we can predict the values of <span class="math notranslate nohighlight">\(X\)</span> given values from <span class="math notranslate nohighlight">\(Y\)</span>. Note that this sounds counter intuitive. We contrast this with Granger causality which says that <span class="math notranslate nohighlight">\(X\)</span> causes <span class="math notranslate nohighlight">\(Y\)</span> if we can predict <span class="math notranslate nohighlight">\(Y\)</span> better given <span class="math notranslate nohighlight">\(X\)</span>.</p>
<p>We use shadow manifolds because we do not know the true manifold of the system. Given Takens’ theorem however, we can say that we can compute shadow manifolds <span class="math notranslate nohighlight">\(M_x\)</span> and <span class="math notranslate nohighlight">\(M_y\)</span> which then cross map with 1:1 correspondence to the true manifold of the system.</p>
<p>If we use the analogy that manifolds are “summaries” of system, we can think of <span class="math notranslate nohighlight">\(M_x\)</span> and <span class="math notranslate nohighlight">\(M_y\)</span> as summaries of <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span>. If <span class="math notranslate nohighlight">\(X\)</span> causes <span class="math notranslate nohighlight">\(Y\)</span>, information from <span class="math notranslate nohighlight">\(X\)</span> gets embedded in <span class="math notranslate nohighlight">\(Y\)</span>. It follows that we can then use <span class="math notranslate nohighlight">\(M_x\)</span> to predict <span class="math notranslate nohighlight">\(Y\)</span>, i.e. <span class="math notranslate nohighlight">\(\hat{Y}|M_x\)</span>. Finally, we can use the “accuracy” (MAE, MSE, or correlation) of this prediction as our metric for causality.</p>
</div>
<div class="section" id="why-convergence">
<h3>Why Convergence?<a class="headerlink" href="#why-convergence" title="Permalink to this headline">¶</a></h3>
<p>Convergence in CCM means that for variables with causalities, the longer our observation period (or more data we gather), the better we can predict one variable using the other. In the attractor example above, we can imagine the attractor will get denser as time goes on since our system will eventually fill in some of the gaps in the manifold. Stated another way, more defined manifolds imply that for variables with causalities, we can expect the accuracy of <span class="math notranslate nohighlight">\(\hat{Y}|M_x\)</span> to improve. If two variables have no causal link, then improving their manifolds will not translate to improvement in predictions.</p>
<p>Cross mapping and convergence are two requirements in the CCM framework that we need to satisfy to consider the possiblity of causality between variables.</p>
</div>
</div>
<div class="section" id="defining-our-sample-system">
<h2>Defining our Sample System<a class="headerlink" href="#defining-our-sample-system" title="Permalink to this headline">¶</a></h2>
<p>We show here a sample nonlinear system. Here, we explicitly defined <span class="math notranslate nohighlight">\(X\)</span> to be influenced by <span class="math notranslate nohighlight">\(Y\)</span> and vice versa. The effect of <span class="math notranslate nohighlight">\(X\)</span> on <span class="math notranslate nohighlight">\(Y\)</span> is a factor of <span class="math notranslate nohighlight">\(\beta_{y,x}\)</span> and the effect of <span class="math notranslate nohighlight">\(Y\)</span> on <span class="math notranslate nohighlight">\(X\)</span> is a factor of <span class="math notranslate nohighlight">\(\beta_{x,y}\)</span>. One way to read <span class="math notranslate nohighlight">\(\beta_{y,x}\)</span>: “the influence of <span class="math notranslate nohighlight">\(x\)</span> on <span class="math notranslate nohighlight">\(y\)</span>”. <span class="math notranslate nohighlight">\(r_x\)</span> and <span class="math notranslate nohighlight">\(r_y\)</span> are some constants that affect how chaotic the system is. As we increase <span class="math notranslate nohighlight">\(r\)</span> say <span class="math notranslate nohighlight">\(r &gt; 3.5\)</span> we get more unpredictable (“chaotic”) behavior.</p>
<p><span class="math notranslate nohighlight">\(X(t+1)=X(t)[r_x-r_xX_t-\beta_{x,y}Y(t)]\)</span>
<br><span class="math notranslate nohighlight">\(Y(t+1)=Y(t)[r_y-r_yY_t-\beta_{y,x}X(t)]\)</span></p>
<p>Key questions to keep in mind are:</p>
<ul class="simple">
<li><p>Can we detect the causality or interaction between these two variables by looking at the correlation between them?</p></li>
<li><p>Can convergent cross mapping help us find this out?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jdc</span> <span class="c1"># used fo defining functions for a class in separate cells</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">distance</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">make_interp_spline</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span> <span class="c1"># for showing progress bar in for loops</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">pearsonr</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">func_1</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">r</span> <span class="o">*</span> <span class="n">A</span> <span class="o">-</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">B</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># params</span>
<span class="n">r_x</span> <span class="o">=</span> <span class="mf">3.8</span>
<span class="n">r_y</span> <span class="o">=</span> <span class="mf">3.5</span>
<span class="n">B_xy</span> <span class="o">=</span> <span class="mf">0.02</span> <span class="c1"># effect on x given y (effect of y on x)</span>
<span class="n">B_yx</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1"># effect on y given x (effect of x on y)</span>

<span class="n">X0</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="c1"># initial val</span>
<span class="n">Y0</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="c1"># initial val</span>
<span class="n">t</span> <span class="o">=</span> <span class="mi">5000</span> <span class="c1"># time steps</span>

<span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="n">X0</span><span class="p">]</span>
<span class="n">Y</span> <span class="o">=</span> <span class="p">[</span><span class="n">Y0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">X_</span> <span class="o">=</span> <span class="n">func_1</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">r_x</span><span class="p">,</span> <span class="n">B_xy</span><span class="p">)</span>
    <span class="n">Y_</span> <span class="o">=</span> <span class="n">func_1</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">r_y</span><span class="p">,</span> <span class="n">B_yx</span><span class="p">)</span>    
    <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X_</span><span class="p">)</span>
    <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Y_</span><span class="p">)</span>        
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">max_t</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[:</span><span class="n">max_t</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.25</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Y</span><span class="p">[:</span><span class="n">max_t</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.25</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;timestep&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;value of X or Y&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f811d0da910&gt;
</pre></div>
</div>
<img alt="../_images/ccm_sugihara_11_1.png" src="../_images/ccm_sugihara_11_1.png" />
</div>
</div>
<p><strong>Discussion</strong></p>
<ul class="simple">
<li><p>Is the system chaotic or random? Say got these data the first time without knowing the equations, which tests can we apply to check if the system is chaotic or random?</p></li>
<li><p>What conclusions about causality can we infer from this plot?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># correlations in the first 1000 time steps</span>
<span class="n">max_t</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">max_t</span><span class="p">],</span> <span class="n">Y</span><span class="p">[:</span><span class="n">max_t</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X(t)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Y(t)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">r</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pearsonr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">r</span><span class="p">,</span> <span class="n">p</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ccm_sugihara_13_0.png" src="../_images/ccm_sugihara_13_0.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.005395539983091767, 0.8646878689811068)
</pre></div>
</div>
</div>
</div>
<p><strong>Discussion</strong></p>
<ul class="simple">
<li><p>Though we explicitly defined <span class="math notranslate nohighlight">\(Y\)</span> to be a function of <span class="math notranslate nohighlight">\(X\)</span> (<span class="math notranslate nohighlight">\(X\)</span> influences <span class="math notranslate nohighlight">\(Y\)</span>), we find no correlation between them in the long term.</p></li>
<li><p>Based on this correlation value, what can we conclude about the relationship between <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span> (e.g. whether or not <span class="math notranslate nohighlight">\(X\)</span> influences <span class="math notranslate nohighlight">\(Y\)</span> or vice versa)?</p></li>
</ul>
</div>
<div class="section" id="ccm-algorithm">
<h2>CCM Algorithm<a class="headerlink" href="#ccm-algorithm" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Given two time series</p></li>
</ol>
<center>$X = \{X(1), X(2), ..., X(L)\}$ and $Y = \{Y(1), Y(2), ..., Y(L)\}$ where $L$ is time series length</center>
<ol class="simple">
<li><p>Compute lagged-coordinate vectors where <span class="math notranslate nohighlight">\(E\)</span> is an “embedding” dimension. Search algorithms e.g. grid search can be used to identify what the best <span class="math notranslate nohighlight">\(E\)</span> value is. <span class="math notranslate nohighlight">\(\tau\)</span> is the lag step.</p></li>
</ol>
<center>$\underline{x}(t) = <X(t), X(t-\tau), X(t-2\tau), ..., X(t-(E-1)\tau)>$ for $t \in [1+(E-1)\tau, L]$</center>
<ol class="simple">
<li><p>Define the “shadow (attractor) manifold” <span class="math notranslate nohighlight">\(M_x = \{\underline{x}(t) \text{ for each } t \in [1+(E-1)\tau, L]\}\)</span></p></li>
<li><p>At <span class="math notranslate nohighlight">\(t\)</span>, locate <span class="math notranslate nohighlight">\(\underline{x}(t)\)</span> in <span class="math notranslate nohighlight">\(M_x\)</span></p></li>
<li><p>Find the <span class="math notranslate nohighlight">\(E+1\)</span> nearest neighbor vectors from selected vector <span class="math notranslate nohighlight">\(\underline{x}(t)\)</span>. Sugihara, et al. noted that <span class="math notranslate nohighlight">\(E+1\)</span> is the minimum number of points needed for an “embedding/simplex” with <span class="math notranslate nohighlight">\(E\)</span> dimensions. Intuitively, if you have a 2D matrix, you need 3 points (2 + 1) to “triangulate” a point</p></li>
<li><p>Denote the time indices of the <span class="math notranslate nohighlight">\(E+1\)</span> nearest neighbors of <span class="math notranslate nohighlight">\(\underline{x}(t)\)</span> by <span class="math notranslate nohighlight">\(t_1, ..., t_{E+1}\)</span>. These indices will be used to identify the corresponding points in <span class="math notranslate nohighlight">\(Y\)</span>.</p></li>
<li><p>Define the model that predicts <span class="math notranslate nohighlight">\(Y\)</span> given <span class="math notranslate nohighlight">\(M_x\)</span> as <span class="math notranslate nohighlight">\(\hat{Y} | M_x = \Sigma{w_iY(t_i)}\)</span> where <span class="math notranslate nohighlight">\(i = 1 ... E+1\)</span> where <span class="math notranslate nohighlight">\(w_i\)</span> is the weight that we multiply by the corresponding <span class="math notranslate nohighlight">\(Y(t_i)\)</span></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(w_i = u_i / \Sigma{u_j}\)</span> where <span class="math notranslate nohighlight">\(j = 1...E+1\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(u_i = exp[-d(\underline{x}(t), \underline{x}(t_i))/d(\underline{x}(t), \underline{x}(t_1))]\)</span> where <span class="math notranslate nohighlight">\(d(\underline{x}(s), \underline{x}(t))\)</span> is a Euclidean distance. Note that we divide by <span class="math notranslate nohighlight">\(d(x(t), x(t_1))\)</span> to “scale” the distances as a multiples of the distance to the closest point. The intuition here is the farther away the neighbor, the lower the weight by some <span class="math notranslate nohighlight">\(exp^-k\)</span></p></li>
</ul>
</li>
<li><p>If <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span> are dynamically “coupled” i.e. one influences the other, a clump of points in <span class="math notranslate nohighlight">\(M_x\)</span> should correspond to a clump of points in <span class="math notranslate nohighlight">\(M_y\)</span>. And as <span class="math notranslate nohighlight">\(L\)</span> increases, we get a denser cluster of <span class="math notranslate nohighlight">\(E+1\)</span> points from <span class="math notranslate nohighlight">\(M_x\)</span> that correspond to a denser cluster of points in <span class="math notranslate nohighlight">\(M_y\)</span>. Given this, <span class="math notranslate nohighlight">\(\hat{Y} | M_x\)</span> intuitively should converge to <span class="math notranslate nohighlight">\(Y\)</span> as <span class="math notranslate nohighlight">\(L\)</span> increases, e.g. we get more data/samples. Hence, we can test for convergence of the nearest neighbors to test for correspondence between states on <span class="math notranslate nohighlight">\(M_x\)</span> and <span class="math notranslate nohighlight">\(M_y\)</span>.</p></li>
<li><p>We then plot the correlation coefficients between <span class="math notranslate nohighlight">\(Y\)</span> and <span class="math notranslate nohighlight">\(\hat{Y} | M_x\)</span>. If there is significant correlation, this means we have enough information from <span class="math notranslate nohighlight">\(Y\)</span> that is stored in <span class="math notranslate nohighlight">\(X\)</span>. We say that <span class="math notranslate nohighlight">\(Y\)</span> influences <span class="math notranslate nohighlight">\(X\)</span>. It sounds counter intuitive but another way to think about it is: if <span class="math notranslate nohighlight">\(Y\)</span> influences <span class="math notranslate nohighlight">\(X\)</span> then information from <span class="math notranslate nohighlight">\(Y\)</span> gets stored in <span class="math notranslate nohighlight">\(X\)</span>. We can thus use <span class="math notranslate nohighlight">\(X\)</span> to predict <span class="math notranslate nohighlight">\(Y\)</span>. Same goes for <span class="math notranslate nohighlight">\(X\)</span> influencing <span class="math notranslate nohighlight">\(Y\)</span>.</p></li>
</ol>
<div class="section" id="defining-ccm-functions">
<h3>Defining CCM Functions<a class="headerlink" href="#defining-ccm-functions" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Computing &quot;Causality&quot; (Correlation between True and Predictions)</span>

<span class="k">class</span> <span class="nc">ccm</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mi">500</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        X: timeseries for variable X that could cause Y</span>
<span class="sd">        Y: timeseries for variable Y that could be caused by X</span>
<span class="sd">        tau: time lag</span>
<span class="sd">        E: shadow manifold embedding dimension</span>
<span class="sd">        L: time period/duration to consider (longer = more data)</span>
<span class="sd">        We&#39;re checking for X -&gt; Y</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="n">tau</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">E</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">L</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">My</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shadow_manifold</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span> <span class="c1"># shadow manifold for Y (we want to know if info from X is in Y)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t_steps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_distances</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">My</span><span class="p">)</span> <span class="c1"># for distances between points in manifold    </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">add_to</span> ccm
def shadow_manifold(self, X):
    &quot;&quot;&quot;
    Given
        X: some time series vector
        tau: lag step
        E: shadow manifold embedding dimension
        L: max time step to consider - 1 (starts from 0)
    Returns
        {t:[t, t-tau, t-2*tau ... t-(E-1)*tau]} = Shadow attractor manifold, dictionary of vectors
    &quot;&quot;&quot;
    X = X[:L] # make sure we cut at L
    M = {t:[] for t in range((self.E-1) * self.tau, self.L)} # shadow manifold
    for t in range((self.E-1) * self.tau, self.L):
        x_lag = [] # lagged values
        for t2 in range(0, self.E-1 + 1): # get lags, we add 1 to E-1 because we want to include E
            x_lag.append(X[t-t2*self.tau])            
        M[t] = x_lag
    return M
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">add_to</span> ccm

# get pairwise distances between vectors in X
def get_distances(self, Mx):
    &quot;&quot;&quot;
    Args
        Mx: The shadow manifold from X
    Returns
        t_steps: timesteps
        dists: n x n matrix showing distances of each vector at t_step (rows) from other vectors (columns)
    &quot;&quot;&quot;

    # we extract the time indices and vectors from the manifold Mx
    # we just want to be safe and convert the dictionary to a tuple (time, vector)
    # to preserve the time inds when we separate them
    t_vec = [(k, v) for k,v in Mx.items()]
    t_steps = np.array([i[0] for i in t_vec])
    vecs = np.array([i[1] for i in t_vec])
    dists = distance.cdist(vecs, vecs)    
    return t_steps, dists
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">add_to</span> ccm

def get_nearest_distances(self, t, t_steps, dists):
    &quot;&quot;&quot;
    Args:
        t: timestep of vector whose nearest neighbors we want to compute
        t_teps: time steps of all vectors in Mx, output of get_distances()
        dists: distance matrix showing distance of each vector (row) from other vectors (columns). output of get_distances()
        E: embedding dimension of shadow manifold Mx 
    Returns:
        nearest_timesteps: array of timesteps of E+1 vectors that are nearest to vector at time t
        nearest_distances: array of distances corresponding to vectors closest to vector at time t
    &quot;&quot;&quot;
    t_ind = np.where(t_steps == t) # get the index of time t
    dist_t = dists[t_ind].squeeze() # distances from vector at time t (this is one row)
    
    # get top closest vectors
    nearest_inds = np.argsort(dist_t)[1:self.E+1 + 1] # get indices sorted, we exclude 0 which is distance from itself
    nearest_timesteps = t_steps[nearest_inds] # index column-wise, t_steps are same column and row-wise 
    nearest_distances = dist_t[nearest_inds]  
    
    return nearest_timesteps, nearest_distances
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">add_to</span> ccm
def predict(self, t):
    &quot;&quot;&quot;
    Args
        t: timestep at Mx to predict Y at same time step
    Returns
        Y_true: the true value of Y at time t
        Y_hat: the predicted value of Y at time t using Mx
    &quot;&quot;&quot;
    eps = 0.000001 # epsilon minimum distance possible
    t_ind = np.where(self.t_steps == t) # get the index of time t
    dist_t = self.dists[t_ind].squeeze() # distances from vector at time t (this is one row)    
    nearest_timesteps, nearest_distances = self.get_nearest_distances(t, self.t_steps, self.dists)    
    
    # get weights
    u = np.exp(-nearest_distances/np.max([eps, nearest_distances[0]])) # we divide by the closest distance to scale
    w = u / np.sum(u)
    
    # get prediction of X
    X_true = self.X[t] # get corresponding true X
    X_cor = np.array(self.X)[nearest_timesteps] # get corresponding Y to cluster in Mx
    X_hat = (w * X_cor).sum() # get X_hat
    
    return X_true, X_hat
    
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">add_to</span> ccm
def causality(self):
    &#39;&#39;&#39;
    Args:
        None
    Returns:
        correl: how much self.X causes self.Y. correlation between predicted Y and true Y
    &#39;&#39;&#39;

    # run over all timesteps in M
    # X causes Y, we can predict X using My
    # X puts some info into Y that we can use to reverse engineer X from Y        
    X_true_list = []
    X_hat_list = []

    for t in list(self.My.keys()): # for each time step in My
        X_true, X_hat = self.predict(t) # predict X from My
        X_true_list.append(X_true)
        X_hat_list.append(X_hat) 

    x, y = X_true_list, X_hat_list
    r, p = pearsonr(x, y)        

    return r, p
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="functions-for-visualizing">
<h3>Functions for Visualizing<a class="headerlink" href="#functions-for-visualizing" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">add_to</span> ccm

def visualize_cross_mapping(self):
    &quot;&quot;&quot;
    Visualize the shadow manifolds and some cross mappings
    &quot;&quot;&quot;
    # we want to check cross mapping from Mx to My and My to Mx

    f, axs = plt.subplots(1, 2, figsize=(12, 6))        
    
    for i, ax in zip((0, 1), axs): # i will be used in switching Mx and My in Cross Mapping visualization
        #===============================================
        # Shadow Manifolds Visualization

        X_lag, Y_lag = [], []
        for t in range(1, len(self.X)):
            X_lag.append(X[t-tau])
            Y_lag.append(Y[t-tau])    
        X_t, Y_t = self.X[1:], self.Y[1:] # remove first value

        ax.scatter(X_t, X_lag, s=5, label=&#39;$M_x$&#39;)
        ax.scatter(Y_t, Y_lag, s=5, label=&#39;$M_y$&#39;, c=&#39;y&#39;)

        #===============================================
        # Cross Mapping Visualization

        A, B = [(self.Y, self.X), (self.X, self.Y)][i]
        cm_direction = [&#39;Mx to My&#39;, &#39;My to Mx&#39;][i]

        Ma = self.shadow_manifold(A)
        Mb = self.shadow_manifold(B)

        t_steps_A, dists_A = self.get_distances(Ma) # for distances between points in manifold
        t_steps_B, dists_B = self.get_distances(Mb) # for distances between points in manifold

        # Plot cross mapping for different time steps
        timesteps = list(Ma.keys())
        for t in np.random.choice(timesteps, size=3, replace=False):
            Ma_t = Ma[t]
            near_t_A, near_d_A = self.get_nearest_distances(t, t_steps_A, dists_A)

            for i in range(E+1):
                # points on Ma
                A_t = Ma[near_t_A[i]][0]
                A_lag = Ma[near_t_A[i]][1]
                ax.scatter(A_t, A_lag, c=&#39;b&#39;, marker=&#39;s&#39;)

                # corresponding points on Mb
                B_t = Mb[near_t_A[i]][0]
                B_lag = Mb[near_t_A[i]][1]
                ax.scatter(B_t, B_lag, c=&#39;r&#39;, marker=&#39;*&#39;, s=50)  

                # connections
                ax.plot([A_t, B_t], [A_lag, B_lag], c=&#39;r&#39;, linestyle=&#39;:&#39;) 

        ax.set_title(f&#39;{cm_direction} cross mapping. time lag, tau = {tau}, E = 2&#39;)
        ax.legend(prop={&#39;size&#39;: 14})

        ax.set_xlabel(&#39;$X_t$, $Y_t$&#39;, size=15)
        ax.set_ylabel(&#39;$X_{t-1}$, $Y_{t-1}$&#39;, size=15)               
    plt.show()       
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">add_to</span> ccm
def plot_ccm_correls(self):
    &quot;&quot;&quot;
    Args
        X: X time series
        Y: Y time series
        tau: time lag
        E: shadow manifold embedding dimension
        L: time duration
    Returns
        None. Just correlation plots
    &quot;&quot;&quot;
    M = self.shadow_manifold(self.Y) # shadow manifold
    t_steps, dists = self.get_distances(M) # for distances

    ccm_XY = ccm(X, Y, tau, E, L) # define new ccm object # Testing for X -&gt; Y
    ccm_YX = ccm(Y, X, tau, E, L) # define new ccm object # Testing for Y -&gt; X

    X_My_true, X_My_pred = [], [] # note pred X | My is equivalent to figuring out if X -&gt; Y
    Y_Mx_true, Y_Mx_pred = [], [] # note pred Y | Mx is equivalent to figuring out if Y -&gt; X

    for t in range(tau, L):
        true, pred = ccm_XY.predict(t)
        X_My_true.append(true)
        X_My_pred.append(pred)    

        true, pred = ccm_YX.predict(t)
        Y_Mx_true.append(true)
        Y_Mx_pred.append(pred)        

    # # plot
    figs, axs = plt.subplots(1, 2, figsize=(12, 5))
    
    # predicting X from My
    r, p = np.round(pearsonr(X_My_true, X_My_pred), 4)
    
    axs[0].scatter(X_My_true, X_My_pred, s=10)
    axs[0].set_xlabel(&#39;$X(t)$ (observed)&#39;, size=15)
    axs[0].set_ylabel(&#39;$\hat{X}(t)|M_y$ (estimated)&#39;, size=15)
    axs[0].set_title(f&#39;tau={tau}, E={E}, L={L}, Correlation coeff = {r}&#39;)

    # predicting Y from Mx
    r, p = np.round(pearsonr(Y_Mx_true, Y_Mx_pred), 4)
    
    axs[1].scatter(Y_Mx_true, Y_Mx_pred, s=10)
    axs[1].set_xlabel(&#39;$Y(t)$ (observed)&#39;, size=15)
    axs[1].set_ylabel(&#39;$\hat{Y}(t)|M_x$ (estimated)&#39;, size=15)
    axs[1].set_title(f&#39;tau={tau}, E={E}, L={L}, Correlation coeff = {r}&#39;)
    plt.show()
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="applying-ccm-to-our-sample-systems">
<h2>Applying CCM to our Sample Systems<a class="headerlink" href="#applying-ccm-to-our-sample-systems" title="Permalink to this headline">¶</a></h2>
<div class="section" id="can-ccm-predict-causality-in-our-test-system">
<h3>Can CCM predict causality in our test system?<a class="headerlink" href="#can-ccm-predict-causality-in-our-test-system" title="Permalink to this headline">¶</a></h3>
<p>Remember our test system is:</p>
<p><span class="math notranslate nohighlight">\(X(t+1)=X(t)[r_x-r_xX_t-\beta_{x,y}Y(t)]\)</span>
<br><span class="math notranslate nohighlight">\(Y(t+1)=Y(t)[r_y-r_yY_t-\beta_{y,x}X(t)]\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize test dataset</span>
<span class="c1"># params</span>
<span class="n">r_x</span> <span class="o">=</span> <span class="mf">3.8</span>
<span class="n">r_y</span> <span class="o">=</span> <span class="mf">3.5</span>
<span class="n">B_xy</span> <span class="o">=</span> <span class="mf">0.02</span> <span class="c1"># effect on x given y (effect of y on x)</span>
<span class="n">B_yx</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1"># effect on y given x (effect of x on y)</span>

<span class="n">X0</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="c1"># initial val</span>
<span class="n">Y0</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="c1"># initial val</span>
<span class="n">t</span> <span class="o">=</span> <span class="mi">5000</span> <span class="c1"># time steps</span>

<span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="n">X0</span><span class="p">]</span>
<span class="n">Y</span> <span class="o">=</span> <span class="p">[</span><span class="n">Y0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">X_</span> <span class="o">=</span> <span class="n">func_1</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">r_x</span><span class="p">,</span> <span class="n">B_xy</span><span class="p">)</span>
    <span class="n">Y_</span> <span class="o">=</span> <span class="n">func_1</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">r_y</span><span class="p">,</span> <span class="n">B_yx</span><span class="p">)</span>    
    <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X_</span><span class="p">)</span>
    <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Y_</span><span class="p">)</span>        
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualize simple shadow manifolds Mx and My for different tau</span>
<span class="c1"># We visualize Cross-Mapping</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># we fix the seed when randomly choosing cross mapping points</span>
<span class="n">tau</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># time lag</span>
<span class="n">E</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># shadow manifold embedding dimensions</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">500</span> <span class="c1"># length of time period to consider</span>

<span class="n">ccm1</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
<span class="n">ccm1</span><span class="o">.</span><span class="n">visualize_cross_mapping</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ccm_sugihara_30_0.png" src="../_images/ccm_sugihara_30_0.png" />
</div>
</div>
<p><strong>Discussion</strong></p>
<ul class="simple">
<li><p>In the shadow manifolds above, we show the cross mapping of points from one manifold (blue box) to the corresponding points on the other manifold (red star)</p></li>
<li><p>If values from one manifold e.g. <span class="math notranslate nohighlight">\(M_x\)</span> make a spread out cross mapping to values on another manifold e.g. <span class="math notranslate nohighlight">\(M_y\)</span>, this means that we are not able to precisely predict <span class="math notranslate nohighlight">\(M_y\)</span> or <span class="math notranslate nohighlight">\(Y\)</span> given <span class="math notranslate nohighlight">\(M_x\)</span>. This implies that not much information from <span class="math notranslate nohighlight">\(Y\)</span> is transferred to <span class="math notranslate nohighlight">\(X\)</span> to make highly precise predictions. In other words, <span class="math notranslate nohighlight">\(Y\)</span> may drive <span class="math notranslate nohighlight">\(X\)</span> but not by much.</p></li>
<li><p>What is the implication on causality if the cross mapping is more narrow, e.g. cross mapping <span class="math notranslate nohighlight">\(M_x\)</span> from <span class="math notranslate nohighlight">\(M_y\)</span> (left chart)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># let us plot the performance of the cross mapping predictions using correlation</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">3000</span>
<span class="n">tau</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">E</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">ccm1</span><span class="o">.</span><span class="n">plot_ccm_correls</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ccm_sugihara_32_0.png" src="../_images/ccm_sugihara_32_0.png" />
</div>
</div>
<p><strong>Discussion</strong></p>
<ul class="simple">
<li><p>Based on these plots which variable has more influence over the other i.e. causes the other more?</p></li>
<li><p>We have shown cross-mapping in both directions though one direction is stronger. However, in the CCM framework, the existence of cross-mapping from say X to Y or Y to X is not sufficient to establish causality. We also need to satisfy convergence which we will discuss next.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Looking at &quot;convergence&quot;</span>
<span class="n">L_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">3200</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span> <span class="c1"># L values to test</span>
<span class="n">tau</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">E</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">Xhat_My</span><span class="p">,</span> <span class="n">Yhat_Mx</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span> <span class="c1"># correlation list</span>
<span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">L_range</span><span class="p">):</span> 
    <span class="n">ccm_XY</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for X -&gt; Y</span>
    <span class="n">ccm_YX</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for Y -&gt; X    </span>
    <span class="n">Xhat_My</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> 
    <span class="n">Yhat_Mx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> 
    
<span class="c1"># plot convergence as L-&gt;inf. Convergence is necessary to conclude causality</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L_range</span><span class="p">,</span> <span class="n">Xhat_My</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat</span><span class="si">{X}</span><span class="s1">(t)|M_y$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L_range</span><span class="p">,</span> <span class="n">Yhat_Mx</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat</span><span class="si">{Y}</span><span class="s1">(t)|M_x$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;correl&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">})</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/16 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 12%|█▎        | 2/16 [00:00&lt;00:01, 11.04it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 25%|██▌       | 4/16 [00:00&lt;00:02,  4.10it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 31%|███▏      | 5/16 [00:01&lt;00:03,  2.94it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 38%|███▊      | 6/16 [00:02&lt;00:04,  2.19it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 44%|████▍     | 7/16 [00:03&lt;00:05,  1.69it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 50%|█████     | 8/16 [00:04&lt;00:06,  1.32it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 56%|█████▋    | 9/16 [00:05&lt;00:06,  1.06it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 62%|██████▎   | 10/16 [00:07&lt;00:06,  1.11s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 69%|██████▉   | 11/16 [00:09&lt;00:06,  1.36s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 75%|███████▌  | 12/16 [00:11&lt;00:06,  1.56s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 81%|████████▏ | 13/16 [00:13&lt;00:05,  1.81s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 88%|████████▊ | 14/16 [00:16&lt;00:04,  2.02s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 94%|█████████▍| 15/16 [00:18&lt;00:02,  2.24s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 16/16 [00:21&lt;00:00,  2.48s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 16/16 [00:21&lt;00:00,  1.36s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f811e0a3e50&gt;
</pre></div>
</div>
<img alt="../_images/ccm_sugihara_34_18.png" src="../_images/ccm_sugihara_34_18.png" />
</div>
</div>
<p><strong>Discussion</strong></p>
<ul class="simple">
<li><p>Convergence means we are able to improve cross mapping accuracy the longer the period <span class="math notranslate nohighlight">\(L\)</span> we consider. To recap, this happens only when we are able to enhance our reconstruction of the shared attractor between two variables using more data.</p></li>
<li><p>In the plot above, we find that both cross mappings converge, however one converges more than the other. We have satisfied the two criteria for CCM: convergence and cross mapping. We can thus say causality exists. However, the magnitudes of causality going from one direction or the other are different.</p></li>
<li><p>What can we conclude from this plot about the interactions between <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(Y\)</span>?</p></li>
<li><p>Which variable has more influence on the other?</p></li>
</ul>
</div>
<div class="section" id="how-betas-affect-causality-as-indicated-by-convergence">
<h3>How Betas Affect Causality As Indicated By Convergence<a class="headerlink" href="#how-betas-affect-causality-as-indicated-by-convergence" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Checking convergence for various betas</span>
<span class="c1"># params</span>
<span class="n">X0</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="c1"># initial val</span>
<span class="n">Y0</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="c1"># initial val</span>
<span class="n">t</span> <span class="o">=</span> <span class="mi">400</span> <span class="c1"># time steps for the dataset</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">400</span> <span class="c1"># time steps for computing CCM</span>
<span class="n">E</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># embedding dimensions</span>

<span class="n">range_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.41</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">))</span> <span class="c1"># B ranges</span>
<span class="n">correl_diffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">range_</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">range_</span><span class="p">)))</span> <span class="c1"># correlation list</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ind_B_xy</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">range_</span><span class="p">))):</span> <span class="c1"># effect on x given y (effect of y on x)</span>
    <span class="k">for</span> <span class="n">ind_B_yx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">range_</span><span class="p">)):</span> <span class="c1"># effect on y given x (effect of x on y)</span>
        
        <span class="n">r_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">3.6</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">))</span> <span class="c1"># paper implies random sampling</span>
        <span class="n">r_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">3.6</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">))</span> <span class="c1"># paper implies random sampling</span>

        <span class="n">B_xy</span> <span class="o">=</span> <span class="n">range_</span><span class="p">[</span><span class="n">ind_B_xy</span><span class="p">]</span>
        <span class="n">B_yx</span> <span class="o">=</span> <span class="n">range_</span><span class="p">[</span><span class="n">ind_B_yx</span><span class="p">]</span>
        
        <span class="c1"># initialize dataset</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="p">[</span><span class="n">X0</span><span class="p">],</span> <span class="p">[</span><span class="n">Y0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="n">X_</span> <span class="o">=</span> <span class="n">func_1</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">r_x</span><span class="p">,</span> <span class="n">B_xy</span><span class="p">)</span>
            <span class="n">Y_</span> <span class="o">=</span> <span class="n">func_1</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">r_y</span><span class="p">,</span> <span class="n">B_yx</span><span class="p">)</span>    
            <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X_</span><span class="p">)</span>
            <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Y_</span><span class="p">)</span>

        <span class="c1"># there are some combinations that throw an error</span>
        <span class="c1"># couldn&#39;t find the cause but to be fair, Sugihara et al also had &quot;holes&quot; in their chart</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Testing for X -&gt; Y</span>
            <span class="n">ccm_XY</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object</span>
            <span class="n">correl_xy</span> <span class="o">=</span> <span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>          

            <span class="c1"># Testing for Y -&gt; X</span>
            <span class="n">ccm_YX</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object</span>
            <span class="n">correl_yx</span> <span class="o">=</span> <span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># get diffs </span>
            <span class="n">correl_diffs</span><span class="p">[</span><span class="n">ind_B_yx</span><span class="p">][</span><span class="n">ind_B_xy</span><span class="p">]</span> <span class="o">=</span> <span class="n">correl_yx</span> <span class="o">-</span> <span class="n">correl_xy</span> <span class="c1"># (y -&gt; x) - (x-&gt; y)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">continue</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/21 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/prince.javier/opt/anaconda3/envs/atsa/lib/python3.7/site-packages/ipykernel_launcher.py:2: RuntimeWarning: overflow encountered in double_scalars
  
/Users/prince.javier/opt/anaconda3/envs/atsa/lib/python3.7/site-packages/ipykernel_launcher.py:2: RuntimeWarning: invalid value encountered in double_scalars
  
/Users/prince.javier/opt/anaconda3/envs/atsa/lib/python3.7/site-packages/ipykernel_launcher.py:15: RuntimeWarning: invalid value encountered in true_divide
  from ipykernel import kernelapp as app
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  5%|▍         | 1/21 [00:00&lt;00:18,  1.09it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/prince.javier/opt/anaconda3/envs/atsa/lib/python3.7/site-packages/scipy/stats/stats.py:3929: RuntimeWarning: invalid value encountered in subtract
  xm = x.astype(dtype) - xmean
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 10%|▉         | 2/21 [00:01&lt;00:17,  1.11it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 14%|█▍        | 3/21 [00:02&lt;00:16,  1.06it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 19%|█▉        | 4/21 [00:03&lt;00:16,  1.01it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 24%|██▍       | 5/21 [00:04&lt;00:15,  1.03it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 29%|██▊       | 6/21 [00:05&lt;00:15,  1.00s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 33%|███▎      | 7/21 [00:06&lt;00:13,  1.01it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 38%|███▊      | 8/21 [00:07&lt;00:12,  1.02it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 43%|████▎     | 9/21 [00:08&lt;00:11,  1.04it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 48%|████▊     | 10/21 [00:09&lt;00:10,  1.09it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 52%|█████▏    | 11/21 [00:10&lt;00:08,  1.14it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 57%|█████▋    | 12/21 [00:11&lt;00:08,  1.07it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 62%|██████▏   | 13/21 [00:12&lt;00:07,  1.01it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 67%|██████▋   | 14/21 [00:13&lt;00:06,  1.03it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 71%|███████▏  | 15/21 [00:14&lt;00:05,  1.05it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 76%|███████▌  | 16/21 [00:15&lt;00:04,  1.10it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 81%|████████  | 17/21 [00:16&lt;00:03,  1.10it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 86%|████████▌ | 18/21 [00:17&lt;00:02,  1.05it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 90%|█████████ | 19/21 [00:18&lt;00:01,  1.04it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 95%|█████████▌| 20/21 [00:19&lt;00:01,  1.01s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 21/21 [00:20&lt;00:00,  1.06s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 21/21 [00:20&lt;00:00,  1.03it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">correl_diffs</span><span class="p">),</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="n">fignum</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Beta_x_y&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Beta_y_x&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;$correl(\hat</span><span class="si">{Y}</span><span class="s1">(t)|M_x) - correl(\hat</span><span class="si">{X}</span><span class="s1">(t)|M_y$)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="c1"># plt.xticks(range(len(range_)), np.round(range_, 2), rotation=90)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">range_</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">range_</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/prince.javier/opt/anaconda3/envs/atsa/lib/python3.7/site-packages/ipykernel_launcher.py:9: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.
  if __name__ == &#39;__main__&#39;:
</pre></div>
</div>
<img alt="../_images/ccm_sugihara_38_1.png" src="../_images/ccm_sugihara_38_1.png" />
</div>
</div>
<p><strong>Discussion</strong></p>
<p>The chart above shows the difference in predictive performance <span class="math notranslate nohighlight">\(\rho(\hat{Y}|M_x) - \rho(\hat{X}|M_y)\)</span> for different <span class="math notranslate nohighlight">\(\beta_{y,x}\)</span> and <span class="math notranslate nohighlight">\(\beta_{x,y}\)</span>. Remember that <span class="math notranslate nohighlight">\(\beta_{y,x}\)</span> is how much <span class="math notranslate nohighlight">\(X\)</span> influences <span class="math notranslate nohighlight">\(Y\)</span> and that a higher score <span class="math notranslate nohighlight">\(\rho(\hat{X}|M_y)\)</span> means we are able to predict <span class="math notranslate nohighlight">\(X\)</span> better from <span class="math notranslate nohighlight">\(Y\)</span> indicating that much of information from <span class="math notranslate nohighlight">\(X\)</span> gets stored in <span class="math notranslate nohighlight">\(Y\)</span> or in other words, <span class="math notranslate nohighlight">\(X\)</span> causes <span class="math notranslate nohighlight">\(Y\)</span>. Note that the “spots” in the chart can be due to our randomization of the value of <span class="math notranslate nohighlight">\(r_x\)</span> and <span class="math notranslate nohighlight">\(r_y\)</span> in each iteration. (We followed the method of randomizing <span class="math notranslate nohighlight">\(r\)</span> as implied in the supplemental materials in Sugihara et al’s paper. Their chart also has spots.)</p>
<ul class="simple">
<li><p>Based on the plot, as <span class="math notranslate nohighlight">\(\beta_{y,x}\)</span> increases, what happens to our predicted <span class="math notranslate nohighlight">\(\hat{Y}|M_x\)</span> and <span class="math notranslate nohighlight">\(\hat{X}|M_y\)</span>?</p></li>
<li><p>Do the results align with our intuition that higher <span class="math notranslate nohighlight">\(\beta_{y,x}\)</span> means higher effect of <span class="math notranslate nohighlight">\(X\)</span> on <span class="math notranslate nohighlight">\(Y\)</span>?</p></li>
</ul>
</div>
<div class="section" id="what-if-asymmetrically-coupled-the-effect-is-only-in-one-direction">
<h3>What if asymmetrically coupled (the effect is only in one direction)?<a class="headerlink" href="#what-if-asymmetrically-coupled-the-effect-is-only-in-one-direction" title="Permalink to this headline">¶</a></h3>
<p>Let us define our system as</p>
<p><span class="math notranslate nohighlight">\(X(t+1)=X(t)[3.7-3.7X_t-0Y(t)]\)</span>
<br><span class="math notranslate nohighlight">\(Y(t+1)=Y(t)[3.7-3.7Y_t-0.32X(t)]\)</span></p>
<p>Are we convinced that this system has causality in one direction only?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize test dataset</span>
<span class="c1"># params</span>
<span class="n">r_x</span> <span class="o">=</span> <span class="mf">3.7</span>
<span class="n">r_y</span> <span class="o">=</span> <span class="mf">3.7</span>
<span class="n">B_xy</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># effect on x given y (effect of y on x)</span>
<span class="n">B_yx</span> <span class="o">=</span> <span class="mf">0.32</span> <span class="c1"># effect on y given x (effect of x on y)</span>

<span class="n">X0</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="c1"># initial val following Sugihara et al</span>
<span class="n">Y0</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="c1"># initial val following Sugihara et al</span>
<span class="n">t</span> <span class="o">=</span> <span class="mi">3000</span> <span class="c1"># time steps</span>

<span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="n">X0</span><span class="p">]</span>
<span class="n">Y</span> <span class="o">=</span> <span class="p">[</span><span class="n">Y0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">X_</span> <span class="o">=</span> <span class="n">func_1</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">r_x</span><span class="p">,</span> <span class="n">B_xy</span><span class="p">)</span>
    <span class="n">Y_</span> <span class="o">=</span> <span class="n">func_1</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">r_y</span><span class="p">,</span> <span class="n">B_yx</span><span class="p">)</span>    
    <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X_</span><span class="p">)</span>
    <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Y_</span><span class="p">)</span>        
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">max_t</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[:</span><span class="n">max_t</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.25</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Y</span><span class="p">[:</span><span class="n">max_t</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.25</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;timestep&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;value of X or Y&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f80d3c8ce50&gt;
</pre></div>
</div>
<img alt="../_images/ccm_sugihara_42_1.png" src="../_images/ccm_sugihara_42_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># correlations in the first 1000 time steps</span>
<span class="n">max_t</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">max_t</span><span class="p">],</span> <span class="n">Y</span><span class="p">[:</span><span class="n">max_t</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X(t)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Y(t)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># np.corrcoef(x, y)[0][1]</span>
<span class="n">r</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pearsonr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">r</span><span class="p">,</span> <span class="n">p</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ccm_sugihara_43_0.png" src="../_images/ccm_sugihara_43_0.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.24813484131913205, 1.6963889777956713e-15)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualize simple shadow manifolds Mx and My for different tau</span>
<span class="c1"># We visualize Cross-Mapping</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span> <span class="c1"># we fix the seed when randomly choosing cross mapping points</span>
<span class="n">tau</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># time lag</span>
<span class="n">E</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># shadow manifold embedding dimensions</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">500</span> <span class="c1"># length of time period to consider</span>

<span class="n">ccm1</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
<span class="n">ccm1</span><span class="o">.</span><span class="n">visualize_cross_mapping</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ccm_sugihara_44_0.png" src="../_images/ccm_sugihara_44_0.png" />
</div>
</div>
<p><strong>Discussion</strong></p>
<ul class="simple">
<li><p>What can you observe about the cross mappings between the two manifolds in this system? Remember that the direction of cross mapping is from the blue squares to the red stars</p></li>
<li><p>Is this something that we expected?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># let us plot the performance of the cross mapping predictions using correlation</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">3000</span>
<span class="n">tau</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">E</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">ccm1</span><span class="o">.</span><span class="n">plot_ccm_correls</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ccm_sugihara_46_0.png" src="../_images/ccm_sugihara_46_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Looking at &quot;convergence&quot;</span>
<span class="n">L_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="c1"># L values to test</span>
<span class="n">tau</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">E</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">Xhat_My</span><span class="p">,</span> <span class="n">Yhat_Mx</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span> <span class="c1"># correlation list</span>
<span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">L_range</span><span class="p">):</span> 
    <span class="n">ccm_XY</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for X -&gt; Y</span>
    <span class="n">ccm_YX</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for Y -&gt; X    </span>
    <span class="n">Xhat_My</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> 
    <span class="n">Yhat_Mx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> 
    
<span class="c1"># plot convergence as L-&gt;inf. Convergence is necessary to conclude causality</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L_range</span><span class="p">,</span> <span class="n">Xhat_My</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat</span><span class="si">{X}</span><span class="s1">(t)|M_y$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L_range</span><span class="p">,</span> <span class="n">Yhat_Mx</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat</span><span class="si">{Y}</span><span class="s1">(t)|M_x$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;correl&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">})</span>   

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X-&gt;Y r&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Xhat_My</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;p value&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Y-&gt;X r&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Yhat_Mx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;p value&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/30 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 10%|█         | 3/30 [00:00&lt;00:01, 17.85it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 17%|█▋        | 5/30 [00:00&lt;00:02,  9.42it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 23%|██▎       | 7/30 [00:00&lt;00:03,  5.97it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 27%|██▋       | 8/30 [00:01&lt;00:04,  4.84it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 30%|███       | 9/30 [00:01&lt;00:05,  3.86it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 33%|███▎      | 10/30 [00:02&lt;00:06,  3.20it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 37%|███▋      | 11/30 [00:02&lt;00:06,  2.73it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 40%|████      | 12/30 [00:03&lt;00:07,  2.35it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 43%|████▎     | 13/30 [00:03&lt;00:08,  2.02it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 47%|████▋     | 14/30 [00:04&lt;00:09,  1.74it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 50%|█████     | 15/30 [00:05&lt;00:09,  1.56it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 53%|█████▎    | 16/30 [00:06&lt;00:09,  1.41it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 57%|█████▋    | 17/30 [00:07&lt;00:10,  1.28it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 60%|██████    | 18/30 [00:08&lt;00:10,  1.17it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 63%|██████▎   | 19/30 [00:09&lt;00:10,  1.07it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 67%|██████▋   | 20/30 [00:10&lt;00:10,  1.02s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 70%|███████   | 21/30 [00:12&lt;00:09,  1.10s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 73%|███████▎  | 22/30 [00:13&lt;00:09,  1.18s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 77%|███████▋  | 23/30 [00:14&lt;00:08,  1.27s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 80%|████████  | 24/30 [00:16&lt;00:08,  1.37s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 83%|████████▎ | 25/30 [00:18&lt;00:07,  1.49s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 87%|████████▋ | 26/30 [00:20&lt;00:06,  1.59s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 90%|█████████ | 27/30 [00:21&lt;00:04,  1.67s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 93%|█████████▎| 28/30 [00:23&lt;00:03,  1.76s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 97%|█████████▋| 29/30 [00:26&lt;00:01,  1.88s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 30/30 [00:28&lt;00:00,  1.97s/it]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 30/30 [00:28&lt;00:00,  1.06it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>X-&gt;Y r 0.99 p value 0.0
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Y-&gt;X r 0.09 p value 0.0
</pre></div>
</div>
<img alt="../_images/ccm_sugihara_47_31.png" src="../_images/ccm_sugihara_47_31.png" />
</div>
</div>
<p><strong>Discussion</strong></p>
<ul class="simple">
<li><p>How do we interpret these charts in the context of determining causality using the CCM framework?</p></li>
<li><p>Are the results here expected?</p></li>
</ul>
</div>
</div>
<div class="section" id="effect-of-strong-forcing">
<h2>Effect of “Strong Forcing”<a class="headerlink" href="#effect-of-strong-forcing" title="Permalink to this headline">¶</a></h2>
<p>What happens to the result of CCM when <span class="math notranslate nohighlight">\(X\)</span> has very strong effects on <span class="math notranslate nohighlight">\(Y\)</span> yet <span class="math notranslate nohighlight">\(Y\)</span> has 0 effect on <span class="math notranslate nohighlight">\(X\)</span>?</p>
<p><span class="math notranslate nohighlight">\(X(t+1)=X(t)[3.7-3.7X_t-0Y(t)]\)</span>
<br><span class="math notranslate nohighlight">\(Y(t+1)=Y(t)[3.7-3.7Y_t- \beta_{yx} X(t)] \text{ where } \beta_{yx} \text{is large}\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize test dataset</span>
<span class="c1"># params</span>

<span class="c1"># values for B_yx</span>
<span class="c1"># we query an array using B_yx_dict[B_yx value][X or Y]</span>
<span class="n">B_yx_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">):{</span><span class="s1">&#39;X&#39;</span><span class="p">:[],</span> <span class="s1">&#39;Y&#39;</span><span class="p">:[]}</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)}</span>

<span class="n">r_x</span> <span class="o">=</span> <span class="mf">3.7</span>
<span class="n">r_y</span> <span class="o">=</span> <span class="mf">3.7</span>

<span class="n">X0</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="c1"># initial val following Sugihara et al</span>
<span class="n">Y0</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="c1"># initial val following Sugihara et al</span>
<span class="n">t</span> <span class="o">=</span> <span class="mi">2000</span> <span class="c1"># time steps</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">B_yx_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>    
    <span class="n">B_xy</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># effect on x given y (effect of y on x)</span>
    <span class="n">B_yx</span> <span class="o">=</span> <span class="n">k</span> <span class="c1"># effect on y given x (effect of x on y)    </span>
    
    <span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="n">X0</span><span class="p">]</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="p">[</span><span class="n">Y0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="n">X_</span> <span class="o">=</span> <span class="n">func_1</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">r_x</span><span class="p">,</span> <span class="n">B_xy</span><span class="p">)</span>
        <span class="n">Y_</span> <span class="o">=</span> <span class="n">func_1</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">r_y</span><span class="p">,</span> <span class="n">B_yx</span><span class="p">)</span>    
        <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X_</span><span class="p">)</span>
        <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Y_</span><span class="p">)</span> 
    <span class="n">B_yx_dict</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">X</span>
    <span class="n">B_yx_dict</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Y</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Looking at &quot;convergence&quot; for different B_yx values</span>
<span class="n">L_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="c1"># L values to test</span>
<span class="n">tau</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">E</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">B_yx_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">L_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Yhat_Mx_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Xhat_My_list</span> <span class="o">=</span> <span class="p">[]</span>


<span class="k">for</span> <span class="n">B_yx</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">B_yx_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">B_yx_dict</span><span class="p">[</span><span class="n">B_yx</span><span class="p">][</span><span class="s1">&#39;X&#39;</span><span class="p">]</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">B_yx_dict</span><span class="p">[</span><span class="n">B_yx</span><span class="p">][</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span>    

    <span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="n">L_range</span><span class="p">:</span> 
        <span class="n">ccm_XY</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for X -&gt; Y</span>
        <span class="n">ccm_YX</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for Y -&gt; X    </span>
        
        <span class="n">B_yx_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">B_yx</span><span class="p">)</span>
        <span class="n">L_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
        <span class="n">Xhat_My_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># wont be used        </span>
        <span class="n">Yhat_Mx_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 8/8 [00:10&lt;00:00,  1.36s/it]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">L_list</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">B_yx_list</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Yhat_Mx_list</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot_trisurf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$B_</span><span class="si">{yx}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;correl $\hat</span><span class="si">{Y}</span><span class="s1">|M_x$&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ccm_sugihara_52_0.png" src="../_images/ccm_sugihara_52_0.png" />
</div>
</div>
<p><strong>Discussion</strong></p>
<ul class="simple">
<li><p>Remember that if <span class="math notranslate nohighlight">\(Y\)</span> causes <span class="math notranslate nohighlight">\(X\)</span>, information from <span class="math notranslate nohighlight">\(Y\)</span> is embedded in <span class="math notranslate nohighlight">\(X\)</span> and we should be able to predict <span class="math notranslate nohighlight">\(Y\)</span> given the shadow manifold <span class="math notranslate nohighlight">\(M_x\)</span>.</p></li>
<li><p>We find that despite <span class="math notranslate nohighlight">\(Y\)</span> having no influence on <span class="math notranslate nohighlight">\(X\)</span>, CCM gives a high cross mapping performance if the influence of <span class="math notranslate nohighlight">\(X\)</span> on <span class="math notranslate nohighlight">\(Y\)</span>, <span class="math notranslate nohighlight">\(\beta_{yx}\)</span> is very high. This is what we call “strong forcing.” An intuition here is if the effect of <span class="math notranslate nohighlight">\(X\)</span> on <span class="math notranslate nohighlight">\(Y\)</span> is too high, <span class="math notranslate nohighlight">\(Y\)</span> tends to look a lot likt <span class="math notranslate nohighlight">\(X\)</span> and thus <span class="math notranslate nohighlight">\(M_x\)</span> becomes easier to cross map to <span class="math notranslate nohighlight">\(M_y\)</span>, which shouldn’t be the case. We can thus be misled to think bidirectional causality exists when it doesn’t.</p></li>
<li><p>What are the implications when using CCM to infer causality?</p></li>
</ul>
</div>
<div class="section" id="application-in-real-world-systems">
<h2>Application in Real World Systems<a class="headerlink" href="#application-in-real-world-systems" title="Permalink to this headline">¶</a></h2>
<p>Here, we apply CCM on real world systems to infer relationships between variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_plots</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">dt_name</span><span class="p">,</span> <span class="n">val1_name</span><span class="p">,</span> <span class="n">val2_name</span><span class="p">):</span>
    <span class="c1"># drop nulls</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="n">dt_name</span><span class="p">,</span> <span class="n">val1_name</span><span class="p">,</span> <span class="n">val2_name</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    
    <span class="c1"># smoothen</span>
    <span class="n">date_smooth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">dt_name</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df</span><span class="p">[</span><span class="n">dt_name</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)</span> 
    <span class="n">spl</span> <span class="o">=</span> <span class="n">make_interp_spline</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">dt_name</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">val1_name</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">val1</span> <span class="o">=</span> <span class="n">spl</span><span class="p">(</span><span class="n">date_smooth</span><span class="p">)</span>
    <span class="n">spl</span> <span class="o">=</span> <span class="n">make_interp_spline</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">dt_name</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">val2_name</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">val2</span> <span class="o">=</span> <span class="n">spl</span><span class="p">(</span><span class="n">date_smooth</span><span class="p">)</span>    
    <span class="n">r</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">val1_name</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">val2_name</span><span class="p">]),</span> <span class="mi">4</span><span class="p">)</span>
    
    <span class="c1"># plot</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">date_smooth</span><span class="p">,</span> <span class="n">val1</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dt_name</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">val1_name</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">val1_name</span><span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">date_smooth</span><span class="p">,</span> <span class="n">val2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">dt_name</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">val2_name</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">val2_name</span><span class="p">)</span>    
    <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>        
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">val1_name</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">val2_name</span><span class="si">}</span><span class="s2">, correlation coefficient: </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="nicolas-cage-films-and-number-of-drowned-victims-in-the-us">
<h3>Nicolas Cage Films and Number of Drowned Victims in the US<a class="headerlink" href="#nicolas-cage-films-and-number-of-drowned-victims-in-the-us" title="Permalink to this headline">¶</a></h3>
<p>We check how much the number of drowned victims in the US affect the number of Nicolas Cage Films for the year and vice versa. Do we expect these two to be causally linked?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../Data/cage_drowning.csv&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1999</span><span class="p">,</span> <span class="mi">2010</span><span class="p">)</span>
<span class="n">make_plots</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;num.drowned&#39;</span><span class="p">,</span> <span class="s1">&#39;num.cage.films&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ccm_sugihara_57_0.png" src="../_images/ccm_sugihara_57_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualize simple shadow manifolds Mx and My for different tau</span>
<span class="c1"># We visualize Cross-Mapping</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># we fix the seed when randomly choosing cross mapping points</span>
<span class="n">tau</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># time lag</span>
<span class="n">E</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># shadow manifold embedding dimensions</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># length of time period to consider</span>

<span class="n">Y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;num.cage.films&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;num.drowned&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Looking at &quot;convergence&quot;</span>
<span class="n">L_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># L values to test</span>
<span class="n">Xhat_My</span><span class="p">,</span> <span class="n">Yhat_Mx</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span> <span class="c1"># correlation list</span>
<span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">L_range</span><span class="p">):</span> 
    <span class="n">ccm_XY</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for X -&gt; Y</span>
    <span class="n">ccm_YX</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for Y -&gt; X    </span>
    <span class="n">Xhat_My</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> 
    <span class="n">Yhat_Mx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>    
    
<span class="c1"># plot convergence as L-&gt;inf. Convergence is necessary to conclude causality</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L_range</span><span class="p">,</span> <span class="n">Xhat_My</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat</span><span class="si">{X}</span><span class="s1">(t)|M_y$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L_range</span><span class="p">,</span> <span class="n">Yhat_Mx</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat</span><span class="si">{Y}</span><span class="s1">(t)|M_x$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;correl&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">})</span>  

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X-&gt;Y r&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Xhat_My</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;p value&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Y-&gt;X r&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Yhat_Mx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;p value&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 9/9 [00:00&lt;00:00, 1116.63it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>X-&gt;Y r 0.21 p value 0.55
Y-&gt;X r -0.11 p value 0.77
</pre></div>
</div>
<img alt="../_images/ccm_sugihara_58_2.png" src="../_images/ccm_sugihara_58_2.png" />
</div>
</div>
<p><strong>Discussion</strong></p>
<p>Although for time period up to 7, it might look like there is convergence as shown by improvement in crossmapping correlation, proceeding further results in drop in convergence. We conclude that these two variables are not causally linked.</p>
</div>
<div class="section" id="dam-system">
<h3>Dam System<a class="headerlink" href="#dam-system" title="Permalink to this headline">¶</a></h3>
<p>We then look at two dam systems in the Philippines: Angat Dam and Ipo Dam as well as rainfall and irrigation water flow rate (NIA).</p>
<div class="section" id="angat-dam-vs-rain">
<h4>Angat Dam vs Rain<a class="headerlink" href="#angat-dam-vs-rain" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Num Angat Dam Level vs NIA (what is NIA?)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../Data/Angat_dataset.csv&#39;</span><span class="p">)</span>
<span class="n">make_plots</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Dam&#39;</span><span class="p">,</span> <span class="s1">&#39;Rain&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ccm_sugihara_62_0.png" src="../_images/ccm_sugihara_62_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualize simple shadow manifolds Mx and My for different tau</span>
<span class="c1"># We visualize Cross-Mapping</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># we fix the seed when randomly choosing cross mapping points</span>
<span class="n">tau</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># time lag</span>
<span class="n">E</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># shadow manifold embedding dimensions</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># length of time period to consider</span>

<span class="n">Y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Dam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Rain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Looking at &quot;convergence&quot;</span>
<span class="n">L_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="c1"># L values to test</span>
<span class="n">Xhat_My</span><span class="p">,</span> <span class="n">Yhat_Mx</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span> <span class="c1"># correlation list</span>
<span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">L_range</span><span class="p">):</span> 
    <span class="n">ccm_XY</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for X -&gt; Y</span>
    <span class="n">ccm_YX</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for Y -&gt; X    </span>
    <span class="n">Xhat_My</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> 
    <span class="n">Yhat_Mx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>    
    
<span class="c1"># plot convergence as L-&gt;inf. Convergence is necessary to conclude causality</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L_range</span><span class="p">,</span> <span class="n">Xhat_My</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat</span><span class="si">{X}</span><span class="s1">(t)|M_y$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L_range</span><span class="p">,</span> <span class="n">Yhat_Mx</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat</span><span class="si">{Y}</span><span class="s1">(t)|M_x$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;correl&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">})</span>   

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X-&gt;Y r&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Xhat_My</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;p value&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Y-&gt;X r&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Yhat_Mx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;p value&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 71/71 [02:26&lt;00:00,  2.07s/it]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>X-&gt;Y r 0.25 p value 0.0
Y-&gt;X r 0.17 p value 0.0
</pre></div>
</div>
<img alt="../_images/ccm_sugihara_63_2.png" src="../_images/ccm_sugihara_63_2.png" />
</div>
</div>
<p><strong>Discussion</strong></p>
<p>Rain’s effect on dam levels shows some convergence as we increase the time period <span class="math notranslate nohighlight">\(L\)</span>. However, convergence is not clear on the effect of dam level on rain.</p>
</div>
<div class="section" id="angat-dam-vs-nia">
<h4>Angat Dam vs NIA<a class="headerlink" href="#angat-dam-vs-nia" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Num Angat Dam Level vs NIA (what is NIA?)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../Data/Angat_dataset.csv&#39;</span><span class="p">)</span>
<span class="n">make_plots</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Dam&#39;</span><span class="p">,</span> <span class="s1">&#39;NIA&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ccm_sugihara_66_0.png" src="../_images/ccm_sugihara_66_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualize simple shadow manifolds Mx and My for different tau</span>
<span class="c1"># We visualize Cross-Mapping</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># we fix the seed when randomly choosing cross mapping points</span>
<span class="n">tau</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># time lag</span>
<span class="n">E</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># shadow manifold embedding dimensions</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># length of time period to consider</span>

<span class="n">Y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Dam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;NIA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Looking at &quot;convergence&quot;</span>
<span class="n">L_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="c1"># L values to test</span>
<span class="n">Xhat_My</span><span class="p">,</span> <span class="n">Yhat_Mx</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span> <span class="c1"># correlation list</span>
<span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">L_range</span><span class="p">):</span> 
    <span class="n">ccm_XY</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for X -&gt; Y</span>
    <span class="n">ccm_YX</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for Y -&gt; X    </span>
    <span class="n">Xhat_My</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> 
    <span class="n">Yhat_Mx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>    
    
<span class="c1"># plot convergence as L-&gt;inf. Convergence is necessary to conclude causality</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L_range</span><span class="p">,</span> <span class="n">Xhat_My</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat</span><span class="si">{X}</span><span class="s1">(t)|M_y$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L_range</span><span class="p">,</span> <span class="n">Yhat_Mx</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat</span><span class="si">{Y}</span><span class="s1">(t)|M_x$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;correl&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">})</span> 

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X-&gt;Y r&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Xhat_My</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;p value&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Y-&gt;X r&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Yhat_Mx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;p value&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 71/71 [02:32&lt;00:00,  2.15s/it]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>X-&gt;Y r 0.59 p value 0.0
Y-&gt;X r 0.65 p value 0.0
</pre></div>
</div>
<img alt="../_images/ccm_sugihara_67_2.png" src="../_images/ccm_sugihara_67_2.png" />
</div>
</div>
<p><strong>Discussion</strong></p>
<p>Convergence is cleaner for the effect of irrigation water flow on Dam level. However there is still a rather noisy convergence for the effect of dam level on irrigation water flow.</p>
</div>
<div class="section" id="ipo-dam-vs-rain">
<h4>Ipo Dam vs Rain<a class="headerlink" href="#ipo-dam-vs-rain" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Num Ipo Dam Level vs NIA (what is NIA?)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../Data/Ipo_dataset.csv&#39;</span><span class="p">)</span>
<span class="n">make_plots</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Dam&#39;</span><span class="p">,</span> <span class="s1">&#39;Rain&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ccm_sugihara_70_0.png" src="../_images/ccm_sugihara_70_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualize simple shadow manifolds Mx and My for different tau</span>
<span class="c1"># We visualize Cross-Mapping</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># we fix the seed when randomly choosing cross mapping points</span>
<span class="n">tau</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># time lag</span>
<span class="n">E</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># shadow manifold embedding dimensions</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># length of time period to consider</span>

<span class="n">Y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Dam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Rain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Looking at &quot;convergence&quot;</span>
<span class="n">L_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="c1"># L values to test</span>
<span class="n">Xhat_My</span><span class="p">,</span> <span class="n">Yhat_Mx</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span> <span class="c1"># correlation list</span>
<span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">L_range</span><span class="p">):</span> 
    <span class="n">ccm_XY</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for X -&gt; Y</span>
    <span class="n">ccm_YX</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for Y -&gt; X    </span>
    <span class="n">Xhat_My</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> 
    <span class="n">Yhat_Mx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>    
    
<span class="c1"># plot convergence as L-&gt;inf. Convergence is necessary to conclude causality</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L_range</span><span class="p">,</span> <span class="n">Xhat_My</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat</span><span class="si">{X}</span><span class="s1">(t)|M_y$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L_range</span><span class="p">,</span> <span class="n">Yhat_Mx</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat</span><span class="si">{Y}</span><span class="s1">(t)|M_x$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;correl&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">})</span> 

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X-&gt;Y r&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Xhat_My</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;p value&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Y-&gt;X r&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Yhat_Mx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;p value&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 71/71 [02:37&lt;00:00,  2.22s/it]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>X-&gt;Y r 0.3 p value 0.0
Y-&gt;X r 0.05 p value 0.0
</pre></div>
</div>
<img alt="../_images/ccm_sugihara_71_2.png" src="../_images/ccm_sugihara_71_2.png" />
</div>
</div>
<p><strong>Discussion</strong></p>
<p>Convergence is clear for the effect of rain on dam levels. Meanwhile there is no convergence for the effect of dam levels on rain.</p>
</div>
<div class="section" id="ipo-dam-vs-nia">
<h4>Ipo Dam vs NIA<a class="headerlink" href="#ipo-dam-vs-nia" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Num Ipo Dam Level vs NIA (what is NIA?)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../Data/Ipo_dataset.csv&#39;</span><span class="p">)</span>
<span class="n">make_plots</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Dam&#39;</span><span class="p">,</span> <span class="s1">&#39;NIA&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ccm_sugihara_74_0.png" src="../_images/ccm_sugihara_74_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualize simple shadow manifolds Mx and My for different tau</span>
<span class="c1"># We visualize Cross-Mapping</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># we fix the seed when randomly choosing cross mapping points</span>
<span class="n">tau</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># time lag</span>
<span class="n">E</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># shadow manifold embedding dimensions</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># length of time period to consider</span>

<span class="n">Y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Dam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;NIA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Looking at &quot;convergence&quot;</span>
<span class="n">L_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="c1"># L values to test</span>
<span class="n">Xhat_My</span><span class="p">,</span> <span class="n">Yhat_Mx</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span> <span class="c1"># correlation list</span>
<span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">L_range</span><span class="p">):</span> 
    <span class="n">ccm_XY</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for X -&gt; Y</span>
    <span class="n">ccm_YX</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for Y -&gt; X    </span>
    <span class="n">Xhat_My</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> 
    <span class="n">Yhat_Mx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>    
    
<span class="c1"># plot convergence as L-&gt;inf. Convergence is necessary to conclude causality</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L_range</span><span class="p">,</span> <span class="n">Xhat_My</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat</span><span class="si">{X}</span><span class="s1">(t)|M_y$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L_range</span><span class="p">,</span> <span class="n">Yhat_Mx</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat</span><span class="si">{Y}</span><span class="s1">(t)|M_x$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;correl&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">})</span> 

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X-&gt;Y r&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Xhat_My</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;p value&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Y-&gt;X r&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Yhat_Mx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;p value&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 71/71 [02:43&lt;00:00,  2.30s/it]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>X-&gt;Y r 0.31 p value 0.0
Y-&gt;X r 0.21 p value 0.0
</pre></div>
</div>
<img alt="../_images/ccm_sugihara_75_2.png" src="../_images/ccm_sugihara_75_2.png" />
</div>
</div>
<p><strong>Discussion</strong></p>
<p>Convergence is clear for the effect of irrigation water flow on dam levels but it is not clear for the effect of dam levels on irrigation water flow.</p>
</div>
<div class="section" id="ipo-dam-vs-angat-dam">
<h4>Ipo Dam vs Angat Dam<a class="headerlink" href="#ipo-dam-vs-angat-dam" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Num Ipo Dam Level vs Angat Dam Level</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../Data/Ipo_dataset.csv&#39;</span><span class="p">)[[</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Dam&#39;</span><span class="p">]]</span>
<span class="n">df1</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Dam&#39;</span><span class="p">:</span><span class="s1">&#39;Ipo_Dam&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../Data/Angat_dataset.csv&#39;</span><span class="p">)[[</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Dam&#39;</span><span class="p">]]</span>
<span class="n">df2</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Dam&#39;</span><span class="p">:</span><span class="s1">&#39;Angat_Dam&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">make_plots</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Ipo_Dam&#39;</span><span class="p">,</span> <span class="s1">&#39;Angat_Dam&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ccm_sugihara_78_0.png" src="../_images/ccm_sugihara_78_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualize simple shadow manifolds Mx and My for different tau</span>
<span class="c1"># We visualize Cross-Mapping</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># we fix the seed when randomly choosing cross mapping points</span>
<span class="n">tau</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># time lag</span>
<span class="n">E</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># shadow manifold embedding dimensions</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># length of time period to consider</span>

<span class="n">Y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Ipo_Dam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Angat_Dam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Looking at &quot;convergence&quot;</span>
<span class="n">L_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="c1"># L values to test</span>
<span class="n">Xhat_My</span><span class="p">,</span> <span class="n">Yhat_Mx</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span> <span class="c1"># correlation list</span>
<span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">L_range</span><span class="p">):</span> 
    <span class="n">ccm_XY</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for X -&gt; Y</span>
    <span class="n">ccm_YX</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for Y -&gt; X    </span>
    <span class="n">Xhat_My</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> 
    <span class="n">Yhat_Mx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>    
    
<span class="c1"># plot convergence as L-&gt;inf. Convergence is necessary to conclude causality</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L_range</span><span class="p">,</span> <span class="n">Xhat_My</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat</span><span class="si">{X}</span><span class="s1">(t)|M_y$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L_range</span><span class="p">,</span> <span class="n">Yhat_Mx</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat</span><span class="si">{Y}</span><span class="s1">(t)|M_x$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;correl&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">})</span>   

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X-&gt;Y r&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Xhat_My</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;p value&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Y-&gt;X r&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Yhat_Mx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;p value&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 71/71 [02:42&lt;00:00,  2.29s/it]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>X-&gt;Y r 0.33 p value 0.0
Y-&gt;X r 0.2 p value 0.0
</pre></div>
</div>
<img alt="../_images/ccm_sugihara_79_2.png" src="../_images/ccm_sugihara_79_2.png" />
</div>
</div>
<p><strong>Discussion</strong></p>
<p>The effect of Angat dam level is stronger on Ipo than the reverse. Also note that convergence is not clear for the effect of Ipo dam level on Angat dam level.</p>
</div>
</div>
<div class="section" id="dam-system-inferred-causal-relationships">
<h3>Dam System Inferred Causal Relationships<a class="headerlink" href="#dam-system-inferred-causal-relationships" title="Permalink to this headline">¶</a></h3>
<p>Based on the results above, we can infer a network of causal relationships. Relationships with unclear convergence are shown in broken lines while relationships with clear convergence are shown in solid lines.
<img src='media/dam_inferred_causality.png' width=400></p>
</div>
<div class="section" id="jena-climate-data">
<h3>Jena climate data<a class="headerlink" href="#jena-climate-data" title="Permalink to this headline">¶</a></h3>
<p>Here, we look at at some climate data taken from the Max Planck Institute for Biogeochemistry in Jena, Germany from 2009 to 2016</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../Data/jena_climate_2009_2016.csv&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">make_plots</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;p (mbar)&#39;</span><span class="p">,</span> <span class="s1">&#39;T (degC)&#39;</span><span class="p">)</span> <span class="c1"># plot pressure vs Temperature</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ccm_sugihara_83_0.png" src="../_images/ccm_sugihara_83_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># we fix the seed when randomly choosing cross mapping points</span>
<span class="n">tau</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># time lag</span>
<span class="n">E</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># shadow manifold embedding dimensions</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c1"># length of time period to consider</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;p (mbar)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Looking at &quot;convergence&quot;</span>
<span class="n">L_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># L values to test</span>
<span class="n">Xhat_My</span><span class="p">,</span> <span class="n">Yhat_Mx</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span> <span class="c1"># correlation list</span>
<span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">L_range</span><span class="p">):</span> 
    <span class="n">ccm_XY</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for X -&gt; Y</span>
    <span class="n">ccm_YX</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for Y -&gt; X    </span>
    <span class="n">Xhat_My</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> 
    <span class="n">Yhat_Mx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>    
    
<span class="c1"># plot convergence as L-&gt;inf. Convergence is necessary to conclude causality</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L_range</span><span class="p">,</span> <span class="n">Xhat_My</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat</span><span class="si">{X}</span><span class="s1">(t)|M_y$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L_range</span><span class="p">,</span> <span class="n">Yhat_Mx</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat</span><span class="si">{Y}</span><span class="s1">(t)|M_x$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;correl&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">})</span>    

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X-&gt;Y r&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Xhat_My</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;p value&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Y-&gt;X r&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Yhat_Mx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;p value&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 998/998 [07:31&lt;00:00,  2.21it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>X-&gt;Y r 0.7 p value 0.0
Y-&gt;X r 0.52 p value 0.0
</pre></div>
</div>
<img alt="../_images/ccm_sugihara_84_2.png" src="../_images/ccm_sugihara_84_2.png" />
</div>
</div>
<p><strong>Discussion</strong>
It seems there is bidirectional (assuming no strong forcing) relationship between pressure and temperature with pressure having more effect on temperature.</p>
</div>
<div class="section" id="climate-change">
<h3>Climate change<a class="headerlink" href="#climate-change" title="Permalink to this headline">¶</a></h3>
<p>Here, we look at climate data taken from <a class="reference external" href="http://climate.nasa.gov">climate.nasa.gov</a>.</p>
<div class="section" id="co2-emissions-global-temperature-and-arctic-ice-area-non-ecological">
<h4>CO2 emissions, global temperature, and arctic ice area (Non-ecological)<a class="headerlink" href="#co2-emissions-global-temperature-and-arctic-ice-area-non-ecological" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../Data/co2_temp - combined.csv&#39;</span><span class="p">)</span>
<span class="n">make_plots</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;co2_avg&#39;</span><span class="p">,</span> <span class="s1">&#39;diff_temp&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ccm_sugihara_88_0.png" src="../_images/ccm_sugihara_88_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># we fix the seed when randomly choosing cross mapping points</span>
<span class="n">tau</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># time lag</span>
<span class="n">E</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># shadow manifold embedding dimensions</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># length of time period to consider</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;co2_avg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;diff_temp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Looking at &quot;convergence&quot;</span>
<span class="n">L_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># L values to test</span>
<span class="n">Xhat_My</span><span class="p">,</span> <span class="n">Yhat_Mx</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span> <span class="c1"># correlation list</span>
<span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">L_range</span><span class="p">):</span> 
    <span class="n">ccm_XY</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for X -&gt; Y</span>
    <span class="n">ccm_YX</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for Y -&gt; X    </span>
    <span class="n">Xhat_My</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> 
    <span class="n">Yhat_Mx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>    
    
<span class="c1"># plot convergence as L-&gt;inf. Convergence is necessary to conclude causality</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L_range</span><span class="p">,</span> <span class="n">Xhat_My</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat</span><span class="si">{X}</span><span class="s1">(t)|M_y$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L_range</span><span class="p">,</span> <span class="n">Yhat_Mx</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat</span><span class="si">{Y}</span><span class="s1">(t)|M_x$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;correl&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">})</span>    

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X-&gt;Y r&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Xhat_My</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;p value&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Y-&gt;X r&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Yhat_Mx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;p value&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 60/60 [00:00&lt;00:00, 249.06it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>X-&gt;Y r 0.96 p value 0.0
Y-&gt;X r 0.95 p value 0.0
</pre></div>
</div>
<img alt="../_images/ccm_sugihara_89_2.png" src="../_images/ccm_sugihara_89_2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">make_plots</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;co2_avg&#39;</span><span class="p">,</span> <span class="s1">&#39;arctic_ice_area&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ccm_sugihara_90_0.png" src="../_images/ccm_sugihara_90_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;co2_avg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;arctic_ice_area&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># we fix the seed when randomly choosing cross mapping points</span>
<span class="n">tau</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># time lag</span>
<span class="n">E</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># shadow manifold embedding dimensions</span>
<span class="n">L</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="c1"># length of time period to consider</span>

<span class="c1"># Looking at &quot;convergence&quot;</span>
<span class="n">L_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># L values to test</span>
<span class="n">Xhat_My</span><span class="p">,</span> <span class="n">Yhat_Mx</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span> <span class="c1"># correlation list</span>
<span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">L_range</span><span class="p">):</span> 
    <span class="n">ccm_XY</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for X -&gt; Y</span>
    <span class="n">ccm_YX</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for Y -&gt; X    </span>
    <span class="n">Xhat_My</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> 
    <span class="n">Yhat_Mx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>    
    
<span class="c1"># plot convergence as L-&gt;inf. Convergence is necessary to conclude causality</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L_range</span><span class="p">,</span> <span class="n">Xhat_My</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat</span><span class="si">{X}</span><span class="s1">(t)|M_y$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L_range</span><span class="p">,</span> <span class="n">Yhat_Mx</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat</span><span class="si">{Y}</span><span class="s1">(t)|M_x$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;correl&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">})</span>   

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X-&gt;Y r&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Xhat_My</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;p value&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Y-&gt;X r&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Yhat_Mx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;p value&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 39/39 [00:00&lt;00:00, 448.92it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>X-&gt;Y r 0.76 p value 0.0
Y-&gt;X r 0.8 p value 0.0
</pre></div>
</div>
<img alt="../_images/ccm_sugihara_91_2.png" src="../_images/ccm_sugihara_91_2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">make_plots</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;diff_temp&#39;</span><span class="p">,</span> <span class="s1">&#39;arctic_ice_area&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ccm_sugihara_92_0.png" src="../_images/ccm_sugihara_92_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;diff_temp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;arctic_ice_area&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># we fix the seed when randomly choosing cross mapping points</span>
<span class="n">tau</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># time lag</span>
<span class="n">E</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># shadow manifold embedding dimensions</span>
<span class="n">L</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="c1"># length of time period to consider</span>

<span class="c1"># Looking at &quot;convergence&quot;</span>
<span class="n">L_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># L values to test</span>
<span class="n">Xhat_My</span><span class="p">,</span> <span class="n">Yhat_Mx</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span> <span class="c1"># correlation list</span>
<span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">L_range</span><span class="p">):</span> 
    <span class="n">ccm_XY</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for X -&gt; Y</span>
    <span class="n">ccm_YX</span> <span class="o">=</span> <span class="n">ccm</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># define new ccm object # Testing for Y -&gt; X    </span>
    <span class="n">Xhat_My</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> 
    <span class="n">Yhat_Mx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>    
    
<span class="c1"># plot convergence as L-&gt;inf. Convergence is necessary to conclude causality</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L_range</span><span class="p">,</span> <span class="n">Xhat_My</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat</span><span class="si">{X}</span><span class="s1">(t)|M_y$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">L_range</span><span class="p">,</span> <span class="n">Yhat_Mx</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat</span><span class="si">{Y}</span><span class="s1">(t)|M_x$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;correl&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X-&gt;Y r&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Xhat_My</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;p value&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ccm_XY</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Y-&gt;X r&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Yhat_Mx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;p value&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ccm_YX</span><span class="o">.</span><span class="n">causality</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 39/39 [00:00&lt;00:00, 459.25it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>X-&gt;Y r 0.58 p value 0.0
Y-&gt;X r 0.69 p value 0.0
</pre></div>
</div>
<img alt="../_images/ccm_sugihara_93_2.png" src="../_images/ccm_sugihara_93_2.png" />
</div>
</div>
<p><strong>Discussion</strong></p>
<ul class="simple">
<li><p>We find strong convergence for all variables above.</p></li>
<li><p>How do we interpret the plots above? Did we meet the requirement of convergent cross mapping (convergence and cross mapping) to say there’s causality between each pair of variables?</p></li>
<li><p>How do we relate the concept of “strong forcing” on how we interpret the results?</p></li>
</ul>
</div>
</div>
<div class="section" id="inferred-climate-system-causal-relationships">
<h3>Inferred Climate System Causal Relationships<a class="headerlink" href="#inferred-climate-system-causal-relationships" title="Permalink to this headline">¶</a></h3>
<img src='media/climate_causality.png' width=400>
Based on the results above, we can infer a network of causal relationships. There seems to be a strong feedback loops between all three elements in the system. Upon checking past researches on the topic, we find that there are papers that support the seemingly unintuitive interactions in the inferred causal network:
<ul class="simple">
<li><p><a class="reference external" href="https://www.pnas.org/content/113/3/514">Evolution of South Atlantic density and chemical stratification across the last deglaciation</a></p></li>
<li><p><a class="reference external" href="https://www.sciencedaily.com/releases/2014/09/140922110424.htm">Arctic sea ice helps remove carbon dioxide from atmosphere, study shows</a></p></li>
<li><p><a class="reference external" href="https://iopscience.iop.org/article/10.1088/0022-3727/45/44/445302">Carbon dioxide enhances fragility of ice crystals</a></p></li>
<li><p><a class="reference external" href="https://www.nature.com/news/how-carbon-dioxide-melted-the-world-1.10393">How carbon dioxide melted the world</a></p></li>
</ul>
</div>
</div>
<div class="section" id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h2>
<p>We have shown how CCM can be a powerful tool for quantifying causalities between variables by using just time series data. However, the CCM has some limitations that we need to acknowledge:</p>
<ul class="simple">
<li><p>The methodology was formulated assuming we are dealing with deterministic systems (no randomness involved)</p></li>
<li><p>The real world can be noisy and we rarely encounter systems that are exactly like their mathematical formulations, so results from the model is better understood as approximations than precise values but precision can improve with more data (increasing <span class="math notranslate nohighlight">\(L\)</span>)</p></li>
<li><p>When “strong forcing” exists between two variables, bidirectional convergent cross mapping may still happen despite lack of causality. We must rule out strong forcing before we can explore if two variables have causality.</p></li>
</ul>
</div>
<div class="section" id="preview-to-the-next-chapter">
<h2>Preview to the Next Chapter<a class="headerlink" href="#preview-to-the-next-chapter" title="Permalink to this headline">¶</a></h2>
<p>In this chapter we discussed the theory and algorithm behind Convergent Cross Mapping methodology and applied it on simulated and real world data. In the next chapter we will discuss techniques for finding pattens in time series data namely cross correlation, Fourier transform, and Wavelet transform.</p>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p><strong>Main references</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="https://science.sciencemag.org/content/338/6106/496">Sugihara, G. et al., 2012. Detecting Causality in Complex Ecosystems. Science, 338(6106), pp.496-500.</a></p></li>
<li><p><a class="reference external" href="https://science.sciencemag.org/content/suppl/2012/09/19/science.1227079.DC1">Sugihara, G. et al., 2012. Supplementary Materials. [online] Science.</a></p></li>
</ul>
<p><strong>Supplementary materials</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.pnas.org/content/pnas/suppl/2016/10/26/1607747113.DCSupplemental/pnas.1607747113.sapp.pdf">SI: Step-by-step EDM Analysis. PNAS</a></p></li>
<li><p><a class="reference external" href="https://cran.microsoft.com/snapshot/2018-07-06/web/packages/rEDM/vignettes/rEDM-algorithms.pdf">Daon, Y., 2018. Simplex and S-map Algorithms. Comprehensive R Archive Network</a></p></li>
<li><p><a class="reference external" href="https://www.zora.uzh.ch/id/eprint/129395/1/Simplex_projection_walkthrough.pdf">Petchey, O., 2016. Simplex projection walkthrough. Zurich Open Repository Archive</a></p></li>
<li><p><a class="reference external" href="https://arxiv.org/pdf/1603.01155.pdf">Mønster, D. et al., 2016. Inferring causality from noisy time series data
A test of Convergent Cross-Mapping. arXiv</a></p></li>
<li><p><a class="reference external" href="https://web.iitd.ac.in/~sumeet/Sahil_Parul_btp_thesis.pdf">Sahil Loomba &amp; Parul Jain. 2016. Causal Computational Models for Gene Regulatory Networks</a></p></li>
<li><p><a class="reference external" href="http://www.scholarpedia.org/article/Attractor_reconstruction">Sauer, T., 2021. Attractor Reconstruction. Scholarpedia.org</a></p></li>
</ul>
<p><strong>Datasets</strong></p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/myazdani/spurious-correlation-studies/tree/master/data">Nicolas Cage Movies &amp; Drownings Stats</a></p></li>
<li><p><a class="reference external" href="https://climate.nasa.gov/vital-signs/carbon-dioxide/">Climate data</a></p></li>
</ul>
<div class="toctree-wrapper compound">
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./06_ConvergentCrossMappingandSugiharaCausality"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="../03_VectorAutoregressiveModels/03_VectorAutoregressiveMethods.html" title="previous page">Chapter 3: Vector Autoregressive Methods</a>
    <a class='right-next' id="next-link" href="using_causal_ccm_package.html" title="next page">Applying CCM Using causal-ccm package</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Asian Institute of Management PhD in Data Science<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>