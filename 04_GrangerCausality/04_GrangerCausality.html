
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chapter 4: Granger Causality Test &#8212; Time Series Analysis Handbook</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Chapter 5 : Dynamical Forecasting Methods (Simplex and SMap Projections)" href="../05_SimplexandSmapProjections/05_Empirical%20Dynamic%20Modelling%20%28Simplex%20and%20SMap_Projections%29.html" />
    <link rel="prev" title="Chapter 3: Vector Autoregressive Methods" href="../03_VectorAutoregressiveModels/03_VectorAutoregressiveMethods.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  
  <h1 class="site-logo" id="site-title">Time Series Analysis Handbook</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../Preface/Preface.html">
   Preface: Introduction to Time Series Analysis
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../00_Introduction/00_Introduction.html">
   Chapter 0: Advanced Time Series Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../01_AutoRegressiveIntegratedMovingAverage/01_AutoRegressiveIntegratedMovingAverage.html">
   Chapter 1: AutoRegressive Integrated Moving Average (ARIMA)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../02_LinearForecastingTrendandMomentumForecasting/02_LinearTrendandMomentumForecasting.html">
   Chapter 2: Linear, Trend, and Momentum Forecasting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../03_VectorAutoregressiveModels/03_VectorAutoregressiveMethods.html">
   Chapter 3: Vector Autoregressive Methods
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Chapter 4: Granger Causality Test
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../05_SimplexandSmapProjections/05_Empirical%20Dynamic%20Modelling%20%28Simplex%20and%20SMap_Projections%29.html">
   Chapter 5 : Dynamical Forecasting Methods (Simplex and SMap Projections)
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../06_ConvergentCrossMappingandSugiharaCausality/ccm_sugihara.html">
   Chapter 6: Convergent Cross Mapping
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../06_ConvergentCrossMappingandSugiharaCausality/using_causal_ccm_package.html">
     Applying CCM Using causal-ccm package
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../07_CrosscorrelationsFourierTransformandWaveletTransform/07_CrosscorrelationsFourierTransformandWaveletTransform.html">
   Chapter 7: Cross-Correlations, Fourier Transform, and Wavelet Transform
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../08_WinningestMethods/lightgbm_m5_forecasting.html">
   Chapter 8: Winningest Methods in Time Series Forecasting
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../08_WinningestMethods/lightgbm_m5_tuning.html">
     Hyperparameter Tuning (Supplementary Notebook)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08_WinningestMethods/lightgbm_jena_forecasting.html">
     Temperature Forecasting (Supplementary Notebook)
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/README.html">
   Datasets
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/04_GrangerCausality/04_GrangerCausality.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/phdinds-aim/time_series_handbook"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/phdinds-aim/time_series_handbook/issues/new?title=Issue%20on%20page%20%2F04_GrangerCausality/04_GrangerCausality.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/phdinds-aim/time_series_handbook/main?urlpath=tree/04_GrangerCausality/04_GrangerCausality.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#notations">
   Notations
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#definitions">
   Definitions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#causality">
     Causality
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#feedback">
     Feedback
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#instantaneous-causality">
     Instantaneous Causality
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#causality-lag">
     Causality Lag
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#assumptions">
   Assumptions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#testing-for-granger-causality">
   Testing for Granger Causality
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-1-ipo-dam-dataset">
     Example 1: Ipo Dam Dataset
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#causality-between-rainfall-and-ipo-dam-water-level">
       Causality between Rainfall and Ipo Dam Water Level
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#causality-between-nia-release-flow-and-ipo-dam-water-level">
       Causality between NIA Release Flow and Ipo Dam Water Level
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-2-causality-for-la-mesa-dam">
     Example 2: Causality for La Mesa Dam
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#causality-between-rainfall-and-la-mesa-dam-water-level">
       Causality between Rainfall and La Mesa Dam Water Level
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#causality-between-nia-release-flow-and-la-mesa-dam-water-level">
       Causality between NIA Release Flow and La Mesa Dam Water Level
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercises">
     Exercises
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-3-jena-climate-data">
     Example 3: Jena Climate Data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#causality-between-pressure-and-temperature">
       Causality between Pressure and Temperature
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="chapter-4-granger-causality-test">
<h1>Chapter 4: Granger Causality Test<a class="headerlink" href="#chapter-4-granger-causality-test" title="Permalink to this headline">¶</a></h1>
<p>In the first three chapters, we discussed the classical methods for both univariate and multivariate time series forecasting. We now introduce the notion of causality and its implications on time series analysis in general. We also describe a test for the linear VAR model discussed in the previous chapter.</p>
<p>Prepared by: Carlo Vincienzo G. Dajac</p>
<div class="section" id="notations">
<h2>Notations<a class="headerlink" href="#notations" title="Permalink to this headline">¶</a></h2>
<p>If <span class="math notranslate nohighlight">\(A_t\)</span> is a stationary stochastic process, let <span class="math notranslate nohighlight">\(\overline A_t\)</span> represent the set of <em>past</em> values <span class="math notranslate nohighlight">\({A_{t-j}, \; j=1,2,\ldots,\infty}\)</span> and <span class="math notranslate nohighlight">\(\overline{\overline A}_t\)</span> represent the set of <em>past and present</em> values <span class="math notranslate nohighlight">\({A_{t-j}, \; j=0,1,\ldots,\infty}\)</span>. Further, let <span class="math notranslate nohighlight">\(\overline A(k)\)</span> represent the set <span class="math notranslate nohighlight">\({A_{t-j}, \; j=k,k+1,\ldots,\infty}\)</span>.</p>
<p>Denote the optimum, unbiased, least-squares predictor of <span class="math notranslate nohighlight">\(A_t\)</span> using the set of values <span class="math notranslate nohighlight">\(B_t\)</span> by <span class="math notranslate nohighlight">\(P_t (A|B)\)</span>. Thus, for instance, <span class="math notranslate nohighlight">\(P_t (X|\overline X)\)</span> will be the optimum predictor of <span class="math notranslate nohighlight">\(X_t\)</span> using only past <span class="math notranslate nohighlight">\(X_t\)</span>. The predictive error series will be denoted by <span class="math notranslate nohighlight">\(\varepsilon_t(A|B) = A_t - P_t(A|B)\)</span>. Let <span class="math notranslate nohighlight">\(\sigma^2 (A|B)\)</span> be the variance of <span class="math notranslate nohighlight">\(\varepsilon_t(A|B)\)</span>.</p>
<p>Let <span class="math notranslate nohighlight">\(U_t\)</span> be all the information in the universe accumulated since time <span class="math notranslate nohighlight">\(t-1\)</span> and let <span class="math notranslate nohighlight">\(U_t - Y_t\)</span> denote all this information <em>apart</em> from the specified series <span class="math notranslate nohighlight">\(Y_t\)</span>, which is another stationary time series that is different from <span class="math notranslate nohighlight">\(X_t\)</span>.</p>
</div>
<div class="section" id="definitions">
<h2>Definitions<a class="headerlink" href="#definitions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="causality">
<h3>Causality<a class="headerlink" href="#causality" title="Permalink to this headline">¶</a></h3>
<p>If <span class="math notranslate nohighlight">\(\sigma^2 (X|U) &lt; \sigma^2 (X| \overline{U-Y})\)</span>, we say that <span class="math notranslate nohighlight">\(Y\)</span> is causing <span class="math notranslate nohighlight">\(X\)</span>, denoted by <span class="math notranslate nohighlight">\(Y_t \implies X_t\)</span>. We say that <span class="math notranslate nohighlight">\(Y_t\)</span> is causing <span class="math notranslate nohighlight">\(X_t\)</span> if we are <strong>able to predict</strong> <span class="math notranslate nohighlight">\(X_t\)</span> using all available information than if the information apart from <span class="math notranslate nohighlight">\(Y_t\)</span> had been used.</p>
</div>
<div class="section" id="feedback">
<h3>Feedback<a class="headerlink" href="#feedback" title="Permalink to this headline">¶</a></h3>
<p>If <span class="math notranslate nohighlight">\(\sigma^2 (X|\overline U) &lt; \sigma^2 (X| \overline{U-Y})\)</span> and <span class="math notranslate nohighlight">\(\sigma^2 (Y|\overline U) &lt; \sigma^2 (Y| \overline{U-X})\)</span>, we say that feedback is occurring, which is denoted by <span class="math notranslate nohighlight">\(Y_t \iff X_t\)</span>, i.e., feedback is said to occur when <span class="math notranslate nohighlight">\(X_t\)</span> is causing <span class="math notranslate nohighlight">\(Y_t\)</span> and also <span class="math notranslate nohighlight">\(Y_t\)</span> is causing <span class="math notranslate nohighlight">\(X_t\)</span>.</p>
</div>
<div class="section" id="instantaneous-causality">
<h3>Instantaneous Causality<a class="headerlink" href="#instantaneous-causality" title="Permalink to this headline">¶</a></h3>
<p>If <span class="math notranslate nohighlight">\(\sigma^2 (X|\overline U, \overline{\overline Y}) &lt; \sigma^2 (X| \overline U)\)</span>, we say that instantaneous causality <span class="math notranslate nohighlight">\(Y_t \implies X_t\)</span> is occurring. In other words, the current value of <span class="math notranslate nohighlight">\(X_t\)</span> is better “predicted” if the present value of <span class="math notranslate nohighlight">\(Y_t\)</span> is included in the “prediction” than if it is not.</p>
</div>
<div class="section" id="causality-lag">
<h3>Causality Lag<a class="headerlink" href="#causality-lag" title="Permalink to this headline">¶</a></h3>
<p>If <span class="math notranslate nohighlight">\(Y_t \implies X_t\)</span>, we define the (integer) causality lag <span class="math notranslate nohighlight">\(m\)</span> to be the least value of <span class="math notranslate nohighlight">\(k\)</span> such that <span class="math notranslate nohighlight">\(\sigma^2 (X|U-Y(k)) &lt; \sigma^2 (X|U-Y(k+1))\)</span>. Thus, knowing the values <span class="math notranslate nohighlight">\(Y_{t-j}, \; j=0,1,\ldots,m-1\)</span> will be of no help in improving the prediction of <span class="math notranslate nohighlight">\(X_t\)</span></p>
</div>
</div>
<div class="section" id="assumptions">
<h2>Assumptions<a class="headerlink" href="#assumptions" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(X_t\)</span> and <span class="math notranslate nohighlight">\(Y_t\)</span> are stationary.</p></li>
<li><p><span class="math notranslate nohighlight">\(P_t (A|B)\)</span> is already optimized.</p></li>
</ul>
</div>
<div class="section" id="testing-for-granger-causality">
<h2>Testing for Granger Causality<a class="headerlink" href="#testing-for-granger-causality" title="Permalink to this headline">¶</a></h2>
<p>We will be first building VAR models for our examples in this section. In addition to the steps outlined in the previous chapter, we will just call built-in Granger causality test function and configure it accordingly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">pandas.plotting</span> <span class="kn">import</span> <span class="n">lag_plot</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.vector_ar.var_model</span> <span class="kn">import</span> <span class="n">VAR</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span><span class="p">,</span> <span class="n">kpss</span><span class="p">,</span> <span class="n">grangercausalitytests</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="example-1-ipo-dam-dataset">
<h3>Example 1: Ipo Dam Dataset<a class="headerlink" href="#example-1-ipo-dam-dataset" title="Permalink to this headline">¶</a></h3>
<p>We will use the Ipo dataset in this example. It contains daily measurements of the following variables: rainfall (in millimeters), Oceanic Niño Index (ONI), NIA release flow (in cubic meters per second), and dam water level (in meters), respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ipo_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/Ipo_dataset.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">);</span>
<span class="n">ipo_df</span> <span class="o">=</span> <span class="n">ipo_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">ipo_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rain</th>
      <th>ONI</th>
      <th>NIA</th>
      <th>Dam</th>
    </tr>
    <tr>
      <th>Time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>-0.7</td>
      <td>38.225693</td>
      <td>100.70</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>-0.7</td>
      <td>57.996530</td>
      <td>100.63</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>-0.7</td>
      <td>49.119213</td>
      <td>100.56</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>-0.7</td>
      <td>47.034720</td>
      <td>100.55</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>-0.7</td>
      <td>42.223380</td>
      <td>100.48</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plot_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Rain&#39;</span><span class="p">,</span> <span class="s1">&#39;ONI&#39;</span><span class="p">,</span> <span class="s1">&#39;NIA&#39;</span><span class="p">,</span> <span class="s1">&#39;Dam&#39;</span><span class="p">]</span>
<span class="n">ipo_df</span><span class="p">[</span><span class="n">plot_cols</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">)):</span> 
    <span class="n">ax</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">plot_cols</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_GrangerCausality_9_0.png" src="../_images/04_GrangerCausality_9_0.png" />
</div>
</div>
<div class="section" id="causality-between-rainfall-and-ipo-dam-water-level">
<h4>Causality between Rainfall and Ipo Dam Water Level<a class="headerlink" href="#causality-between-rainfall-and-ipo-dam-water-level" title="Permalink to this headline">¶</a></h4>
<p>For this example, we will focus on the Rain and Dam time series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_df</span> <span class="o">=</span> <span class="n">ipo_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;ONI&#39;</span><span class="p">,</span> <span class="s1">&#39;NIA&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rain</th>
      <th>Dam</th>
    </tr>
    <tr>
      <th>Time</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>100.70</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>100.63</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>100.56</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>100.55</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>100.48</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We look at the lag plots to quickly check for stationarity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">lag_plots</span><span class="p">(</span><span class="n">data_df</span><span class="p">):</span>
    <span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="n">lag_plot</span><span class="p">(</span><span class="n">data_df</span><span class="p">[</span><span class="n">data_df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">data_df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

    <span class="n">lag_plot</span><span class="p">(</span><span class="n">data_df</span><span class="p">[</span><span class="n">data_df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">data_df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y_{t+1}$&#39;</span><span class="p">);</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$y_t$&#39;</span><span class="p">);</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y_{t+1}$&#39;</span><span class="p">);</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$y_t$&#39;</span><span class="p">);</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lag_plots</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_GrangerCausality_14_0.png" src="../_images/04_GrangerCausality_14_0.png" />
</div>
</div>
<p><strong>Result:</strong> Dam does not look stationary. Rainfall lag plot is inconclusive.</p>
<p>We use KPSS and ADF tests discussed in the previous chapter to conclusively check for stationarity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">kpss_test</span><span class="p">(</span><span class="n">data_df</span><span class="p">):</span>
    <span class="n">test_stat</span><span class="p">,</span> <span class="n">p_val</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">cv_1pct</span><span class="p">,</span> <span class="n">cv_2p5pct</span><span class="p">,</span> <span class="n">cv_5pct</span><span class="p">,</span> <span class="n">cv_10pct</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span> 
        <span class="n">kpss_res</span> <span class="o">=</span> <span class="n">kpss</span><span class="p">(</span><span class="n">data_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">regression</span><span class="o">=</span><span class="s1">&#39;ct&#39;</span><span class="p">)</span>
        <span class="n">test_stat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpss_res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">p_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpss_res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">cv_1pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpss_res</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s1">&#39;1%&#39;</span><span class="p">])</span>
        <span class="n">cv_2p5pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpss_res</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s1">&#39;2.5%&#39;</span><span class="p">])</span>
        <span class="n">cv_5pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpss_res</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s1">&#39;5%&#39;</span><span class="p">])</span>
        <span class="n">cv_10pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpss_res</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s1">&#39;10%&#39;</span><span class="p">])</span>
    <span class="n">kpss_res_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Test statistic&#39;</span><span class="p">:</span> <span class="n">test_stat</span><span class="p">,</span> 
                               <span class="s1">&#39;p-value&#39;</span><span class="p">:</span> <span class="n">p_val</span><span class="p">,</span> 
                               <span class="s1">&#39;Critical value - 1%&#39;</span><span class="p">:</span> <span class="n">cv_1pct</span><span class="p">,</span>
                               <span class="s1">&#39;Critical value - 2.5%&#39;</span><span class="p">:</span> <span class="n">cv_2p5pct</span><span class="p">,</span>
                               <span class="s1">&#39;Critical value - 5%&#39;</span><span class="p">:</span> <span class="n">cv_5pct</span><span class="p">,</span>
                               <span class="s1">&#39;Critical value - 10%&#39;</span><span class="p">:</span> <span class="n">cv_10pct</span><span class="p">},</span> 
                             <span class="n">index</span><span class="o">=</span><span class="n">data_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">kpss_res_df</span> <span class="o">=</span> <span class="n">kpss_res_df</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kpss_res_df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kpss_test</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rain</th>
      <th>Dam</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>0.018</td>
      <td>1.8045</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.100</td>
      <td>0.0100</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>0.216</td>
      <td>0.2160</td>
    </tr>
    <tr>
      <th>Critical value - 2.5%</th>
      <td>0.176</td>
      <td>0.1760</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>0.146</td>
      <td>0.1460</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>0.119</td>
      <td>0.1190</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Result:</strong> Rain is stationary, while Dam is not.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">adf_test</span><span class="p">(</span><span class="n">data_df</span><span class="p">):</span>
    <span class="n">test_stat</span><span class="p">,</span> <span class="n">p_val</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">cv_1pct</span><span class="p">,</span> <span class="n">cv_5pct</span><span class="p">,</span> <span class="n">cv_10pct</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span> 
        <span class="n">adf_res</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">data_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
        <span class="n">test_stat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">p_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">cv_1pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="s1">&#39;1%&#39;</span><span class="p">])</span>
        <span class="n">cv_5pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="s1">&#39;5%&#39;</span><span class="p">])</span>
        <span class="n">cv_10pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="s1">&#39;10%&#39;</span><span class="p">])</span>
    <span class="n">adf_res_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Test statistic&#39;</span><span class="p">:</span> <span class="n">test_stat</span><span class="p">,</span> 
                               <span class="s1">&#39;p-value&#39;</span><span class="p">:</span> <span class="n">p_val</span><span class="p">,</span> 
                               <span class="s1">&#39;Critical value - 1%&#39;</span><span class="p">:</span> <span class="n">cv_1pct</span><span class="p">,</span>
                               <span class="s1">&#39;Critical value - 5%&#39;</span><span class="p">:</span> <span class="n">cv_5pct</span><span class="p">,</span>
                               <span class="s1">&#39;Critical value - 10%&#39;</span><span class="p">:</span> <span class="n">cv_10pct</span><span class="p">},</span> 
                             <span class="n">index</span><span class="o">=</span><span class="n">data_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">adf_res_df</span> <span class="o">=</span> <span class="n">adf_res_df</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">adf_res_df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adf_test</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rain</th>
      <th>Dam</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>-8.6223</td>
      <td>-5.8742</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.0000</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>-3.4313</td>
      <td>-3.4313</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>-2.8619</td>
      <td>-2.8619</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>-2.5670</td>
      <td>-2.5670</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Result:</strong> Both data are stationary.</p>
<p>Since both the lag plot and KPSS test indicate that Dam is not stationary, we apply differencing first before building our VAR model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Dam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Dam&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Dam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data_df</span> <span class="o">=</span> <span class="n">data_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We again look at the lag plots and apply the KPSS and ADF tests.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lag_plots</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_GrangerCausality_26_0.png" src="../_images/04_GrangerCausality_26_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kpss_test</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rain</th>
      <th>Dam</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>0.0179</td>
      <td>0.0047</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.1000</td>
      <td>0.1000</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>0.2160</td>
      <td>0.2160</td>
    </tr>
    <tr>
      <th>Critical value - 2.5%</th>
      <td>0.1760</td>
      <td>0.1760</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>0.1460</td>
      <td>0.1460</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>0.1190</td>
      <td>0.1190</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adf_test</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rain</th>
      <th>Dam</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>-8.6227</td>
      <td>-21.5919</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.0000</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>-3.4313</td>
      <td>-3.4313</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>-2.8619</td>
      <td>-2.8619</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>-2.5670</td>
      <td>-2.5670</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Result:</strong> All three conclusively agree that both data are now stationary.</p>
<p>We next split the data into train and test sets for the VAR model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">splitter</span><span class="p">(</span><span class="n">data_df</span><span class="p">):</span>
    <span class="n">end</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span><span class="o">*.</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">train_df</span> <span class="o">=</span> <span class="n">data_df</span><span class="p">[:</span><span class="n">end</span><span class="p">]</span>
    <span class="n">test_df</span> <span class="o">=</span> <span class="n">data_df</span><span class="p">[</span><span class="n">end</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">splitter</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We then select the VAR order <span class="math notranslate nohighlight">\(p\)</span> by computing the different multivariate information criteria (AIC, BIC, HQIC), and FPE.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">select_p</span><span class="p">(</span><span class="n">train_df</span><span class="p">):</span>
    <span class="n">aic</span><span class="p">,</span> <span class="n">bic</span><span class="p">,</span> <span class="n">fpe</span><span class="p">,</span> <span class="n">hqic</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">VAR</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span> 
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">aic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">aic</span><span class="p">)</span>
        <span class="n">bic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">bic</span><span class="p">)</span>
        <span class="n">fpe</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fpe</span><span class="p">)</span>
        <span class="n">hqic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">hqic</span><span class="p">)</span>
    <span class="n">lags_metrics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;AIC&#39;</span><span class="p">:</span> <span class="n">aic</span><span class="p">,</span> 
                                    <span class="s1">&#39;BIC&#39;</span><span class="p">:</span> <span class="n">bic</span><span class="p">,</span> 
                                    <span class="s1">&#39;HQIC&#39;</span><span class="p">:</span> <span class="n">hqic</span><span class="p">,</span>
                                    <span class="s1">&#39;FPE&#39;</span><span class="p">:</span> <span class="n">fpe</span><span class="p">},</span> 
                                   <span class="n">index</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>    
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">lags_metrics_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">lags_metrics_df</span><span class="o">.</span><span class="n">idxmin</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select_p</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AIC     21
BIC      8
HQIC    11
FPE     21
dtype: int64
</pre></div>
</div>
<img alt="../_images/04_GrangerCausality_35_1.png" src="../_images/04_GrangerCausality_35_1.png" />
</div>
</div>
<p><strong>Result:</strong> We see that BIC has the lowest value at <span class="math notranslate nohighlight">\(p=8\)</span> while HQIC  at <span class="math notranslate nohighlight">\(p=11\)</span>. Although both AIC and FPE have the lowest value at <span class="math notranslate nohighlight">\(p=21\)</span>, their plots also show an elbow. We can thus select the number of lags to be 8 (also for computational efficiency).</p>
<p>We now fit the VAR model with the chosen order.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">VAR</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>
<span class="n">var_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can finally test the variables for Granger Causality</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">granger_causation_matrix</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="s1">&#39;ssr_chi2test&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>    
    <span class="sd">&quot;&quot;&quot;Check Granger Causality of all possible combinations of the time series.</span>
<span class="sd">    The rows are the response variables, columns are predictors. The values in the table </span>
<span class="sd">    are the P-Values. P-Values lesser than the significance level (0.05), implies </span>
<span class="sd">    the Null Hypothesis that the coefficients of the corresponding past values is </span>
<span class="sd">    zero, that is, the X does not cause Y can be rejected.</span>

<span class="sd">    data      : pandas dataframe containing the time series variables</span>
<span class="sd">    variables : list containing names of the time series variables.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">))),</span> <span class="n">columns</span><span class="o">=</span><span class="n">variables</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">variables</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">test_result</span> <span class="o">=</span> <span class="n">grangercausalitytests</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">]],</span> <span class="n">p</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">p_values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">test_result</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">test</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Y = </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s1">, X = </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">, P Values = </span><span class="si">{</span><span class="n">p_values</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">min_p_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">p_values</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_p_value</span>
    <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="o">+</span> <span class="s1">&#39;_x&#39;</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">]</span>
    <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="n">var</span> <span class="o">+</span> <span class="s1">&#39;_y&#39;</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">granger_causation_matrix</span><span class="p">(</span><span class="n">train_df</span><span class="p">,</span> <span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rain_x</th>
      <th>Dam_x</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Rain_y</th>
      <td>1.0</td>
      <td>0.2169</td>
    </tr>
    <tr>
      <th>Dam_y</th>
      <td>0.0</td>
      <td>1.0000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Recall:</strong> If a given p-value is &lt; significance level (0.05), then, the corresponding X series (column) causes the Y (row).</p>
<p><strong>Results:</strong> For this particular example, we can say that rainfall Granger causes changes in the dam water level. This means that rainfall data improves changes in dam water level prediction performance.</p>
<p>On the other hand, changes in dam water level does not Granger cause rainfall. This means that changes in dam water level data does not improve rainfall prediction performance.</p>
</div>
<div class="section" id="causality-between-nia-release-flow-and-ipo-dam-water-level">
<h4>Causality between NIA Release Flow and Ipo Dam Water Level<a class="headerlink" href="#causality-between-nia-release-flow-and-ipo-dam-water-level" title="Permalink to this headline">¶</a></h4>
<p>In this next example, we now focus on the NIA and Dam time series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_df</span> <span class="o">=</span> <span class="n">ipo_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;ONI&#39;</span><span class="p">,</span> <span class="s1">&#39;Rain&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NIA</th>
      <th>Dam</th>
    </tr>
    <tr>
      <th>Time</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>38.225693</td>
      <td>100.70</td>
    </tr>
    <tr>
      <th>1</th>
      <td>57.996530</td>
      <td>100.63</td>
    </tr>
    <tr>
      <th>2</th>
      <td>49.119213</td>
      <td>100.56</td>
    </tr>
    <tr>
      <th>3</th>
      <td>47.034720</td>
      <td>100.55</td>
    </tr>
    <tr>
      <th>4</th>
      <td>42.223380</td>
      <td>100.48</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We first check for stationarity by looking at the lag plots and applying the KPSS and ADF tests.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lag_plots</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_GrangerCausality_47_0.png" src="../_images/04_GrangerCausality_47_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kpss_test</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NIA</th>
      <th>Dam</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>0.184</td>
      <td>1.8045</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.022</td>
      <td>0.0100</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>0.216</td>
      <td>0.2160</td>
    </tr>
    <tr>
      <th>Critical value - 2.5%</th>
      <td>0.176</td>
      <td>0.1760</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>0.146</td>
      <td>0.1460</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>0.119</td>
      <td>0.1190</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adf_test</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NIA</th>
      <th>Dam</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>-6.6030</td>
      <td>-5.8742</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.0000</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>-3.4313</td>
      <td>-3.4313</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>-2.8619</td>
      <td>-2.8619</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>-2.5670</td>
      <td>-2.5670</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Result:</strong> All three conclusively show that both data are not stationary.</p>
<p>We apply differencing and recheck for stationarity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;NIA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;NIA&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;NIA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Dam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Dam&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Dam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data_df</span> <span class="o">=</span> <span class="n">data_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lag_plots</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_GrangerCausality_53_0.png" src="../_images/04_GrangerCausality_53_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kpss_test</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NIA</th>
      <th>Dam</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>0.0048</td>
      <td>0.0047</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.1000</td>
      <td>0.1000</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>0.2160</td>
      <td>0.2160</td>
    </tr>
    <tr>
      <th>Critical value - 2.5%</th>
      <td>0.1760</td>
      <td>0.1760</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>0.1460</td>
      <td>0.1460</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>0.1190</td>
      <td>0.1190</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adf_test</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NIA</th>
      <th>Dam</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>-21.2837</td>
      <td>-21.5919</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.0000</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>-3.4313</td>
      <td>-3.4313</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>-2.8619</td>
      <td>-2.8619</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>-2.5670</td>
      <td>-2.5670</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Result:</strong> All three conclusively agree that both data are now stationary.</p>
<p>We next split the data and select the lag order <span class="math notranslate nohighlight">\(p\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">splitter</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select_p</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AIC     27
BIC      8
HQIC    13
FPE     27
dtype: int64
</pre></div>
</div>
<img alt="../_images/04_GrangerCausality_59_1.png" src="../_images/04_GrangerCausality_59_1.png" />
</div>
</div>
<p>We select <span class="math notranslate nohighlight">\(p=8\)</span> with the same reasons as before. We finally fit our VAR model and test for Granger Causality.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">VAR</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>
<span class="n">var_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">granger_causation_matrix</span><span class="p">(</span><span class="n">train_df</span><span class="p">,</span> <span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NIA_x</th>
      <th>Dam_x</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>NIA_y</th>
      <td>1.0000</td>
      <td>0.0007</td>
    </tr>
    <tr>
      <th>Dam_y</th>
      <td>0.0216</td>
      <td>1.0000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Recall:</strong> If a given p-value is &lt; significance level (0.05), then, the corresponding X series (column) causes the Y (row).</p>
<p><strong>Result:</strong> For this particular example, we can say that changes in NIA release flow Granger causes changes in the dam water level. Conversely, changes in dam water level also Granger causes changes in the NIA release flow. This is an example of the feedback mentioned in an earlier section above. This means that NIA release flow data improves changes in dam water level prediction performance, and dam water level data also improves changes in NIA release flow prediction performance.</p>
</div>
</div>
<div class="section" id="example-2-causality-for-la-mesa-dam">
<h3>Example 2: Causality for La Mesa Dam<a class="headerlink" href="#example-2-causality-for-la-mesa-dam" title="Permalink to this headline">¶</a></h3>
<p>We now do the same steps for the La Mesa dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lamesa_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/La Mesa_dataset.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">);</span>
<span class="n">lamesa_df</span> <span class="o">=</span> <span class="n">lamesa_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">lamesa_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rain</th>
      <th>ONI</th>
      <th>NIA</th>
      <th>Dam</th>
    </tr>
    <tr>
      <th>Time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>-0.7</td>
      <td>38.225693</td>
      <td>78.63</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>-0.7</td>
      <td>57.996530</td>
      <td>78.63</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>-0.7</td>
      <td>49.119213</td>
      <td>78.61</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>-0.7</td>
      <td>47.034720</td>
      <td>78.59</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>-0.7</td>
      <td>42.223380</td>
      <td>78.56</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plot_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Rain&#39;</span><span class="p">,</span> <span class="s1">&#39;ONI&#39;</span><span class="p">,</span> <span class="s1">&#39;NIA&#39;</span><span class="p">,</span> <span class="s1">&#39;Dam&#39;</span><span class="p">]</span>
<span class="n">lamesa_df</span><span class="p">[</span><span class="n">plot_cols</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">)):</span> 
    <span class="n">ax</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">plot_cols</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_GrangerCausality_67_0.png" src="../_images/04_GrangerCausality_67_0.png" />
</div>
</div>
<div class="section" id="causality-between-rainfall-and-la-mesa-dam-water-level">
<h4>Causality between Rainfall and La Mesa Dam Water Level<a class="headerlink" href="#causality-between-rainfall-and-la-mesa-dam-water-level" title="Permalink to this headline">¶</a></h4>
<p>In this next example, we first consider the Rain and Dam time series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_df</span> <span class="o">=</span> <span class="n">lamesa_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;ONI&#39;</span><span class="p">,</span> <span class="s1">&#39;NIA&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rain</th>
      <th>Dam</th>
    </tr>
    <tr>
      <th>Time</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>78.63</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>78.63</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>78.61</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>78.59</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>78.56</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We first check for stationarity by looking at the lag plots and applying the KPSS and ADF tests.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lag_plots</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_GrangerCausality_71_0.png" src="../_images/04_GrangerCausality_71_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kpss_test</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rain</th>
      <th>Dam</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>0.0327</td>
      <td>1.8845</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.1000</td>
      <td>0.0100</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>0.2160</td>
      <td>0.2160</td>
    </tr>
    <tr>
      <th>Critical value - 2.5%</th>
      <td>0.1760</td>
      <td>0.1760</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>0.1460</td>
      <td>0.1460</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>0.1190</td>
      <td>0.1190</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adf_test</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rain</th>
      <th>Dam</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>-8.7136</td>
      <td>-4.2004</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.0000</td>
      <td>0.0007</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>-3.4313</td>
      <td>-3.4313</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>-2.8619</td>
      <td>-2.8619</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>-2.5670</td>
      <td>-2.5670</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Result:</strong> All three conclusively show that again Rain is stationary, while Dam is not.</p>
<p>We apply differencing and recheck for stationarity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Dam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Dam&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Dam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data_df</span> <span class="o">=</span> <span class="n">data_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lag_plots</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_GrangerCausality_77_0.png" src="../_images/04_GrangerCausality_77_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kpss_test</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rain</th>
      <th>Dam</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>0.0327</td>
      <td>0.0226</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.1000</td>
      <td>0.1000</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>0.2160</td>
      <td>0.2160</td>
    </tr>
    <tr>
      <th>Critical value - 2.5%</th>
      <td>0.1760</td>
      <td>0.1760</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>0.1460</td>
      <td>0.1460</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>0.1190</td>
      <td>0.1190</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adf_test</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rain</th>
      <th>Dam</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>-8.7138</td>
      <td>-26.5948</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.0000</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>-3.4313</td>
      <td>-3.4313</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>-2.8619</td>
      <td>-2.8619</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>-2.5670</td>
      <td>-2.5670</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Result:</strong> All three conclusively agree that both data are now stationary.</p>
<p>We next split the data and select the lag order <span class="math notranslate nohighlight">\(p\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">splitter</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select_p</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AIC     7
BIC     6
HQIC    7
FPE     7
dtype: int64
</pre></div>
</div>
<img alt="../_images/04_GrangerCausality_83_1.png" src="../_images/04_GrangerCausality_83_1.png" />
</div>
</div>
<p>We select <span class="math notranslate nohighlight">\(p=7\)</span>. We finally fit our VAR model and test for Granger Causality.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">VAR</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>
<span class="n">var_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">granger_causation_matrix</span><span class="p">(</span><span class="n">train_df</span><span class="p">,</span> <span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rain_x</th>
      <th>Dam_x</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Rain_y</th>
      <td>1.0</td>
      <td>0.0005</td>
    </tr>
    <tr>
      <th>Dam_y</th>
      <td>0.0</td>
      <td>1.0000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Recall:</strong> If a given p-value is &lt; significance level (0.05), then, the corresponding X series (column) causes the Y (row).</p>
<p><strong>Result:</strong> For this particular example, we can say that rainfall Granger causes changes in the dam water level. Conversely, changes in dam water level also Granger causes rainfall. This is another example of feedback. This means that rainfall data improves changes in dam water level prediction performance, and dam water level data also improves rainfall prediction performance.</p>
</div>
<div class="section" id="causality-between-nia-release-flow-and-la-mesa-dam-water-level">
<h4>Causality between NIA Release Flow and La Mesa Dam Water Level<a class="headerlink" href="#causality-between-nia-release-flow-and-la-mesa-dam-water-level" title="Permalink to this headline">¶</a></h4>
<p>In this next example, we now focus on the NIA and Dam time series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_df</span> <span class="o">=</span> <span class="n">lamesa_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;ONI&#39;</span><span class="p">,</span> <span class="s1">&#39;Rain&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NIA</th>
      <th>Dam</th>
    </tr>
    <tr>
      <th>Time</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>38.225693</td>
      <td>78.63</td>
    </tr>
    <tr>
      <th>1</th>
      <td>57.996530</td>
      <td>78.63</td>
    </tr>
    <tr>
      <th>2</th>
      <td>49.119213</td>
      <td>78.61</td>
    </tr>
    <tr>
      <th>3</th>
      <td>47.034720</td>
      <td>78.59</td>
    </tr>
    <tr>
      <th>4</th>
      <td>42.223380</td>
      <td>78.56</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We first check for stationarity by looking at the lag plots and applying the KPSS and ADF tests.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lag_plots</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_GrangerCausality_92_0.png" src="../_images/04_GrangerCausality_92_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kpss_test</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NIA</th>
      <th>Dam</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>0.184</td>
      <td>1.8845</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.022</td>
      <td>0.0100</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>0.216</td>
      <td>0.2160</td>
    </tr>
    <tr>
      <th>Critical value - 2.5%</th>
      <td>0.176</td>
      <td>0.1760</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>0.146</td>
      <td>0.1460</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>0.119</td>
      <td>0.1190</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adf_test</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NIA</th>
      <th>Dam</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>-6.6030</td>
      <td>-4.2004</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.0000</td>
      <td>0.0007</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>-3.4313</td>
      <td>-3.4313</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>-2.8619</td>
      <td>-2.8619</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>-2.5670</td>
      <td>-2.5670</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Result:</strong> All three conclusively show that both data are not stationary.</p>
<p>We apply differencing and recheck for stationarity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;NIA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;NIA&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;NIA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Dam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Dam&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;Dam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data_df</span> <span class="o">=</span> <span class="n">data_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lag_plots</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_GrangerCausality_98_0.png" src="../_images/04_GrangerCausality_98_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kpss_test</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NIA</th>
      <th>Dam</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>0.0048</td>
      <td>0.0226</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.1000</td>
      <td>0.1000</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>0.2160</td>
      <td>0.2160</td>
    </tr>
    <tr>
      <th>Critical value - 2.5%</th>
      <td>0.1760</td>
      <td>0.1760</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>0.1460</td>
      <td>0.1460</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>0.1190</td>
      <td>0.1190</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adf_test</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NIA</th>
      <th>Dam</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>-21.2837</td>
      <td>-26.5948</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.0000</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>-3.4313</td>
      <td>-3.4313</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>-2.8619</td>
      <td>-2.8619</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>-2.5670</td>
      <td>-2.5670</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Result:</strong> All three conclusively agree that both data are now stationary.</p>
<p>We next split the data and select the lag order <span class="math notranslate nohighlight">\(p\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">splitter</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select_p</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AIC     14
BIC      2
HQIC     8
FPE     14
dtype: int64
</pre></div>
</div>
<img alt="../_images/04_GrangerCausality_104_1.png" src="../_images/04_GrangerCausality_104_1.png" />
</div>
</div>
<p>We select <span class="math notranslate nohighlight">\(p=14\)</span>. We finally fit our VAR model and test for Granger Causality.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="mi">14</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">VAR</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>
<span class="n">var_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">granger_causation_matrix</span><span class="p">(</span><span class="n">train_df</span><span class="p">,</span> <span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NIA_x</th>
      <th>Dam_x</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>NIA_y</th>
      <td>1.000</td>
      <td>0.1632</td>
    </tr>
    <tr>
      <th>Dam_y</th>
      <td>0.636</td>
      <td>1.0000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Recall:</strong> If a given p-value is &lt; significance level (0.05), then, the corresponding X series (column) causes the Y (row).</p>
<p><strong>Result:</strong> We see that, unlike for Ipo Dam, changes in NIA release flow and changes in the dam water level do NOT Granger cause one another for La Mesa Dam. This means that NIA release flow data does NOT improve changes in dam water level prediction performance, and dam water level data also does NOT improve changes in NIA release flow prediction performance.</p>
</div>
</div>
<div class="section" id="exercises">
<h3>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h3>
<p>As exercises, the reader can test for Granger Causality between other pairs of variables from both the Ipo and La Mesa datasets, as well as from the Angat dataset.</p>
</div>
<div class="section" id="example-3-jena-climate-data">
<h3>Example 3: Jena Climate Data<a class="headerlink" href="#example-3-jena-climate-data" title="Permalink to this headline">¶</a></h3>
<p>We look back at the Jena climate dataset and explore which variables are Granger causal to another.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/train_series_datetime.csv&#39;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date Time&#39;</span><span class="p">)</span>
<span class="n">val_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/val_series_datetime.csv&#39;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date Time&#39;</span><span class="p">)</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/test_series_datetime.csv&#39;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date Time&#39;</span><span class="p">)</span>
<span class="n">train_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">val_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">val_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">test_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">test_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="n">train_val_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train_df</span><span class="p">,</span> <span class="n">val_df</span><span class="p">])</span>
<span class="n">jena_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train_df</span><span class="p">,</span> <span class="n">val_df</span><span class="p">,</span> <span class="n">test_df</span><span class="p">])</span>
<span class="n">jena_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>p (mbar)</th>
      <th>T (degC)</th>
      <th>Tpot (K)</th>
      <th>Tdew (degC)</th>
      <th>rh (%)</th>
      <th>VPmax (mbar)</th>
      <th>VPact (mbar)</th>
      <th>VPdef (mbar)</th>
      <th>sh (g/kg)</th>
      <th>H2OC (mmol/mol)</th>
      <th>rho (g/m**3)</th>
      <th>wv (m/s)</th>
      <th>max. wv (m/s)</th>
      <th>wd (deg)</th>
    </tr>
    <tr>
      <th>Date Time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2009-01-01 00:10:00</th>
      <td>996.52</td>
      <td>-8.02</td>
      <td>265.40</td>
      <td>-8.90</td>
      <td>93.3</td>
      <td>3.33</td>
      <td>3.11</td>
      <td>0.22</td>
      <td>1.94</td>
      <td>3.12</td>
      <td>1307.75</td>
      <td>1.03</td>
      <td>1.75</td>
      <td>152.3</td>
    </tr>
    <tr>
      <th>2009-01-01 01:10:00</th>
      <td>996.50</td>
      <td>-7.62</td>
      <td>265.81</td>
      <td>-8.30</td>
      <td>94.8</td>
      <td>3.44</td>
      <td>3.26</td>
      <td>0.18</td>
      <td>2.04</td>
      <td>3.27</td>
      <td>1305.68</td>
      <td>0.18</td>
      <td>0.63</td>
      <td>166.5</td>
    </tr>
    <tr>
      <th>2009-01-01 02:10:00</th>
      <td>996.63</td>
      <td>-8.85</td>
      <td>264.57</td>
      <td>-9.70</td>
      <td>93.5</td>
      <td>3.12</td>
      <td>2.92</td>
      <td>0.20</td>
      <td>1.82</td>
      <td>2.93</td>
      <td>1312.11</td>
      <td>0.16</td>
      <td>0.50</td>
      <td>158.3</td>
    </tr>
    <tr>
      <th>2009-01-01 03:10:00</th>
      <td>996.87</td>
      <td>-8.84</td>
      <td>264.56</td>
      <td>-9.69</td>
      <td>93.5</td>
      <td>3.13</td>
      <td>2.92</td>
      <td>0.20</td>
      <td>1.83</td>
      <td>2.93</td>
      <td>1312.37</td>
      <td>0.07</td>
      <td>0.25</td>
      <td>129.3</td>
    </tr>
    <tr>
      <th>2009-01-01 04:10:00</th>
      <td>997.05</td>
      <td>-9.23</td>
      <td>264.15</td>
      <td>-10.25</td>
      <td>92.2</td>
      <td>3.03</td>
      <td>2.79</td>
      <td>0.24</td>
      <td>1.74</td>
      <td>2.80</td>
      <td>1314.62</td>
      <td>0.10</td>
      <td>0.38</td>
      <td>203.9</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="section" id="causality-between-pressure-and-temperature">
<h4>Causality between Pressure and Temperature<a class="headerlink" href="#causality-between-pressure-and-temperature" title="Permalink to this headline">¶</a></h4>
<p>In this next example, we first consider the p and T time series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_df</span> <span class="o">=</span> <span class="n">jena_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">data_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>p (mbar)</th>
      <th>T (degC)</th>
    </tr>
    <tr>
      <th>Date Time</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2009-01-01 00:10:00</th>
      <td>996.52</td>
      <td>-8.02</td>
    </tr>
    <tr>
      <th>2009-01-01 01:10:00</th>
      <td>996.50</td>
      <td>-7.62</td>
    </tr>
    <tr>
      <th>2009-01-01 02:10:00</th>
      <td>996.63</td>
      <td>-8.85</td>
    </tr>
    <tr>
      <th>2009-01-01 03:10:00</th>
      <td>996.87</td>
      <td>-8.84</td>
    </tr>
    <tr>
      <th>2009-01-01 04:10:00</th>
      <td>997.05</td>
      <td>-9.23</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We first check for stationarity by looking at the lag plots and applying the KPSS and ADF tests.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lag_plots</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_GrangerCausality_118_0.png" src="../_images/04_GrangerCausality_118_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kpss_test</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>p (mbar)</th>
      <th>T (degC)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>0.2295</td>
      <td>0.3649</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.0100</td>
      <td>0.0100</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>0.2160</td>
      <td>0.2160</td>
    </tr>
    <tr>
      <th>Critical value - 2.5%</th>
      <td>0.1760</td>
      <td>0.1760</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>0.1460</td>
      <td>0.1460</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>0.1190</td>
      <td>0.1190</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adf_test</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>p (mbar)</th>
      <th>T (degC)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>-18.3281</td>
      <td>-8.5824</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.0000</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>-3.4304</td>
      <td>-3.4304</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>-2.8616</td>
      <td>-2.8616</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>-2.5668</td>
      <td>-2.5668</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Result:</strong> All three conclusively show that both data are not stationary.</p>
<p>We apply differencing and recheck for stationarity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;p (mbar)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;p (mbar)&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;p (mbar)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data_df</span> <span class="o">=</span> <span class="n">data_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lag_plots</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04_GrangerCausality_124_0.png" src="../_images/04_GrangerCausality_124_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kpss_test</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>p (mbar)</th>
      <th>T (degC)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>0.0009</td>
      <td>0.0024</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.1000</td>
      <td>0.1000</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>0.2160</td>
      <td>0.2160</td>
    </tr>
    <tr>
      <th>Critical value - 2.5%</th>
      <td>0.1760</td>
      <td>0.1760</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>0.1460</td>
      <td>0.1460</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>0.1190</td>
      <td>0.1190</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adf_test</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>p (mbar)</th>
      <th>T (degC)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>-38.6219</td>
      <td>-41.3374</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.0000</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>-3.4304</td>
      <td>-3.4304</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>-2.8616</td>
      <td>-2.8616</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>-2.5668</td>
      <td>-2.5668</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Result:</strong> All three conclusively agree that both data are now stationary.</p>
<p>We next split the data and select the lag order <span class="math notranslate nohighlight">\(p\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">splitter</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">select_p</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AIC     59
BIC     53
HQIC    54
FPE     59
dtype: int64
</pre></div>
</div>
<img alt="../_images/04_GrangerCausality_130_1.png" src="../_images/04_GrangerCausality_130_1.png" />
</div>
</div>
<p>We select <span class="math notranslate nohighlight">\(p=30\)</span>. We finally fit our VAR model and test for Granger Causality.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">VAR</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>
<span class="n">var_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">granger_causation_matrix</span><span class="p">(</span><span class="n">train_df</span><span class="p">,</span> <span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>p (mbar)_x</th>
      <th>T (degC)_x</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>p (mbar)_y</th>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>T (degC)_y</th>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Recall:</strong> If a given p-value is &lt; significance level (0.05), then, the corresponding X series (column) causes the Y (row).</p>
<p><strong>Result:</strong> For this particular example, we can say that changes in pressure Granger causes changes in temperature. Conversely, changes in temperature also Granger causes pressure. This is another example of feedback. This means that pressure data improves changes in temperature prediction performance, and temperature data also improves pressure prediction performance.</p>
</div>
</div>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>We have introduced the notion of causality in this chapter, and discussed its implications on time series analysis. We also applied the Granger Causality Test for linear VAR models for several datasets, seeing different examples of causality between the variables explored.</p>
<p>Causality will be revisited in a later chapter, in particular addressing the limitations of the method discussed in this chapter and discussing causality for nonlinear models.</p>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>The contents of this notebook are compiled from the following references:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.jstor.org/stable/1912791">Granger, C. (1969). Investigating Causal Relations by Econometric Models and Cross-spectral Methods. Econometrica, 37(3), 424-438.</a></p></li>
<li><p><a class="reference external" href="https://ideas.repec.org/a/eee/econom/v66y1995i1-2p225-250.html">Toda, Hiro Y. &amp; Yamamoto, Taku (1995). Statistical inference in vector autoregressions with possibly integrated processes. Journal of Econometrics, 66(1-2), 225-250.</a></p></li>
<li><p><a class="reference external" href="https://www.jstor.org/stable/25791939">Hood, M., Kidd, Q., &amp; Morris, I. (2008). Two Sides of the Same Coin? Employing Granger Causality Tests in a Time Series Cross-Section Framework. Political Analysis, 16(3), 324-344.</a></p></li>
<li><p><a class="reference external" href="https://rishi-a.github.io/2020/05/25/granger-causality.html">Testing for Granger Causality Using Python</a></p></li>
</ul>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./04_GrangerCausality"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="../03_VectorAutoregressiveModels/03_VectorAutoregressiveMethods.html" title="previous page">Chapter 3: Vector Autoregressive Methods</a>
    <a class='right-next' id="next-link" href="../05_SimplexandSmapProjections/05_Empirical%20Dynamic%20Modelling%20%28Simplex%20and%20SMap_Projections%29.html" title="next page">Chapter 5 : Dynamical Forecasting Methods (Simplex and SMap Projections)</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By students of PhD in Data Science Batch 2023 at the Asian Institute of Management<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>