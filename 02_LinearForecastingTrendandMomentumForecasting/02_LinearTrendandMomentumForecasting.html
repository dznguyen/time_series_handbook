
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chapter 2: Linear, Trend, and Momentum Forecasting &#8212; Time Series Analysis Handbook</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Chapter 3: Vector Autoregressive Methods" href="../03_VectorAutoregressiveModels/03_VectorAutoregressiveMethods.html" />
    <link rel="prev" title="Chapter 1: AutoRegressive Integrated Moving Average (ARIMA)" href="../01_AutoRegressiveIntegratedMovingAverage/01_AutoRegressiveIntegratedMovingAverage.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  
  <h1 class="site-logo" id="site-title">Time Series Analysis Handbook</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../Preface/Preface.html">
   Preface: Introduction to Time Series Analysis
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../00_Introduction/00_Introduction.html">
   Chapter 0: Advanced Time Series Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../01_AutoRegressiveIntegratedMovingAverage/01_AutoRegressiveIntegratedMovingAverage.html">
   Chapter 1: AutoRegressive Integrated Moving Average (ARIMA)
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Chapter 2: Linear, Trend, and Momentum Forecasting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../03_VectorAutoregressiveModels/03_VectorAutoregressiveMethods.html">
   Chapter 3: Vector Autoregressive Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../04_GrangerCausality/04_GrangerCausality.html">
   Chapter 4: Granger Causality Test
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../05_SimplexandSmapProjections/05_Empirical%20Dynamic%20Modelling%20%28Simplex%20and%20SMap_Projections%29.html">
   Chapter 5 : Dynamical Forecasting Methods (Simplex and SMap Projections)
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../06_ConvergentCrossMappingandSugiharaCausality/ccm_sugihara.html">
   Chapter 6: Convergent Cross Mapping
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../06_ConvergentCrossMappingandSugiharaCausality/using_causal_ccm_package.html">
     Applying CCM Using causal-ccm package
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../07_CrosscorrelationsFourierTransformandWaveletTransform/07_CrosscorrelationsFourierTransformandWaveletTransform.html">
   Chapter 7: Cross-Correlations, Fourier Transform, and Wavelet Transform
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../08_WinningestMethods/lightgbm_m5_forecasting.html">
   Chapter 8: Winningest Methods in Time Series Forecasting
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../08_WinningestMethods/lightgbm_m5_tuning.html">
     Hyperparameter Tuning (Supplementary Notebook)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08_WinningestMethods/lightgbm_jena_forecasting.html">
     Temperature Forecasting (Supplementary Notebook)
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/README.html">
   Datasets
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/02_LinearForecastingTrendandMomentumForecasting/02_LinearTrendandMomentumForecasting.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/phdinds-aim/time_series_handbook"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/phdinds-aim/time_series_handbook/issues/new?title=Issue%20on%20page%20%2F02_LinearForecastingTrendandMomentumForecasting/02_LinearTrendandMomentumForecasting.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/phdinds-aim/time_series_handbook/main?urlpath=tree/02_LinearForecastingTrendandMomentumForecasting/02_LinearTrendandMomentumForecasting.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-use-this-notebook">
   How to Use This Notebook
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#linear-regression-lr-forecasting">
   Linear Regression (LR) Forecasting
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gauss-markov-assumptions">
     Gauss Markov Assumptions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-1-univariate-lr-in-stock-price-of-netflix">
     Example 1: Univariate LR in Stock Price of Netflix
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#testing-for-stationarity">
       Testing for Stationarity
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#testing-for-autocorrelation">
       Testing for Autocorrelation
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#compare-with-model-where-x-x-t-1">
       Compare with model where
       <span class="math notranslate nohighlight">
        \(X=X_{t-1}\)
       </span>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-2-univariate-forecasting-using-jena-climate-data">
     Example 2. Univariate Forecasting using Jena Climate Data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#simultaneous-prediction-of-temperature-in-the-next-24-hours">
       Simultaneous prediction of temperature in the next 24 hours
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-3-multivariate-linear-regression-and-regularization-techniques">
     Example 3: Multivariate Linear Regression and Regularization Techniques
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#interpretation-of-coefficients">
       Interpretation of coefficients:
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#interpretation-of-metrics">
       Interpretation of metrics:
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#l1-lasso-and-l2-ridge-regularization-for-multi-variate-linear-regression">
     L1 (Lasso) and L2 (Ridge) regularization for multi-variate linear regression
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#lasso-regularization">
       Lasso Regularization
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#ridge-regularization">
       Ridge Regularization
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#l1-regularization">
       L1 Regularization
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#l2-regularization">
       L2 Regularization
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-4-multi-variate-linear-regression-on-jena-climate-data">
     Example 4: Multi-variate Linear Regression on Jena Climate Data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       L1 Regularization
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       L2 Regularization
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#simultaneous-prediction-of-the-temperature-for-the-next-24-hours">
       Simultaneous prediction of the temperature for the next 24 hours
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#momentum-and-trend-forecasting">
   Momentum and Trend Forecasting
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#moving-average-ma">
     Moving Average MA
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-5-extracting-the-trend-in-climate-data-using-ma">
     Example 5: Extracting the Trend in Climate Data Using MA
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#momentum-strategies">
     Momentum Strategies
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#how-to-apply-momentum-strategy">
       How to apply momentum strategy:
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-6-momentum-trading-strategy-using-two-ma-s">
     Example 6: Momentum Trading Strategy Using Two MA’s
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-7-momentum-trading-strategy-using-macd">
     Example 7: Momentum Trading Strategy Using MACD
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#macd-indicators">
       MACD Indicators
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preview-to-the-next-chapter">
   Preview to the next chapter…
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="chapter-2-linear-trend-and-momentum-forecasting">
<h1>Chapter 2: Linear, Trend, and Momentum Forecasting<a class="headerlink" href="#chapter-2-linear-trend-and-momentum-forecasting" title="Permalink to this headline">¶</a></h1>
<p>Prepared by: Marissa P. Liponhay and Maria Eloisa M. Ventura</p>
<p>In this chapter we introduce basic tools on forecasting, which utilize simple algebraic formula. In the previous chapter, ARIMA was discussed where the future values of a time series are forecasted using its past or lagged values. It was shown that ARIMA can only be applied after removing the trend and seasonality of the data. We note however that for some forecasting tools, the trend is relevant and is part of the formula for prediction. In this work, forecasting will be demonstrated while making use of the relationships and trends in the data.</p>
<p>In the first half of this notebook, we demonstrate forecasting by fitting time series data with linear regression. For the second half, we demonstrate that by using the trends of the time series data such as moving averages, we can predict the possible future direction of the trend using momentum forecasting.</p>
<p>Lastly, it is important to note that the concept of moving average (MA) in ARIMA is not the same in this chapter since the moving average that will be discussed is just the classical definition of MA.</p>
<div class="section" id="how-to-use-this-notebook">
<h2>How to Use This Notebook<a class="headerlink" href="#how-to-use-this-notebook" title="Permalink to this headline">¶</a></h2>
<p>This chapter is divided into two parts mainly about: (a) linear regression and (b) trend and momentum forecasting  using moving averages. In each section, the theory is discussed followed by examples that are implemented in Python 3. The chapter outline can be seen in the <strong><span class="xref myst">readme</span></strong> file for this chapter.</p>
</div>
<div class="section" id="linear-regression-lr-forecasting">
<h2>Linear Regression (LR) Forecasting<a class="headerlink" href="#linear-regression-lr-forecasting" title="Permalink to this headline">¶</a></h2>
<p>Linear regression forecasting is used when forecasting a time series y, with the assumption that it has a linear relationship with another time series x.</p>
<p>The basic equation in doing linear regression is:
<span class="math notranslate nohighlight">\(y= mx + b \)</span></p>
<p>where <span class="math notranslate nohighlight">\(m\)</span> is the slope of the linear fit and <span class="math notranslate nohighlight">\(b\)</span> is the <span class="math notranslate nohighlight">\(y\)</span> intercept which represents error in the fit. Usually in forecasting, <span class="math notranslate nohighlight">\(y\)</span> is replaced by <span class="math notranslate nohighlight">\(\hat{y}\)</span> to symbolize the forecasted value.</p>
<p>Given a data set, one can easily compute for the slope of the data manually or automatically using excel built-in trendline functions. To manually calculate <span class="math notranslate nohighlight">\(m\)</span>, the following equation is used:</p>
<p><span class="math notranslate nohighlight">\(m = {\frac{\sum\limits _{i=1} ^{n}(x_{i}-\bar{x})(y_{i}-\bar{y})}{\sum\limits _{i=1} ^{n}(x_{i}-\bar{x})^2}}\)</span></p>
<p>To automatically calculate it in excel, one only needs to place a linear ‘trendline’ into the scatter plot of the data.</p>
<p>This method is called the Ordinary least squares (OLS). A more general equation of LR using OLS is given as:</p>
<p><span class="math notranslate nohighlight">\(y= mx + b + \mu_{i}\)</span></p>
<p>where <span class="math notranslate nohighlight">\(\mu_{i}\)</span> represent the outliers or the terms that cannot fit into the regression line.</p>
<p>OLS quantifies the  evaluation of different regression lines. Using OLS, the regression line that minimizes the sum of the squares of the differences between the observed dependent variable and the predicted dependent variable is chosen as the best fit.</p>
<p>But what if there are outliers causing the best regression by OLS do not really fit the data? This leads us to check when OLS can be applied to a data set. The following are the assumptions that are necessarily met before we can apply OLS.</p>
<div class="section" id="gauss-markov-assumptions">
<h3>Gauss Markov Assumptions<a class="headerlink" href="#gauss-markov-assumptions" title="Permalink to this headline">¶</a></h3>
<p>The following assumptions for sampled data (from a population) should be met so that the parameters calculated using OLS indeed represent the best unbiased estimator of the population parameters.</p>
<ol class="simple">
<li><p>Linearity in parameters. This assumption requires that parameter <span class="math notranslate nohighlight">\(m\)</span> is linear. (Independent variable is not required to be linear).</p></li>
<li><p>Both the independent and dependent variables <span class="math notranslate nohighlight">\((x,y)\)</span> are random variables. This will result to zero autocorrelation of outlier or the residual term.</p></li>
<li><p>For multivariate regression method,there should be no perfect collinearity between multiple independent variables. To test for the presence of collinearity, <span class="math notranslate nohighlight">\(R^{2}\)</span> is good.</p></li>
<li><p>The outlier aka residual term <span class="math notranslate nohighlight">\(\mu\)</span> is endogenous, such that <span class="math notranslate nohighlight">\(cov(\mu_{i}, x_{i})=0\)</span>=0.</p></li>
<li><p>Homoscedasticity in residual term <span class="math notranslate nohighlight">\(\mu_{i}\)</span>, in other words, the variance of <span class="math notranslate nohighlight">\(\mu_i\)</span> is independent of <span class="math notranslate nohighlight">\(x_i\)</span>.</p></li>
<li><p>The residual term <span class="math notranslate nohighlight">\(\mu_{i}\)</span> have zero autocorrelation, i.e., <span class="math notranslate nohighlight">\(cov(\mu_{i}, \mu_{j})=0\)</span>.</p></li>
</ol>
<p>Using OLS for time series data, the samples are drawn from the same process, and we can no longer assume that the independent variable <span class="math notranslate nohighlight">\(x\)</span> is random variable. In this case, the assumptions (4-6) should be strictly met by all <span class="math notranslate nohighlight">\(x\)</span> at all points.</p>
</div>
<div class="section" id="example-1-univariate-lr-in-stock-price-of-netflix">
<h3>Example 1: Univariate LR in Stock Price of Netflix<a class="headerlink" href="#example-1-univariate-lr-in-stock-price-of-netflix" title="Permalink to this headline">¶</a></h3>
<p>Linear regression is one of the most successful tools used in technical analysis of prices and is widely available as a charting tool. For the sake of demonstration, we will use the historical data of Netflix downloaded from Yahoo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">pandas.plotting</span> <span class="kn">import</span> <span class="n">autocorrelation_plot</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics</span> <span class="kn">import</span> <span class="n">tsaplots</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="c1">#from sklearn.model_selection </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">price</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/NFLX3.csv&#39;</span><span class="p">,</span><span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Close&#39;</span><span class="p">],</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>
<span class="n">price</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">=</span><span class="n">price</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Price&#39;</span><span class="p">)</span>
<span class="c1"># plt.grid()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Daily Close Price&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_LinearTrendandMomentumForecasting_4_0.png" src="../_images/02_LinearTrendandMomentumForecasting_4_0.png" />
</div>
</div>
<div class="section" id="testing-for-stationarity">
<h4>Testing for Stationarity<a class="headerlink" href="#testing-for-stationarity" title="Permalink to this headline">¶</a></h4>
<p>We have learned from the previous chapter that one of the first steps to do when doing time series forecasting is to check the stationarity of the data, especially when there is a prominent trend. In this notebook, we will use the most widely used statistical test called the Augmented Dickey-Fuller, a unit root test. Note that a unit root test determines how strongly a time series is defined by a trend. The test uses an autoregressive model and optimizes an information criterion across different lag values. Recall that:</p>
<p>Null Hypothesis (H0):</p>
<ul class="simple">
<li><p>The time series has a unit root and is non-stationary. It is time dependent.</p></li>
</ul>
<p>Alternate Hypothesis (H1):</p>
<ul class="simple">
<li><p>The time series does not have a unit root and is stationary. It is not time-dependent.</p></li>
</ul>
<p>Finally, the result of the test can be interpreted using the ADF Statistic, i.e., the ADF statistic should be lesser than the critical values for the data to be considered stationary.</p>
<p>In some references, they use p-value from the test. A p-value below a threshold (such as 5% or 1%) implies a stationary time series, otherwise the data is non-stationary.</p>
<p>p-value &lt;= 0.05: The time series is stationary.</p>
<p>p-value &gt; 0.05: The time series is non-stationary.</p>
<p>In other references, they simply compare the ADF statistic to the critical values, such that if it is greater than the critical values, the time series is said to be non-stationary.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span>
<span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/NFLX3.csv&#39;</span><span class="p">,</span><span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">])</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">values</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ADF Statistic: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p-value: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Critical Values:&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s1">: </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ADF Statistic: -0.027586
p-value: 0.956190
Critical Values:
	1%: -3.446
	5%: -2.868
	10%: -2.570
</pre></div>
</div>
</div>
</div>
<p>Based on the results, the time series in non-stationary at all significance levels (1%,…) as the ADF statistic is greater the the critical values.</p>
</div>
<div class="section" id="testing-for-autocorrelation">
<h4>Testing for Autocorrelation<a class="headerlink" href="#testing-for-autocorrelation" title="Permalink to this headline">¶</a></h4>
<p>The autocorrelation coefficient measures the strength of the relationship between the data and its lag. The first coefficient measures the relationship between <span class="math notranslate nohighlight">\(y_{t}\)</span> to <span class="math notranslate nohighlight">\(y_{t-1}\)</span>, while the second coefficient measures the relationship between <span class="math notranslate nohighlight">\(y_{t}\)</span> to <span class="math notranslate nohighlight">\(y_{t-2}\)</span>, and so on.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># testing autocorrelation using pandas tools.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">tsaplots</span><span class="o">.</span><span class="n">plot_acf</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_LinearTrendandMomentumForecasting_9_0.png" src="../_images/02_LinearTrendandMomentumForecasting_9_0.png" />
</div>
</div>
<p>Another way to visualize the autocorrellation using pandas tools with respect to lag is shown below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">autocorrelation_plot</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Lag&#39;, ylabel=&#39;Autocorrelation&#39;&gt;
</pre></div>
</div>
<img alt="../_images/02_LinearTrendandMomentumForecasting_11_1.png" src="../_images/02_LinearTrendandMomentumForecasting_11_1.png" />
</div>
</div>
<p>One can better imagine the concept of lagged autocorrelation if we make the lagged data as a moving version of the original data and look at the overlap (in this case, their autocorrelation). If the trends of the original are both goin up or down as the lagged data is moved, the correlation is positive, otherwise negative.</p>
<p>Referring back to the autocorrelation plot vs lag, the plot shows that as the lag increases, the trend decreases. The strong relationship of the data with the first 100 lags shows that <span class="math notranslate nohighlight">\(y\)</span> is not purely random as stated in the Gauss-Markov assumption. At lag of approximately equal to 120 days, the autocorrelation is zero and starts to be negative. This is because the trend of the lagged data becomes negative in contrast to the positive trend of the data.</p>
<p>Here we see that after approximately <span class="math notranslate nohighlight">\(y_{t-320}\)</span>, the autocorrelation is zero. This is mainly because the overlap of the lagged data and the original data is minimal as less and less data are overlapped.</p>
<p>Now assuming that 4-6 are met, we will now apply linear regression to the price of NFLX to predict the prices for the next month on a daily basis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let us create another variable to manipulate rather than using the original data </span>

<span class="n">window</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">price2</span> <span class="o">=</span> <span class="n">price</span><span class="p">[[</span><span class="s1">&#39;Close&#39;</span><span class="p">]]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">price2</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="c1"># plt.grid()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Date&#39;&gt;
</pre></div>
</div>
<img alt="../_images/02_LinearTrendandMomentumForecasting_15_1.png" src="../_images/02_LinearTrendandMomentumForecasting_15_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># With the goal of predicting the future prices daily for a month (30days), we create a variable to contain the size</span>
<span class="c1"># it will be placed at the end of a variable &#39;Prediction&#39; in the dataframe that is shifted by 30 days</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">price2</span><span class="p">[</span><span class="s1">&#39;Prediction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price2</span><span class="p">[[</span><span class="s1">&#39;Close&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="n">window</span><span class="p">)</span>

<span class="n">price2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_LinearTrendandMomentumForecasting_16_0.png" src="../_images/02_LinearTrendandMomentumForecasting_16_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">price2</span><span class="p">[[</span><span class="s1">&#39;Close&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(443, 1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">price2</span><span class="p">[[</span><span class="s1">&#39;Prediction&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(443, 1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now we will use the original data on prices as X, the predicted data as y and use 80% of the data as training set </span>
<span class="c1"># while 20% of the data as test set and use sklearn function to train and test the data.</span>
<span class="c1"># for both variables, the last 30 values are removed.</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">price2</span><span class="p">[[</span><span class="s1">&#39;Close&#39;</span><span class="p">]])</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="o">-</span><span class="n">window</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">price2</span><span class="p">[</span><span class="s1">&#39;Prediction&#39;</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="n">window</span><span class="p">]</span>
<span class="c1">#print(y)</span>

<span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">2020</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>413
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(413, 1)
</pre></div>
</div>
</div>
</div>
<p>Now the data is ready for linear regression training and fitting using sklearn.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(330,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## coefficients of linear fit are:</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">intercept_</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">coef_</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;the equation of the linear fit is: &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;y= &#39;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="s1">&#39;x + &#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="c1"># checking R^2</span>
<span class="n">R_sqd</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lr confidence: &quot;</span><span class="p">,</span> <span class="n">R_sqd</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>the equation of the linear fit is: 
y=  [0.98010473] x +  17.065244311865115
lr confidence:  0.720499481096278
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To show the relationship of the training set and the predicted prices.. we plot the following.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x_train&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y_train&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_train</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_train</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;regression line&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fbc6a183a50&gt;
</pre></div>
</div>
<img alt="../_images/02_LinearTrendandMomentumForecasting_25_1.png" src="../_images/02_LinearTrendandMomentumForecasting_25_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Here is an attempt to show that the difference between the training set and the predicted values are almost Gaussian</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span><span class="o">-</span><span class="n">y_train</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">125</span><span class="p">,</span> <span class="mi">126</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_LinearTrendandMomentumForecasting_26_0.png" src="../_images/02_LinearTrendandMomentumForecasting_26_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setting the last 30 rows of the original Close price as test data </span>
<span class="c1"># to predict the next values. </span>
<span class="n">x_forecast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">price2</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Prediction&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">))[</span><span class="o">-</span><span class="n">window</span><span class="p">:]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_forecast</span><span class="p">))</span>

<span class="c1"># # we predict the closing prices...</span>
<span class="n">lr_prediction</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_forecast</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lr_prediction</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>30
30
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x_test&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y_test&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_test</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">))</span>
<span class="c1"># plt.legend()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7fbc6a3d9290&gt;]
</pre></div>
</div>
<img alt="../_images/02_LinearTrendandMomentumForecasting_28_1.png" src="../_images/02_LinearTrendandMomentumForecasting_28_1.png" />
</div>
</div>
<p>Now, we try to plot the predicted values over the original time series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">price2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">price2</span><span class="o">.</span><span class="n">Prediction</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;y_train&#39;</span><span class="p">)</span>
<span class="n">price2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">price2</span><span class="o">.</span><span class="n">Prediction</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;y_test&#39;</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">price2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">price2</span><span class="o">.</span><span class="n">Prediction</span><span class="o">.</span><span class="n">isnull</span><span class="p">()][[</span><span class="s1">&#39;Close&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> 
          <span class="n">index</span><span class="o">=</span><span class="n">price2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">price2</span><span class="o">.</span><span class="n">Prediction</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
          <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Pred_LR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;y_pred from regression&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fbc6a425650&gt;
</pre></div>
</div>
<img alt="../_images/02_LinearTrendandMomentumForecasting_30_1.png" src="../_images/02_LinearTrendandMomentumForecasting_30_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># checking R^2</span>
<span class="n">R_sqd_train</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_pred</span><span class="o">=</span><span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_train</span><span class="p">),</span> <span class="n">y_true</span><span class="o">=</span><span class="n">y_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Train set R^2: &quot;</span><span class="p">,</span> <span class="n">R_sqd_train</span><span class="p">)</span>

<span class="c1">## R^2 of the predicted vs the actual closing price...</span>
<span class="n">R_sqd_test</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_pred</span><span class="o">=</span><span class="n">lr_prediction</span><span class="p">,</span> <span class="n">y_true</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="n">window</span><span class="p">:])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test set R^2: &quot;</span><span class="p">,</span> <span class="n">R_sqd_test</span><span class="p">)</span>

<span class="c1"># checking for the MAE values:</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The mean absolute error, MAE is: &quot;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">lr_prediction</span><span class="p">,</span> <span class="n">x_forecast</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Train set R^2:  0.7682299277930607
Test set R^2:  0.9187750163794539
The mean absolute error, MAE is:  6.973973107834818
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="compare-with-model-where-x-x-t-1">
<h4>Compare with model where <span class="math notranslate nohighlight">\(X=X_{t-1}\)</span><a class="headerlink" href="#compare-with-model-where-x-x-t-1" title="Permalink to this headline">¶</a></h4>
<p>Here, we check the R^2 value with respect to the lagged series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r2_score</span><span class="p">(</span><span class="n">price</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">price</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9814904294769093
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setting the last 30 rows of the original Close price as the variable x_forecast2 and using it as the </span>
<span class="c1"># test data to predict the next values. </span>

<span class="n">x_forecast2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">price2</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Prediction&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">))[</span><span class="o">-</span><span class="n">window</span><span class="p">:]</span>
<span class="c1"># print(len(x_forecast))</span>

<span class="c1"># # we predict the closing prices...</span>
<span class="n">lr_prediction2</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_forecast2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lr_prediction</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>30
</pre></div>
</div>
</div>
</div>
<p>Now we check the relationship between the test data and the prediction, we see that there is a perfect linear relationship as seen below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">linregress</span>
<span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r_value</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">x_forecast</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">lr_prediction2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_forecast2</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">lr_prediction2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7fbc6a0f38d0&gt;]
</pre></div>
</div>
<img alt="../_images/02_LinearTrendandMomentumForecasting_37_1.png" src="../_images/02_LinearTrendandMomentumForecasting_37_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="example-2-univariate-forecasting-using-jena-climate-data">
<h3>Example 2. Univariate Forecasting using Jena Climate Data<a class="headerlink" href="#example-2-univariate-forecasting-using-jena-climate-data" title="Permalink to this headline">¶</a></h3>
<p>We will use the temperature values of the data in this part of the chapter to see if we can forecast the next 24hr temperature values. For this book, the data has been divided into training_series, validation_series, and test_series as described in the preface. In this chapter, I do not need perform any validation procedure, thus I will combine the training and validation series and it will serve as my raw data. We will then follow the steps outlined in Example 1 and see the average MAE of the prediction using linear regression.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># combining the training and validation data sets used in this Jupyter book as our training set in this chapter </span>
<span class="c1"># since I don&#39;t need to perform validation.</span>
<span class="n">df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/train_series.csv&quot;</span><span class="p">)</span>
<span class="n">df2</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/val_series.csv&quot;</span><span class="p">)</span>

<span class="c1">## (training + validation series)</span>
<span class="n">df3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">df2</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1">#train</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1">#val</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df3</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1">#combined</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(35045, 15)
(17524, 15)
(52569, 15)
</pre></div>
</div>
</div>
</div>
<p>Now, we select the temperature data and use it for univariate linear regression forecasting and visualize the raw data. We keep the training data set to be a multiple of 24.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">len_train</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df3</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">df3</span><span class="p">)</span><span class="o">%</span><span class="k">24</span>
<span class="n">len_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>52560
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#using the temperature data</span>
<span class="n">temperature</span> <span class="o">=</span> <span class="n">df3</span><span class="p">[[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">len_train</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">=</span><span class="n">temperature</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;temp&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Hourly Temp&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_LinearTrendandMomentumForecasting_44_0.png" src="../_images/02_LinearTrendandMomentumForecasting_44_0.png" />
</div>
</div>
<p>To perform linear regression, we follow the same step we did in Example 1. We will use the shifted (by 24-hrs) temperature data (x-variable) as the prediction variable (y-variable). We get the equation by fitting with LR and use the equation in predicting the temperature in the next 24 hours.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">window</span> <span class="o">=</span> <span class="mi">24</span>
<span class="n">temperature</span><span class="p">[</span><span class="s1">&#39;Prediction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">[[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="n">window</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/test_series.csv&quot;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">17520</span><span class="p">]</span>
<span class="n">test_24</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">df4</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">730</span><span class="p">)))</span>
<span class="c1"># y_test = df4[[&#39;T (degC)&#39;]].iloc[:24]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">temperature</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Prediction&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">))</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="o">-</span><span class="n">window</span><span class="p">]</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">temperature</span><span class="p">[</span><span class="s1">&#39;Prediction&#39;</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="n">window</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(52536, 1)
(52536,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(52536,)
</pre></div>
</div>
</div>
</div>
<div class="section" id="simultaneous-prediction-of-temperature-in-the-next-24-hours">
<h4>Simultaneous prediction of temperature in the next 24 hours<a class="headerlink" href="#simultaneous-prediction-of-temperature-in-the-next-24-hours" title="Permalink to this headline">¶</a></h4>
<p>In order to make predictions for the next 24 hours, we will need to reshape our <span class="math notranslate nohighlight">\(X\)</span> and <span class="math notranslate nohighlight">\(y\)</span> data so that we can  use only one sample point <span class="math notranslate nohighlight">\(X\)</span> to predict the temperature for the next 24 hours.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Divide training data into 24 hour chunks</span>
<span class="c1"># Use 1 Temperature measurement to predict the next 24 hours</span>
<span class="n">X_new</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="n">window</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">24</span><span class="p">)[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y_new</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">[</span><span class="s1">&#39;Prediction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="n">window</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
<span class="n">X_new</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_new</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((2189, 1), (2189, 24))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">X_new</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[-4.5 ]
 [-4.45]
 [-2.46]
 ...
 [ 0.86]
 [-3.54]
 [-8.26]]
</pre></div>
</div>
</div>
</div>
<p>We create a vector that will contain the outputs of the fit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_vectoroutput</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">lr_vectoroutput</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we divide the test data into 24 hour chunks, which will serve as our test sets. The average MAE of these test sets will be calculated to see how Univariate LR performs in predicting the temperature in the next 24 hrs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">temperature</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="n">window</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                    <span class="n">test_24</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">])[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test_24</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## predict for every 24 hrs in test_series</span>
<span class="n">MAE</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">lr_vectoroutput</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)):</span>
    <span class="n">MAE</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y_pred</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The average Mean Absolute Error is for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span><span class="si">}</span><span class="s2"> sets of 24-hr data: &quot;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">MAE</span><span class="p">)</span><span class="o">/</span><span class="mi">730</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The average Mean Absolute Error is for 730 sets of 24-hr data:  9.067496890754962
</pre></div>
</div>
</div>
</div>
<p>We see that the average MAE is 9.067496890754962, which shows that LR is not a good model for forecasting the next 24-hr temperature using the Jena Climate Data.</p>
</div>
</div>
<div class="section" id="example-3-multivariate-linear-regression-and-regularization-techniques">
<h3>Example 3: Multivariate Linear Regression and Regularization Techniques<a class="headerlink" href="#example-3-multivariate-linear-regression-and-regularization-techniques" title="Permalink to this headline">¶</a></h3>
<p>In the previous example, we used univariate LR to demonstrate forecasting time series. In this example, we would like to demonstrate LR for a case where there are more than 1 independent variable, called the multivariate linear regression. To start off, we demonstrate the LR model first using a simple data on cars downloaded from one of the references. Take note that this is not yet forecasting in time series, but just a simple demonstration how multivariate LR works.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#creating dataframe for simple data on cars</span>
<span class="n">cars</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/cars.csv&#39;</span><span class="p">)</span>
<span class="n">cars</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Car</th>
      <th>Model</th>
      <th>Volume</th>
      <th>Weight</th>
      <th>CO2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Toyoty</td>
      <td>Aygo</td>
      <td>1000</td>
      <td>790</td>
      <td>99</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Mitsubishi</td>
      <td>Space Star</td>
      <td>1200</td>
      <td>1160</td>
      <td>95</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Skoda</td>
      <td>Citigo</td>
      <td>1000</td>
      <td>929</td>
      <td>95</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Fiat</td>
      <td>500</td>
      <td>900</td>
      <td>865</td>
      <td>90</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Mini</td>
      <td>Cooper</td>
      <td>1500</td>
      <td>1140</td>
      <td>105</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cars</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Volume</th>
      <th>Weight</th>
      <th>CO2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>36.000000</td>
      <td>36.000000</td>
      <td>36.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1611.111111</td>
      <td>1292.277778</td>
      <td>102.027778</td>
    </tr>
    <tr>
      <th>std</th>
      <td>388.975047</td>
      <td>242.123889</td>
      <td>7.454571</td>
    </tr>
    <tr>
      <th>min</th>
      <td>900.000000</td>
      <td>790.000000</td>
      <td>90.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1475.000000</td>
      <td>1117.250000</td>
      <td>97.750000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1600.000000</td>
      <td>1329.000000</td>
      <td>99.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>2000.000000</td>
      <td>1418.250000</td>
      <td>105.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2500.000000</td>
      <td>1746.000000</td>
      <td>120.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>

<span class="c1"># We will model C02 emission (as y variable) using the parameters volume and weight as predictors (x variable)</span>
<span class="c1"># for a multi-variate linear regression</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Volume&#39;</span><span class="p">,</span> <span class="s1">&#39;Weight&#39;</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">cars</span><span class="p">[</span><span class="n">params</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">cars</span><span class="p">[</span><span class="s1">&#39;CO2&#39;</span><span class="p">]</span>

<span class="c1"># fitting the data with linear regression</span>
<span class="n">lrm</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">lrm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># coefficients of the fit are as follows:</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">intercept_</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">coef_</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using Multivariate Linear Regression, we have the following equation: &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CO2= &#39;</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;x1 + &#39;</span><span class="p">,</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;x2 + &#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="c1">#We want to predict CO2 emission given specific weight and volume -- both 1000</span>
<span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">([[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Using Multivariate Linear Regression, we have the following equation: 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CO2=  0.007805257527747128 x1 +  0.007550947270300682 x2 +  79.69471929115939
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([95.05092409])
</pre></div>
</div>
</div>
</div>
<div class="section" id="interpretation-of-coefficients">
<h4>Interpretation of coefficients:<a class="headerlink" href="#interpretation-of-coefficients" title="Permalink to this headline">¶</a></h4>
<p>The slope for volume and weight of the cars are equal to 0.00781 and 0.00755, respectively. This means that for every 1 unit change in volume (weight) of cars, the expected increase in CO2 emission is 0.00781% (0.00755%).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">lrm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean Absolute Error:&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Absolute Error: 5.670405502652304
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="interpretation-of-metrics">
<h4>Interpretation of metrics:<a class="headerlink" href="#interpretation-of-metrics" title="Permalink to this headline">¶</a></h4>
<p>We can see that the value of mean absolute error is 5.67, which is less than 6% of the mean value of the CO2 emission. This means that our prediction is good.</p>
<p>For multi-variate linear regression, sometimes we do not know which among the parameters are relevant to the prediction. Thus in order to make our predictions more accurate, we need to penalize the less relevant parameters (or basically decrease their effect on our predictions and sometimes let them approach zero). This is usually done using regularization techniques.</p>
</div>
</div>
<div class="section" id="l1-lasso-and-l2-ridge-regularization-for-multi-variate-linear-regression">
<h3>L1 (Lasso) and L2 (Ridge) regularization for multi-variate linear regression<a class="headerlink" href="#l1-lasso-and-l2-ridge-regularization-for-multi-variate-linear-regression" title="Permalink to this headline">¶</a></h3>
<p>Regularization techniques is based on the idea that proper constraining the allowed values of variables will increase the accuracy. In this notebook, we will use two techniques:</p>
<div class="section" id="lasso-regularization">
<h4>Lasso Regularization<a class="headerlink" href="#lasso-regularization" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>It puts constraints on the absolute value of the coefficients.</p></li>
</ul>
</div>
<div class="section" id="ridge-regularization">
<h4>Ridge Regularization<a class="headerlink" href="#ridge-regularization" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>It puts contraints on the square of the coefficients.</p></li>
</ul>
</div>
<div class="section" id="l1-regularization">
<h4>L1 Regularization<a class="headerlink" href="#l1-regularization" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lasso Regularization... alpha=0 is equivalent to linear regression</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Lasso</span>
<span class="n">lassoreg</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model3</span> <span class="o">=</span> <span class="n">lassoreg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>


<span class="c1"># coefficients of the fit are as follows:</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">model3</span><span class="o">.</span><span class="n">intercept_</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">model3</span><span class="o">.</span><span class="n">coef_</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using Multivariate Linear Regression, we have the following equation: &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CO2= &#39;</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;x1 + &#39;</span><span class="p">,</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;x2 + &#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Using Multivariate Linear Regression, we have the following equation: 
CO2=  0.00771675835477406 x1 +  0.007406759259298179 x2 +  80.02363225450095
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">lassoreg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean Absolute Error:&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Absolute Error: 5.65574080048904
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="l2-regularization">
<h4>L2 Regularization<a class="headerlink" href="#l2-regularization" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ridge Regularization... alpha=0 is equivalent to linear regression</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>
<span class="n">ridgereg</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model2</span> <span class="o">=</span> <span class="n">ridgereg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># coefficients of the fit are as follows:</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">model2</span><span class="o">.</span><span class="n">intercept_</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">model2</span><span class="o">.</span><span class="n">coef_</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using Multivariate Linear Regression, we have the following equation: &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CO2= &#39;</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;x1 + &#39;</span><span class="p">,</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;x2 + &#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Using Multivariate Linear Regression, we have the following equation: 
CO2=  0.007019810017740837 x1 +  0.007728894654883428 x2 +  80.73020505101512
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">ridgereg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean Absolute Error:&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Absolute Error: 5.610220319986727
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="example-4-multi-variate-linear-regression-on-jena-climate-data">
<h3>Example 4: Multi-variate Linear Regression on Jena Climate Data<a class="headerlink" href="#example-4-multi-variate-linear-regression-on-jena-climate-data" title="Permalink to this headline">¶</a></h3>
<p>In this section, we use the climate data to demonstrate forecasting using multivariate linear regression and regularization. The idea of forecasting method in this example is different from the method used in Example 1. In Example 1, we used the lagged value of the close prices of NFLX, i.e., we predicted <span class="math notranslate nohighlight">\(y_{T,t}\)</span> using the lagged value <span class="math notranslate nohighlight">\(y_{T-30}\)</span>. In this example, we will use different variables <span class="math notranslate nohighlight">\(x_{1,t}\)</span>, <span class="math notranslate nohighlight">\(x_{2,t}\)</span>,…, <span class="math notranslate nohighlight">\(x_{n,t}\)</span>, where n is the total number of variables used to predict y. In this case, n=14.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/train_series_datetime.csv&#39;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">val_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/val_series_datetime.csv&#39;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train_df</span><span class="p">,</span> <span class="n">val_df</span><span class="p">])</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date Time</th>
      <th>p (mbar)</th>
      <th>T (degC)</th>
      <th>Tpot (K)</th>
      <th>Tdew (degC)</th>
      <th>rh (%)</th>
      <th>VPmax (mbar)</th>
      <th>VPact (mbar)</th>
      <th>VPdef (mbar)</th>
      <th>sh (g/kg)</th>
      <th>H2OC (mmol/mol)</th>
      <th>rho (g/m**3)</th>
      <th>wv (m/s)</th>
      <th>max. wv (m/s)</th>
      <th>wd (deg)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01.01.2009 00:10:00</td>
      <td>996.52</td>
      <td>-8.02</td>
      <td>265.40</td>
      <td>-8.90</td>
      <td>93.3</td>
      <td>3.33</td>
      <td>3.11</td>
      <td>0.22</td>
      <td>1.94</td>
      <td>3.12</td>
      <td>1307.75</td>
      <td>1.03</td>
      <td>1.75</td>
      <td>152.3</td>
    </tr>
    <tr>
      <th>6</th>
      <td>01.01.2009 01:10:00</td>
      <td>996.50</td>
      <td>-7.62</td>
      <td>265.81</td>
      <td>-8.30</td>
      <td>94.8</td>
      <td>3.44</td>
      <td>3.26</td>
      <td>0.18</td>
      <td>2.04</td>
      <td>3.27</td>
      <td>1305.68</td>
      <td>0.18</td>
      <td>0.63</td>
      <td>166.5</td>
    </tr>
    <tr>
      <th>12</th>
      <td>01.01.2009 02:10:00</td>
      <td>996.63</td>
      <td>-8.85</td>
      <td>264.57</td>
      <td>-9.70</td>
      <td>93.5</td>
      <td>3.12</td>
      <td>2.92</td>
      <td>0.20</td>
      <td>1.82</td>
      <td>2.93</td>
      <td>1312.11</td>
      <td>0.16</td>
      <td>0.50</td>
      <td>158.3</td>
    </tr>
    <tr>
      <th>18</th>
      <td>01.01.2009 03:10:00</td>
      <td>996.87</td>
      <td>-8.84</td>
      <td>264.56</td>
      <td>-9.69</td>
      <td>93.5</td>
      <td>3.13</td>
      <td>2.92</td>
      <td>0.20</td>
      <td>1.83</td>
      <td>2.93</td>
      <td>1312.37</td>
      <td>0.07</td>
      <td>0.25</td>
      <td>129.3</td>
    </tr>
    <tr>
      <th>24</th>
      <td>01.01.2009 04:10:00</td>
      <td>997.05</td>
      <td>-9.23</td>
      <td>264.15</td>
      <td>-10.25</td>
      <td>92.2</td>
      <td>3.03</td>
      <td>2.79</td>
      <td>0.24</td>
      <td>1.74</td>
      <td>2.80</td>
      <td>1314.62</td>
      <td>0.10</td>
      <td>0.38</td>
      <td>203.9</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="c1"># print(data.shape)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>p (mbar)</th>
      <th>T (degC)</th>
      <th>Tpot (K)</th>
      <th>Tdew (degC)</th>
      <th>rh (%)</th>
      <th>VPmax (mbar)</th>
      <th>VPact (mbar)</th>
      <th>VPdef (mbar)</th>
      <th>sh (g/kg)</th>
      <th>H2OC (mmol/mol)</th>
      <th>rho (g/m**3)</th>
      <th>wv (m/s)</th>
      <th>max. wv (m/s)</th>
      <th>wd (deg)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>52569.000000</td>
      <td>52569.000000</td>
      <td>52569.000000</td>
      <td>52569.000000</td>
      <td>52569.000000</td>
      <td>52569.000000</td>
      <td>52569.000000</td>
      <td>52569.000000</td>
      <td>52569.000000</td>
      <td>52569.000000</td>
      <td>52569.000000</td>
      <td>52569.000000</td>
      <td>52569.000000</td>
      <td>52569.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>988.705288</td>
      <td>9.194491</td>
      <td>283.277435</td>
      <td>4.788269</td>
      <td>76.393381</td>
      <td>13.377285</td>
      <td>9.463628</td>
      <td>3.913601</td>
      <td>5.980737</td>
      <td>9.573651</td>
      <td>1216.601158</td>
      <td>2.142079</td>
      <td>3.538136</td>
      <td>173.890127</td>
    </tr>
    <tr>
      <th>std</th>
      <td>8.175879</td>
      <td>8.536547</td>
      <td>8.606957</td>
      <td>6.921408</td>
      <td>16.456302</td>
      <td>7.581065</td>
      <td>4.201507</td>
      <td>4.735824</td>
      <td>2.666735</td>
      <td>4.252759</td>
      <td>40.422708</td>
      <td>1.531838</td>
      <td>2.313626</td>
      <td>87.475968</td>
    </tr>
    <tr>
      <th>min</th>
      <td>914.100000</td>
      <td>-23.010000</td>
      <td>250.600000</td>
      <td>-25.010000</td>
      <td>14.200000</td>
      <td>0.950000</td>
      <td>0.790000</td>
      <td>0.000000</td>
      <td>0.500000</td>
      <td>0.800000</td>
      <td>1059.510000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>983.740000</td>
      <td>3.140000</td>
      <td>277.290000</td>
      <td>0.130000</td>
      <td>65.690000</td>
      <td>7.660000</td>
      <td>6.170000</td>
      <td>0.810000</td>
      <td>3.890000</td>
      <td>6.240000</td>
      <td>1187.930000</td>
      <td>1.000000</td>
      <td>1.780000</td>
      <td>121.800000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>989.130000</td>
      <td>9.340000</td>
      <td>283.450000</td>
      <td>5.220000</td>
      <td>79.700000</td>
      <td>11.760000</td>
      <td>8.860000</td>
      <td>2.100000</td>
      <td>5.600000</td>
      <td>8.970000</td>
      <td>1213.250000</td>
      <td>1.780000</td>
      <td>3.000000</td>
      <td>196.800000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>994.040000</td>
      <td>15.310000</td>
      <td>289.390000</td>
      <td>10.030000</td>
      <td>89.700000</td>
      <td>17.420000</td>
      <td>12.320000</td>
      <td>5.170000</td>
      <td>7.790000</td>
      <td>12.460000</td>
      <td>1242.850000</td>
      <td>2.880000</td>
      <td>4.760000</td>
      <td>234.200000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1012.840000</td>
      <td>35.650000</td>
      <td>309.590000</td>
      <td>23.110000</td>
      <td>100.000000</td>
      <td>58.340000</td>
      <td>28.320000</td>
      <td>42.120000</td>
      <td>18.130000</td>
      <td>28.820000</td>
      <td>1392.100000</td>
      <td>13.590000</td>
      <td>21.580000</td>
      <td>360.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>To be consistent with all the other forecasting models, we manually set the first 300k+ data for training while the last 100k+ data points as test set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_train</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(52569, 15)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_train</span> <span class="o">=</span> <span class="n">data_train</span><span class="p">[[</span><span class="s1">&#39;p (mbar)&#39;</span><span class="p">,</span> <span class="s1">&#39;Tpot (K)&#39;</span><span class="p">,</span> <span class="s1">&#39;Tdew (degC)&#39;</span><span class="p">,</span> <span class="s1">&#39;H2OC (mmol/mol)&#39;</span><span class="p">,</span> <span class="s1">&#39;rh (%)&#39;</span><span class="p">,</span> <span class="s1">&#39;VPmax (mbar)&#39;</span><span class="p">,</span> <span class="s1">&#39;VPact (mbar)&#39;</span><span class="p">,</span> <span class="s1">&#39;VPdef (mbar)&#39;</span><span class="p">,</span> <span class="s1">&#39;sh (g/kg)&#39;</span><span class="p">,</span> <span class="s1">&#39;rho (g/m**3)&#39;</span><span class="p">,</span> <span class="s1">&#39;wv (m/s)&#39;</span><span class="p">,</span> <span class="s1">&#39;max. wv (m/s)&#39;</span><span class="p">,</span> <span class="s1">&#39;wd (deg)&#39;</span><span class="p">]]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>p (mbar)</th>
      <th>T (degC)</th>
      <th>Tpot (K)</th>
      <th>Tdew (degC)</th>
      <th>rh (%)</th>
      <th>VPmax (mbar)</th>
      <th>VPact (mbar)</th>
      <th>VPdef (mbar)</th>
      <th>sh (g/kg)</th>
      <th>H2OC (mmol/mol)</th>
      <th>rho (g/m**3)</th>
      <th>wv (m/s)</th>
      <th>max. wv (m/s)</th>
      <th>wd (deg)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>996.52</td>
      <td>-8.02</td>
      <td>265.40</td>
      <td>-8.90</td>
      <td>93.3</td>
      <td>3.33</td>
      <td>3.11</td>
      <td>0.22</td>
      <td>1.94</td>
      <td>3.12</td>
      <td>1307.75</td>
      <td>1.03</td>
      <td>1.75</td>
      <td>152.3</td>
    </tr>
    <tr>
      <th>6</th>
      <td>996.50</td>
      <td>-7.62</td>
      <td>265.81</td>
      <td>-8.30</td>
      <td>94.8</td>
      <td>3.44</td>
      <td>3.26</td>
      <td>0.18</td>
      <td>2.04</td>
      <td>3.27</td>
      <td>1305.68</td>
      <td>0.18</td>
      <td>0.63</td>
      <td>166.5</td>
    </tr>
    <tr>
      <th>12</th>
      <td>996.63</td>
      <td>-8.85</td>
      <td>264.57</td>
      <td>-9.70</td>
      <td>93.5</td>
      <td>3.12</td>
      <td>2.92</td>
      <td>0.20</td>
      <td>1.82</td>
      <td>2.93</td>
      <td>1312.11</td>
      <td>0.16</td>
      <td>0.50</td>
      <td>158.3</td>
    </tr>
    <tr>
      <th>18</th>
      <td>996.87</td>
      <td>-8.84</td>
      <td>264.56</td>
      <td>-9.69</td>
      <td>93.5</td>
      <td>3.13</td>
      <td>2.92</td>
      <td>0.20</td>
      <td>1.83</td>
      <td>2.93</td>
      <td>1312.37</td>
      <td>0.07</td>
      <td>0.25</td>
      <td>129.3</td>
    </tr>
    <tr>
      <th>24</th>
      <td>997.05</td>
      <td>-9.23</td>
      <td>264.15</td>
      <td>-10.25</td>
      <td>92.2</td>
      <td>3.03</td>
      <td>2.79</td>
      <td>0.24</td>
      <td>1.74</td>
      <td>2.80</td>
      <td>1314.62</td>
      <td>0.10</td>
      <td>0.38</td>
      <td>203.9</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_train</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(52569, 14)
</pre></div>
</div>
</div>
</div>
<p>Again, for consistency with all the other forecasting models in this book, we use the same test set, which is the last 100k+ data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/test_series.csv&#39;</span><span class="p">)</span>
<span class="n">data_test</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(52569, 15)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_test</span> <span class="o">=</span> <span class="n">data_test</span><span class="p">[[</span><span class="s1">&#39;p (mbar)&#39;</span><span class="p">,</span> <span class="s1">&#39;Tpot (K)&#39;</span><span class="p">,</span> <span class="s1">&#39;Tdew (degC)&#39;</span><span class="p">,</span> <span class="s1">&#39;H2OC (mmol/mol)&#39;</span><span class="p">,</span> <span class="s1">&#39;rh (%)&#39;</span><span class="p">,</span> <span class="s1">&#39;VPmax (mbar)&#39;</span><span class="p">,</span> <span class="s1">&#39;VPact (mbar)&#39;</span><span class="p">,</span> <span class="s1">&#39;VPdef (mbar)&#39;</span><span class="p">,</span> <span class="s1">&#39;sh (g/kg)&#39;</span><span class="p">,</span> <span class="s1">&#39;rho (g/m**3)&#39;</span><span class="p">,</span> <span class="s1">&#39;wv (m/s)&#39;</span><span class="p">,</span> <span class="s1">&#39;max. wv (m/s)&#39;</span><span class="p">,</span> <span class="s1">&#39;wd (deg)&#39;</span><span class="p">]]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">data_test</span><span class="p">[[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># x_train, x_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=2020)</span>
<span class="n">lr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LinearRegression()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean Absolute Error:&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Absolute Error: 0.007450963714321594
</pre></div>
</div>
</div>
</div>
<p>We can see that the value of MAE error is 0.007635891353557461. This means that linear regression is good for this dataset if all the parameters are used. Now we try to use the regularization techniques if the errors will improve.</p>
<div class="section" id="id1">
<h4>L1 Regularization<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lasso Regularization... alpha=0 is equivalent to linear regression</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Lasso</span>
<span class="c1"># X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=2020)</span>
<span class="n">lassoreg2</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model_temp2</span> <span class="o">=</span> <span class="n">lassoreg2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred3</span> <span class="o">=</span> <span class="n">lassoreg2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean Absolute Error:&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Absolute Error: 1.832850814670404
</pre></div>
</div>
</div>
</div>
<p>L1 Regularization has worse performance having large errors, based on the metrics.</p>
</div>
<div class="section" id="id2">
<h4>L2 Regularization<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ridge Regularization... alpha=0 is equivalent to linear regression</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>
<span class="c1"># X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=2020)</span>

<span class="n">ridgereg2</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model_temp</span> <span class="o">=</span> <span class="n">ridgereg2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred2</span> <span class="o">=</span> <span class="n">ridgereg2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean Absolute Error:&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Absolute Error: 0.11708568925420203
</pre></div>
</div>
</div>
</div>
<p>Using L2 regularization, penalizing the other parameters didn’t lead to significant improvement in the prediction.</p>
</div>
<div class="section" id="simultaneous-prediction-of-the-temperature-for-the-next-24-hours">
<h4>Simultaneous prediction of the temperature for the next 24 hours<a class="headerlink" href="#simultaneous-prediction-of-the-temperature-for-the-next-24-hours" title="Permalink to this headline">¶</a></h4>
<p>In this part, we perform the same re-shaping of the data similar to what we did above when we applied univariate linear regression and use one sample point from each of the 730 24-hr test set described in Example 2 to predict the temperature for the next 24 hours.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_train</span> <span class="o">=</span> <span class="n">data_train</span><span class="p">[[</span><span class="s1">&#39;p (mbar)&#39;</span><span class="p">,</span> <span class="s1">&#39;Tpot (K)&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;Tdew (degC)&#39;</span><span class="p">,</span> <span class="s1">&#39;H2OC (mmol/mol)&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;rh (%)&#39;</span><span class="p">,</span> <span class="s1">&#39;VPmax (mbar)&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;VPact (mbar)&#39;</span><span class="p">,</span> <span class="s1">&#39;VPdef (mbar)&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;sh (g/kg)&#39;</span><span class="p">,</span> <span class="s1">&#39;rho (g/m**3)&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;wv (m/s)&#39;</span><span class="p">,</span> <span class="s1">&#39;max. wv (m/s)&#39;</span><span class="p">,</span> 
                      <span class="s1">&#39;wd (deg)&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">data_train</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">data_train</span><span class="p">)</span><span class="o">%</span><span class="k">24</span>]
<span class="n">y_train</span> <span class="o">=</span> <span class="n">data_train</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">data_train</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">data_train</span><span class="p">)</span><span class="o">%</span><span class="k">24</span>]

<span class="n">X_new</span> <span class="o">=</span> <span class="n">x_train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[::</span><span class="mi">24</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">y_new</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_sim</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">lr_sim</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LinearRegression()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_test_new</span> <span class="o">=</span> <span class="n">data_test</span><span class="p">[[</span><span class="s1">&#39;p (mbar)&#39;</span><span class="p">,</span> <span class="s1">&#39;Tpot (K)&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39;Tdew (degC)&#39;</span><span class="p">,</span> <span class="s1">&#39;H2OC (mmol/mol)&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39;rh (%)&#39;</span><span class="p">,</span> <span class="s1">&#39;VPmax (mbar)&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39;VPact (mbar)&#39;</span><span class="p">,</span> <span class="s1">&#39;VPdef (mbar)&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39;sh (g/kg)&#39;</span><span class="p">,</span> <span class="s1">&#39;rho (g/m**3)&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39;wv (m/s)&#39;</span><span class="p">,</span> <span class="s1">&#39;max. wv (m/s)&#39;</span><span class="p">,</span> 
                       <span class="s1">&#39;wd (deg)&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">data_test</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">data_test</span><span class="p">)</span><span class="o">%</span><span class="k">24</span>].iloc[::24].values
<span class="n">y_test_new</span> <span class="o">=</span> <span class="n">data_test</span><span class="p">[[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">data_test</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">data_test</span><span class="p">)</span><span class="o">%</span><span class="k">24</span>].values.reshape(-1, 24)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## predict for every 24 hrs in test_series</span>
<span class="n">MAE</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">lr_sim</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test_new</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_test_new</span><span class="p">)):</span>
    <span class="n">MAE</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test_new</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y_pred</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The average Mean Absolute Error is for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">y_test_new</span><span class="p">)</span><span class="si">}</span><span class="s2"> sets of 24-hr data: &quot;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">MAE</span><span class="p">)</span><span class="o">/</span><span class="mi">730</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The average Mean Absolute Error is for 730 sets of 24-hr data:  2.8599732777663385
</pre></div>
</div>
</div>
</div>
<p>We can see that the MAE improved compared to the MAE when we forecasted the temperature for the next 24 hours using univariate LR.</p>
</div>
</div>
</div>
<div class="section" id="momentum-and-trend-forecasting">
<h2>Momentum and Trend Forecasting<a class="headerlink" href="#momentum-and-trend-forecasting" title="Permalink to this headline">¶</a></h2>
<p>Now let us move to common tools in momentum and trend forecasting. We will see that these two topics on momentum and trend goes together, i.e., the momentum forecasting is based on the usage of trend forecasting. In this section, we will discuss by considering the applications in technical analysis and strategies in stock trading. In this are, the most common used tools are</p>
<ol class="simple">
<li><p>Moving Average</p></li>
<li><p>Momentum</p></li>
</ol>
<div class="section" id="moving-average-ma">
<h3>Moving Average MA<a class="headerlink" href="#moving-average-ma" title="Permalink to this headline">¶</a></h3>
<p>MA trading rule is the most popular trading tool for traders. The trading signal or indicator is normally derived by first computing for the average closing price over a window of size <span class="math notranslate nohighlight">\(n\)</span>, with the following formula:</p>
<p><span class="math notranslate nohighlight">\(MA_{n}(t) = \frac{w_{0}P_{t}+ w_{1}P_{t-1}+ w_{2}P_{t-2}+...+ w_{n-1}P_{t-n+1}}{w_{0}+ w_{1}+ w_{2}+... + w_{n-1}}\)</span> (1)</p>
<p><span class="math notranslate nohighlight">\(MA_{n}(t) = \frac{\sum\limits _{i=0} ^{n-1} w_{i}P_{t-i}}{\sum\limits _{i=0} ^{n-1} w_{i}}\)</span> (2)</p>
<p>There are three types of MA and they are as follows:</p>
<ol class="simple">
<li><p>Simple Moving Average (SMA) - all prices are weighted equally such that <span class="math notranslate nohighlight">\(w_{i}=1\)</span> in equations (1, 2).</p></li>
<li><p>Linear Moving Average (LMA) - the weights change, putting more relevance to the prices closer to the current price such that <span class="math notranslate nohighlight">\(w_{i}= n-i\)</span></p></li>
<li><p>Exponential Moving Average (EMA) - similar to LMA, bigger weights are assigned to more recent prices and the weights drop exponentially. There are several ways proposed to compute the weights in EMA. We will discuss here the general formulation of EMA given as:</p></li>
</ol>
<p><span class="math notranslate nohighlight">\(EMA(n) = \frac{2}{n+1}P_{t} + (1- \frac{2}{n+1}) P_{t-1}\)</span></p>
<p>Using these tools, if the current price is higher that a moving average over past <span class="math notranslate nohighlight">\(n\)</span> periods, the signal is “buy”.</p>
<p>Momentum on the other hand, in its simplest form, is just the difference in the current price and the price <span class="math notranslate nohighlight">\(n\)</span> days ago. In other definitiions it can also be a change in the simple moving average with a scale factor of <span class="math notranslate nohighlight">\(N+1\)</span>:</p>
<p><span class="math notranslate nohighlight">\(\frac{MOM}{N+1} = SMA_{today}- SMA_{yesterday}\)</span></p>
<p>In trading, the indicators for both tools is given as:</p>
<ol class="simple">
<li><p>Moving average:
<span class="math notranslate nohighlight">\(I_{t}(n) = P_{t}- MA_{n}\)</span></p></li>
<li><p>Momentum
<span class="math notranslate nohighlight">\(I_{t}(n) = P_{t}-P_{t-n+1}\)</span></p></li>
</ol>
<p>The trader is suggested to buy if <span class="math notranslate nohighlight">\(I&gt;0\)</span> and sell otherwise.</p>
<p>To understand these concepts in financial analysis more in depth, we will look at various examples in trading. But first, we will demonstrate using the climate data that MA trends are also used in smooting time series data. After which, we will proceed with the examples on stock price analysis.</p>
</div>
<div class="section" id="example-5-extracting-the-trend-in-climate-data-using-ma">
<h3>Example 5: Extracting the Trend in Climate Data Using MA<a class="headerlink" href="#example-5-extracting-the-trend-in-climate-data-using-ma" title="Permalink to this headline">¶</a></h3>
<p>First, let us try to apply MA to see a smoother trend of the temperature measurements in the climate data. Here, we will use the simple MA and the exponential MA.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3420 data is equivalent to 1 month while 83220 is equivalent to two years, 124830 for 3 years</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;MA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">6840</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;EMA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="mi">3420</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span> <span class="s1">&#39;Temp&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;MA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span> <span class="s1">&#39;6840MA&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;EMA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span> <span class="s1">&#39;3420EMA&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">83220</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fbc6aea7410&gt;
</pre></div>
</div>
<img alt="../_images/02_LinearTrendandMomentumForecasting_105_1.png" src="../_images/02_LinearTrendandMomentumForecasting_105_1.png" />
</div>
</div>
<p>Looking at our data, we can see that there is an apparent seasonal trend of temperature measurements and at this point, we might be interested to know which among the factors in the data are causing this trend in temperature. This concept is called causation and it will be discussed at a later chapter in this book.</p>
</div>
<div class="section" id="momentum-strategies">
<h3>Momentum Strategies<a class="headerlink" href="#momentum-strategies" title="Permalink to this headline">¶</a></h3>
<p>Momentum is used as a measure of strength of the current or future trend regardless of the direction, i.e., whether it will go up or down. It is purely a technical analysis technique and does not consider the fundamentals of the company. Traders use momentum strategy for short-term, when the trends are strong or when the price action momentum is high. An indicator of high momentum is the price advancing or declining over a wide range in a short period of time. High levels of momentum indicates increased volatility, too.</p>
<p>Momentum investors tries to understand and anticipate the behavior of the market, since awareness of the biases and emotions of other investors make the momentum investing strategy to work better.</p>
<div class="section" id="how-to-apply-momentum-strategy">
<h4>How to apply momentum strategy:<a class="headerlink" href="#how-to-apply-momentum-strategy" title="Permalink to this headline">¶</a></h4>
<ol class="simple">
<li><p>A trader checks the existence of trends using indicators such as trend lines, moving averages, and  ADX to identify the existence of a trend.</p></li>
<li><p>As the trend gains momentum – strengthens – the trader decides what position to take following the direction of the trend (buy an uptrend; sell a downtrend).</p></li>
<li><p>A trader exits when the momentum of the trend shows signs of weakening. Divergence between price action and the movement of momentum indicators such as the MACD or RSI is a usual indicator.</p></li>
</ol>
</div>
</div>
<div class="section" id="example-6-momentum-trading-strategy-using-two-ma-s">
<h3>Example 6: Momentum Trading Strategy Using Two MA’s<a class="headerlink" href="#example-6-momentum-trading-strategy-using-two-ma-s" title="Permalink to this headline">¶</a></h3>
<p>As mentioned above, momentum strategy can be applied after checking for trends using moving averages. SMA and EMA are widely used in technical analysis of stock prices and in generating buy/sell signals. The basic idea is to use two different windows (short and long observation window) and see where the two MA’s cross over. A shorter window reacts faster to price changes than a longer window. Thus if MA(n=short) &gt; MA(n=long), the trading strategy or signal is to buy. Otherwise, the signal is to sell.</p>
<p>SMA works fine in technical analysis however, it’s behavior lags the current price by <span class="math notranslate nohighlight">\(n/2\)</span> days. This means that the changes in the trend can only be seen after the lag days making the strategy being delayed. EMA reduces this lag significantly as weights are decaying exponentially. The same strategy of looking for crossovers between two EMAs with short and long window of observation is always applied, i.e., a signal to buy is generated when the EMA with shorter window crosses above the EMA with longer observation window.</p>
<p>Now let us demonstrate this idea using the Netflix data on how to use MA and EMA in making signals or decisions whether to buy or sell the stock.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Recall Netflix data we used above in forecasting using linear regression (LR)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">price</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Price&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Price&#39;)
</pre></div>
</div>
<img alt="../_images/02_LinearTrendandMomentumForecasting_109_1.png" src="../_images/02_LinearTrendandMomentumForecasting_109_1.png" />
</div>
</div>
<p>We will use window size of n=25 for the short MA and n=65 for the long MA.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## In pandas, the rolling windows is available in computing for the mean of a window sized-n. </span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;20MA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;65MA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">65</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We will try to locate the crossover of the two MAs and create an ‘indicator’ of crossover. Note that this indicator is not exactly the same as the indicator “I” discussed above. Afterwhich, we will create our strategy based on the generated indicators.. The strategy is based on the movement of price.</p>
<p>If MA20&gt; MA65, we have indicator equal to +1.0, otherwise indicator equal to 0.0. Once there is a crossover, there is a reversal of the positions of MA20 and MA65. Thus getting the difference between the indicators (<span class="math notranslate nohighlight">\(I_{diff} = I_{t} - I{t-1}\)</span>) for two consecutive times will tell us if the reversal is positive (buy) or negative (sell).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Indicator&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;Indicator&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;20MA&#39;</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;65MA&#39;</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

<span class="c1"># To get the difference of the indicators, we use function diff in pandas.</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;Indicator&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
<span class="c1"># print(price)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Decision=+1 means buy, while Decision=-1 means sell</span>
<span class="c1"># plotting them all together </span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span> <span class="s1">&#39;Close&#39;</span><span class="p">)</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;20MA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;20MA&#39;</span><span class="p">)</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;65MA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;65MA&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;20MA&#39;</span><span class="p">][</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;buy&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;20MA&#39;</span><span class="p">][</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>  <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;sell&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fbc5080bf90&gt;
</pre></div>
</div>
<img alt="../_images/02_LinearTrendandMomentumForecasting_114_1.png" src="../_images/02_LinearTrendandMomentumForecasting_114_1.png" />
</div>
</div>
<p>Using two MA’s and getting their crossover or difference as indicator, we can decide whether to buy (green) the stock or sell (red). We can do the same process we did above using EMA.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># In pandas, the rolling window equivalent for EMA is </span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;20EMA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;65EMA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="mi">65</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Like how we used MA above, we will try to locate the crossover of the two EMAs and create an indicator of crossover </span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;Indicator_EMA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;Indicator_EMA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;20EMA&#39;</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;65EMA&#39;</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

<span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision_EMA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;Indicator_EMA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
<span class="c1"># print(price)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Decision=+1 means buy, while Decision=-1 means sell</span>
<span class="c1"># plotting them all together </span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span> <span class="s1">&#39;Close&#39;</span><span class="p">)</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;20EMA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;20EMA&#39;</span><span class="p">)</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;65EMA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;65EMA&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision_EMA&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;20EMA&#39;</span><span class="p">][</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision_EMA&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;buy&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision_EMA&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;20EMA&#39;</span><span class="p">][</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision_EMA&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>  <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;sell&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fbc50863110&gt;
</pre></div>
</div>
<img alt="../_images/02_LinearTrendandMomentumForecasting_118_1.png" src="../_images/02_LinearTrendandMomentumForecasting_118_1.png" />
</div>
</div>
<p>For this case, the momentum indicators generally helps us generate decisions whether to buy or not. The crossover is a sign of reversal of trend. In the context of technical analysis, “To buy” predicts that the price will increase, while “To Sell” predicts that the price will decrease.</p>
<p>These tools work in general but there are more sophisticated tools that can be used in doing technical analysis.</p>
</div>
<div class="section" id="example-7-momentum-trading-strategy-using-macd">
<h3>Example 7: Momentum Trading Strategy Using MACD<a class="headerlink" href="#example-7-momentum-trading-strategy-using-macd" title="Permalink to this headline">¶</a></h3>
<p>There are many Momentum Trading Strategies that can be used. In this example, we will use the Moving Average Convergence Divergence (MACD). MACD is one of the most popular momentum indicators, which makes use of the difference between two exponential moving averages (12-day and 26-day) and compare it with EMA (9-day) of MACD.</p>
<div class="section" id="macd-indicators">
<h4>MACD Indicators<a class="headerlink" href="#macd-indicators" title="Permalink to this headline">¶</a></h4>
<ol class="simple">
<li><p>bullish crossover (buy) -  occurs when MACD crosses above the signal line.</p></li>
<li><p>bearish signal (sell) - MACD crosses below the signal line.</p></li>
<li><p>overbought or oversold - crossover has a high sloping MACD, depending on if the crossover is bullish or bearish respectively. A correction or reversal of direction will soon follow.</p></li>
<li><p>on movement - weak movement, indicated by the small slope of MACD has a high chance to correct while a strong movement highly probable to continue.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;exp1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;exp2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="mi">26</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;macd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;exp1&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;exp2&#39;</span><span class="p">]</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;exp3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;macd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">price</span><span class="p">[</span><span class="s1">&#39;macd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;MACD&#39;</span><span class="p">)</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;exp3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Signal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_LinearTrendandMomentumForecasting_121_0.png" src="../_images/02_LinearTrendandMomentumForecasting_121_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Like how we used MA above, we will try to locate the crossover of the MACD and the Signal and plot the indicators </span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;Indicator_MACD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;Indicator_MACD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;macd&#39;</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;exp3&#39;</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

<span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision_MACD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;Indicator_MACD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
<span class="c1"># print(price)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;macd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;MACD&#39;</span><span class="p">)</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;exp3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Signal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision_MACD&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;macd&#39;</span><span class="p">][</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision_MACD&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;buy&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision_MACD&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;macd&#39;</span><span class="p">][</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision_MACD&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>  <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;sell&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fbc50c988d0&gt;
</pre></div>
</div>
<img alt="../_images/02_LinearTrendandMomentumForecasting_123_1.png" src="../_images/02_LinearTrendandMomentumForecasting_123_1.png" />
</div>
</div>
<p>In the plot above, we can see the approximate dates where a bullish (buy) and bearish (sell) crossover happened. Now we want to examine the strength and identify overbought and oversold conditions. Here we use the same parameters, but we plot the original price and its MACD.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span> <span class="s1">&#39;Close&#39;</span><span class="p">)</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;macd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;MACD&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_LinearTrendandMomentumForecasting_125_0.png" src="../_images/02_LinearTrendandMomentumForecasting_125_0.png" />
</div>
</div>
<p>Here, MACD stays somehow flat but notice that there are times where the MACD curve is steeper than other times, indicative of overbought or oversold conditions (e.g. before 2020-04).  Zooming-in to the MACD plot to see the slopes, we have the ff:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Close Price&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;MACD&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Close&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;macd&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;macd&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_LinearTrendandMomentumForecasting_127_0.png" src="../_images/02_LinearTrendandMomentumForecasting_127_0.png" />
</div>
</div>
<p>From the above plots, the steep slopes of MACD happened before 2020-04 (oversold) and 2020-10 (overbought). Note that there are still some steep sloped in MACD after 2020-07 and could be indicative of other instances of overbuying and overselling.</p>
<p>Finally, as discussed above, there are other momentum indicators that are used in trading such as RSI and ADX. The reader is left to explore on them following the procedure presented in this notebook.</p>
</div>
</div>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>In this chapter we discussed and demonstrated how we can use forecasting tools such as linear, trend, and momentum. Compared to the previous chapter, we noted here that there is no need to check for the stationarity of the time series and there is no need for differencing. We also showed that linear regression (and multi-variate LR) is limited and performs poorly when applied to some data. Finally we emphasized that while other forecasting tools require the removal of trends, in this notebook we showed that trends can be utilized to predict the future direction of the data.</p>
</div>
<div class="section" id="preview-to-the-next-chapter">
<h2>Preview to the next chapter…<a class="headerlink" href="#preview-to-the-next-chapter" title="Permalink to this headline">¶</a></h2>
<p>As simple as it is, the forecasting methods discussed here are not applicable in many other cases. Following our discussion, the next chapters will provide better forecasting models. In Chapter 3, the concept of vector autoregressive model (VAR) which is pressumed to be a better tool in forecasting time series data as it can incorportate information from the previous time step of another data, will be discussed.</p>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>The discussions in this notebook were made with the help of the following references</p>
<ul class="simple">
<li><p>https://www.tandfonline.com/doi/pdf/10.1080/14697688.2020.1716057?needAccess=true</p></li>
<li><p>https://towardsdatascience.com/introduction-to-linear-regression-in-python-c12a072bedf0</p></li>
<li><p>https://ucilnica.fri.uni-lj.si/mod/resource/view.php?id=28089</p></li>
<li><p>https://otexts.com/fpp2/autocorrelation.html</p></li>
<li><p>https://www.w3schools.com/python/python_ml_multiple_regression.asp</p></li>
<li><p>https://www.analyticsvidhya.com/blog/2016/02/time-series-forecasting-codes-python/</p></li>
<li><p>https://towardsdatascience.com/making-a-trade-call-using-simple-moving-average-sma-crossover-strategy-python-implementation-29963326da7a</p></li>
<li><p>https://www.investopedia.com/articles/trading/09/linear-regression-time-price.asp</p></li>
<li><p>https://medium.com/&#64;harishreddyp98/regularization-in-python-699cfbad8622</p></li>
<li><p>https://stackabuse.com/linear-regression-in-python-with-scikit-learn/</p></li>
<li><p>https://corporatefinanceinstitute.com/resources/knowledge/trading-investing/momentum-investing/</p></li>
</ul>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./02_LinearForecastingTrendandMomentumForecasting"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="../01_AutoRegressiveIntegratedMovingAverage/01_AutoRegressiveIntegratedMovingAverage.html" title="previous page">Chapter 1: AutoRegressive Integrated Moving Average (ARIMA)</a>
    <a class='right-next' id="next-link" href="../03_VectorAutoregressiveModels/03_VectorAutoregressiveMethods.html" title="next page">Chapter 3: Vector Autoregressive Methods</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By students of PhD in Data Science Batch 2023 at the Asian Institute of Management<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>