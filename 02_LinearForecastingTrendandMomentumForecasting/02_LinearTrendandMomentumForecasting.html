
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Chapter 2: Linear, Trend, and Momentum Forecasting &#8212; Time Series Analysis Handbook</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/togglebutton.js"></script>
    <script type="text/javascript" src="../_static/clipboard.min.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <script type="text/javascript">var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script type="text/javascript" src="../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" type="text/javascript" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script type="text/javascript">
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" type="text/javascript" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Chapter 3: Vector Autoregressive Methods" href="../03_VectorAutoregressiveModels/03_VectorAutoregressiveMethods.html" />
    <link rel="prev" title="Chapter 1: AutoRegressive Integrated Moving Average (ARIMA)" href="../01_AutoRegressiveIntegratedMovingAverage/01_AutoRegressiveIntegratedMovingAverage.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  
  <h1 class="site-logo" id="site-title">Time Series Analysis Handbook</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../00_Preface/Preface_AdvancedTimeSeriesAnalysis.html">
   Preface: Advanced Time Series Analysis
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../01_AutoRegressiveIntegratedMovingAverage/01_AutoRegressiveIntegratedMovingAverage.html">
   Chapter 1: AutoRegressive Integrated Moving Average (ARIMA)
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Chapter 2: Linear, Trend, and Momentum Forecasting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../03_VectorAutoregressiveModels/03_VectorAutoregressiveMethods.html">
   Chapter 3: Vector Autoregressive Methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../04_GrangerCausality/04_GrangerCausality.html">
   Chapter 4: Granger Causality Test
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../05_SimplexandSmapProjections/Chapter 5 - Empirical Dynamic Modelling (Simplex and SMap_Projections).html">
   Chapter 5: Dynamical Forecasting Methods (Simplex and SMap Projections)
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../06_ConvergentCrossMappingandSugiharaCausality/ccm_sugihara.html">
   Chapter 6: Convergent Cross Mapping / Sugihara Causality
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../06_ConvergentCrossMappingandSugiharaCausality/using_causal_ccm_package.html">
     Applying CCM Using causal-ccm package
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../07_CrosscorrelationsFourierTransformandWaveletTransform/07_CrosscorrelationsFourierTransformandWaveletTransform.html">
   Chapter 7: Cross-Correlations, Fourier Transform, and Wavelet Transform
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../08_WinningestMethods/lightgbm_m5_forecasting.html">
   Chapter 8: Winningest Methods in Time Series Forecasting
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../08_WinningestMethods/lightgbm_m5_tuning.html">
     Hyperparameter Tuning (Supplementary Notebook)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../08_WinningestMethods/lightgbm_jena_forecasting.html">
     Temperature Forecasting (Supplementary Notebook)
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/README.html">
   Datasets
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/02_LinearForecastingTrendandMomentumForecasting/02_LinearTrendandMomentumForecasting.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/phdinds-aim/time_series_handbook"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/phdinds-aim/time_series_handbook/issues/new?title=Issue%20on%20page%20%2F02_LinearForecastingTrendandMomentumForecasting/02_LinearTrendandMomentumForecasting.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/phdinds-aim/time_series_handbook/main?urlpath=tree/02_LinearForecastingTrendandMomentumForecasting/02_LinearTrendandMomentumForecasting.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#linear-regression-forecasting">
   Linear Regression Forecasting
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gauss-markov-assumptions">
     Gauss Markov Assumptions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#application-lr-in-stock-price">
     Application: LR in Stock Price
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#testing-for-stationarity">
     Testing for Stationarity
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#testing-for-autocorrelation">
     Testing for Autocorrelation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compare-with-model-where-x-x-t-1">
     Compare with model where
     <span class="math notranslate nohighlight">
      \(X=X_{t-1}\)
     </span>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lr-for-multivariate-regression">
   LR for Multivariate Regression
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#l1-lasso-and-l2-ridge-regularization-for-multi-variate-linear-regression">
     L1 (Lasso) and L2 (Ridge) regularization for multi-variate linear regression
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#multi-variate-linear-regression-on-climate-data">
   Multi-variate Linear Regression on Climate Data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#l2-regularization">
     L2 Regularization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#l1-regularization">
     L1 Regularization
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#momentum-and-trend-forecasting-strategies-in-stock-market">
   Momentum and Trend Forecasting Strategies in Stock Market
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#moving-average-ma">
     Moving Average MA
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extracting-the-trend-in-climate-data-using-ma">
     Extracting the Trend in Climate Data using MA
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#momentum-strategies">
     Momentum Strategies
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#momentum-trading-strategy-using-two-ma-s">
     Momentum Trading Strategy Using Two MA’s
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#other-momentum-indicators-macd">
     Other Momentum Indicators: MACD
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preview-to-the-next-chapter">
   Preview to the next chapter…
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="chapter-2-linear-trend-and-momentum-forecasting">
<h1>Chapter 2: Linear, Trend, and Momentum Forecasting<a class="headerlink" href="#chapter-2-linear-trend-and-momentum-forecasting" title="Permalink to this headline">¶</a></h1>
<p>In this chapter we introduce basic tools on forecasting, which utilize simple algebraic formula. In the previous chapter, ARIMA was discussed where the future values of a time series are forecasted using its past or lagged values. It was shown that ARIMA can only be applied after removing the trend and seasonality of the data. We note however that for some forecasting tools, the trend is relevant and is part of the formula for prediction. In this work, forecasting will be demonstrated while making use of the relationships and trends in the data.</p>
<p>In the first half of this notebook, we demonstrate forecasting by fitting time series data with linear regression. For the second half, we demonstrate that by using the trends of the time series data such as moving averages, we can predict the possible future direction of the trend using momentum forecasting.</p>
<p>Lastly, it is important to note that the concept of moving average (MA) in ARIMA is not the same in this chapter since the moving average that will be discussed is just the classical definition of MA.</p>
<p><strong>References:</strong></p>
<p>The contents of this notebook are compiled from the following references:</p>
<ol class="simple">
<li><p><a class="reference external" href="https://www.tandfonline.com/doi/pdf/10.1080/14697688.2020.1716057?needAccess=true">https://www.tandfonline.com/doi/pdf/10.1080/14697688.2020.1716057?needAccess=true</a></p></li>
<li><p><a class="reference external" href="https://towardsdatascience.com/introduction-to-linear-regression-in-python-c12a072bedf0">https://towardsdatascience.com/introduction-to-linear-regression-in-python-c12a072bedf0</a></p></li>
<li><p><a class="reference external" href="https://ucilnica.fri.uni-lj.si/mod/resource/view.php?id=28089">https://ucilnica.fri.uni-lj.si/mod/resource/view.php?id=28089</a></p></li>
<li><p><a class="reference external" href="https://otexts.com/fpp2/autocorrelation.html">https://otexts.com/fpp2/autocorrelation.html</a></p></li>
<li><p><a class="reference external" href="https://www.w3schools.com/python/python_ml_multiple_regression.asp">https://www.w3schools.com/python/python_ml_multiple_regression.asp</a></p></li>
<li><p><a class="reference external" href="https://www.analyticsvidhya.com/blog/2016/02/time-series-forecasting-codes-python/">https://www.analyticsvidhya.com/blog/2016/02/time-series-forecasting-codes-python/</a></p></li>
<li><p><a class="reference external" href="https://towardsdatascience.com/making-a-trade-call-using-simple-moving-average-sma-crossover-strategy-python-implementation-29963326da7a">https://towardsdatascience.com/making-a-trade-call-using-simple-moving-average-sma-crossover-strategy-python-implementation-29963326da7a</a></p></li>
<li><p><a class="reference external" href="https://www.investopedia.com/articles/trading/09/linear-regression-time-price.asp">https://www.investopedia.com/articles/trading/09/linear-regression-time-price.asp</a></p></li>
<li><p><a class="reference external" href="https://medium.com/&#64;harishreddyp98/regularization-in-python-699cfbad8622">https://medium.com/&#64;harishreddyp98/regularization-in-python-699cfbad8622</a></p></li>
<li><p><a class="reference external" href="https://stackabuse.com/linear-regression-in-python-with-scikit-learn/">https://stackabuse.com/linear-regression-in-python-with-scikit-learn/</a></p></li>
<li><p><a class="reference external" href="https://corporatefinanceinstitute.com/resources/knowledge/trading-investing/momentum-investing/">https://corporatefinanceinstitute.com/resources/knowledge/trading-investing/momentum-investing/</a></p></li>
</ol>
<p>Prepared by: Marissa P. Liponhay</p>
<div class="section" id="linear-regression-forecasting">
<h2>Linear Regression Forecasting<a class="headerlink" href="#linear-regression-forecasting" title="Permalink to this headline">¶</a></h2>
<p>Linear regression forecasting is used when forecasting a time series y with the assumption that it has a linear relationship with other time series x.</p>
<p>The basic equation in doing linear regression is:
<span class="math notranslate nohighlight">\(y= mx + b \)</span></p>
<p>where <span class="math notranslate nohighlight">\(m\)</span> is the slope of the linear fit and <span class="math notranslate nohighlight">\(b\)</span> is the <span class="math notranslate nohighlight">\(y\)</span> intercept which represents error in the fit. Usually in forecasting, <span class="math notranslate nohighlight">\(y\)</span> is replaced by <span class="math notranslate nohighlight">\(\hat{y}\)</span> to symbolize the forecasted value.</p>
<p>Given a data set, one can easily compute for the slope of the data manually or automatically using excel built-in trendline functions. To manually calculate <span class="math notranslate nohighlight">\(m\)</span>, the following equation is used:</p>
<p><span class="math notranslate nohighlight">\(m = {\frac{\sum\limits _{i=1} ^{n}(x_{i}-\bar{x})(y_{i}-\bar{y})}{\sum\limits _{i=1} ^{n}(x_{i}-\bar{x})^2}}\)</span></p>
<p>To automatically calculate it in excel, one only needs to place a linear ‘trendline’ into the scatter plot of the data.</p>
<p>This method is called the Ordinary least squares (OLS). A more general equation of LR using OLS is given as:</p>
<p><span class="math notranslate nohighlight">\(y= mx + b + \mu_{i}\)</span></p>
<p>where <span class="math notranslate nohighlight">\(\mu_{i}\)</span> represent the outliers or the terms that cannot fit into the regression line.</p>
<p>OLS quantifies the  evaluation of different regression lines. Using OLS, the regression line that minimizes the sum of the squares of the differences between the observed dependent variable and the predicted dependent variable is chosen as the best fit.</p>
<p>But what if there are outliers causing the best regression by OLS does not really fit the data? This leads us to check when OLS can be applied to a data set. The following are the assumptions that are necessarily met before we can apply OLS.</p>
<div class="section" id="gauss-markov-assumptions">
<h3>Gauss Markov Assumptions<a class="headerlink" href="#gauss-markov-assumptions" title="Permalink to this headline">¶</a></h3>
<p>The following assumptions for sampled data (from a population) should be met so that the parameters calculated using OLS indeed represent the best unbiased estimator of the population parameters.</p>
<ol class="simple">
<li><p>Linearity in parameters. This assumption requires that parameter <span class="math notranslate nohighlight">\(m\)</span> is linear. (Independent variable is not required to be linear).</p></li>
<li><p>Both the independent and dependent variables <span class="math notranslate nohighlight">\((x,y)\)</span> are random variables. This will result to zero autocorrelation of outlier or the residual term.</p></li>
<li><p>For multivariate regression method,there should be no perfect collinearity between multiple independent variables. To test for the presence of collinearity, <span class="math notranslate nohighlight">\(R^{2}\)</span> is good but the t-test for each variable is poor.</p></li>
<li><p>The outlier aka residual term <span class="math notranslate nohighlight">\(\mu\)</span> is endogenous, such that <span class="math notranslate nohighlight">\(cov(\mu_{i}, x_{i})=0\)</span>=0.</p></li>
<li><p>Homoscedasticity in residual term <span class="math notranslate nohighlight">\(\mu_{i}\)</span>, in other words, the variance of μᵢ is independent of xᵢ.</p></li>
<li><p>The residual term <span class="math notranslate nohighlight">\(\mu_{i}\)</span> have zero autocorrelation, i.e., <span class="math notranslate nohighlight">\(cov(\mu_{i}, \mu_{j})=0\)</span>.</p></li>
</ol>
<p>Using OLS for time series data, the samples are drawn from the same process, and we can no longer assume that the independent variable x is random variable. In this case, the assumptions (4-6) should be strictly met by all <span class="math notranslate nohighlight">\(x\)</span> at all points.</p>
</div>
<div class="section" id="application-lr-in-stock-price">
<h3>Application: LR in Stock Price<a class="headerlink" href="#application-lr-in-stock-price" title="Permalink to this headline">¶</a></h3>
<p>Linear regression is one of the most successful tools used in technical analysis of prices and is widely available as a charting tool. For the sake of demonstration, I would like to use the historical data of netflix that I downloaded from yahoo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="k">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">pandas.plotting</span> <span class="k">import</span> <span class="n">autocorrelation_plot</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics</span> <span class="k">import</span> <span class="n">tsaplots</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="k">import</span> <span class="n">r2_score</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="c1">#from sklearn.model_selection </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">price</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/NFLX3.csv&#39;</span><span class="p">,</span><span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Close&#39;</span><span class="p">],</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>
<span class="n">price</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax</span><span class="o">=</span><span class="n">price</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Price&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Daily Close Price&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_LinearTrendandMomentumForecasting_6_0.png" src="../_images/02_LinearTrendandMomentumForecasting_6_0.png" />
</div>
</div>
</div>
<div class="section" id="testing-for-stationarity">
<h3>Testing for Stationarity<a class="headerlink" href="#testing-for-stationarity" title="Permalink to this headline">¶</a></h3>
<p>One of the first steps to do when doing time series forecasting is to check the stationarity of the data, especially when there is a prominent trend. In this notebook, I will use the most widely used statistical test called the Augmented Dickey-Fuller, a unit root test. Note that a unit root test determines how strongly a time series is defined by a trend. The test uses an autoregressive model and optimizes an information criterion across different lag values.</p>
<p>Null Hypothesis (H0):</p>
<ul class="simple">
<li><p>The time series has a unit root and is non-stationary. It is time dependent.</p></li>
</ul>
<p>Alternate Hypothesis (H1):</p>
<ul class="simple">
<li><p>The time series does not have a unit root and is stationary. It is not time-dependent.</p></li>
</ul>
<p>Finally, the result of the test can be interpreted using the ADF Statistic, i.e., the ADF statistic should be lesser than the critical values for the data to be considered stationary.</p>
<p>In some references, they use p-value from the test. A p-value below a threshold (such as 5% or 1%) implies a stationary time series, otherwise the data is non-stationary.</p>
<p>p-value &lt;= 0.05: The time series is stationary.</p>
<p>p-value &gt; 0.05: The time series is non-stationary.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="k">import</span> <span class="n">adfuller</span>
<span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/NFLX3.csv&#39;</span><span class="p">,</span><span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">])</span>
<span class="c1"># series = read_csv(&#39;daily-total-female-births.csv&#39;, header=0, index_col=0, squeeze=True)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">values</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ADF Statistic: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;p-value: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Critical Values:&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="s1">: </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">d3a873a1c972</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="c1"># series = read_csv(&#39;daily-total-female-births.csv&#39;, header=0, index_col=0, squeeze=True)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">X</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">values</span>
<span class="ne">----&gt; </span><span class="mi">5</span> <span class="n">result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="k">print</span><span class="p">(</span><span class="s1">&#39;ADF Statistic: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="k">print</span><span class="p">(</span><span class="s1">&#39;p-value: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="nn">~/anaconda3/lib/python3.7/site-packages/statsmodels/tsa/stattools.py</span> in <span class="ni">adfuller</span><span class="nt">(x, maxlag, regression, autolag, store, regresults)</span>
<span class="g g-Whitespace">    </span><span class="mi">234</span>                          <span class="s1">&#39;deterministic regressors&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">235</span>     <span class="n">xdiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">236</span>     <span class="n">xdall</span> <span class="o">=</span> <span class="n">lagmat</span><span class="p">(</span><span class="n">xdiff</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">],</span> <span class="n">maxlag</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">original</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">237</span>     <span class="n">nobs</span> <span class="o">=</span> <span class="n">xdall</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">238</span> 

<span class="nn">~/anaconda3/lib/python3.7/site-packages/statsmodels/tsa/tsatools.py</span> in <span class="ni">lagmat</span><span class="nt">(x, maxlag, trim, original, use_pandas)</span>
<span class="g g-Whitespace">    </span><span class="mi">402</span>     <span class="k">if</span> <span class="n">xa</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">403</span>         <span class="n">xa</span> <span class="o">=</span> <span class="n">xa</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">]</span>
<span class="ne">--&gt; </span><span class="mi">404</span>     <span class="n">nobs</span><span class="p">,</span> <span class="n">nvar</span> <span class="o">=</span> <span class="n">xa</span><span class="o">.</span><span class="n">shape</span>
<span class="g g-Whitespace">    </span><span class="mi">405</span>     <span class="k">if</span> <span class="n">original</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;sep&#39;</span><span class="p">]:</span>
<span class="g g-Whitespace">    </span><span class="mi">406</span>         <span class="n">dropidx</span> <span class="o">=</span> <span class="n">nvar</span>

<span class="ne">ValueError</span>: too many values to unpack (expected 2)
</pre></div>
</div>
</div>
</div>
<p>Based on the results, the time series in non-stationary at all significance levels (1%,…) as the ADF Statistic is greater the the critical values.</p>
</div>
<div class="section" id="testing-for-autocorrelation">
<h3>Testing for Autocorrelation<a class="headerlink" href="#testing-for-autocorrelation" title="Permalink to this headline">¶</a></h3>
<p>The autocorrelation coefficient measures the strength of the relationship between the data and its lag. The first coefficient measures the relationship between <span class="math notranslate nohighlight">\(y_{t}\)</span> to <span class="math notranslate nohighlight">\(y_{t-1}\)</span>, while the second coefficient measures the relationship between <span class="math notranslate nohighlight">\(y_{t}\)</span> to <span class="math notranslate nohighlight">\(y_{t-2}\)</span>, and so on.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># testing autocorrelation using pandas tools.</span>
<span class="n">tsaplots</span><span class="o">.</span><span class="n">plot_acf</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_LinearTrendandMomentumForecasting_11_0.png" src="../_images/02_LinearTrendandMomentumForecasting_11_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># testing autocorrelation using pandas tools.</span>
<span class="n">autocorrelation_plot</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fbc0a66e910&gt;
</pre></div>
</div>
<img alt="../_images/02_LinearTrendandMomentumForecasting_12_1.png" src="../_images/02_LinearTrendandMomentumForecasting_12_1.png" />
</div>
</div>
<p>One can better imagine the concept of lagged autocorrelation if we make the lagged data as a moving version of the original data and look at the overlap (in this case, their autocorrelation). If the trends of the original are both goin up or down as the lagged data is moved, the correlation is positive, otherwise negative.</p>
<p>Referring back to the autocorrelation plot vs lag, the plot shows that as the lag increases, the trend decreases. The strong relationship of the data with the first 100 lags shows that <span class="math notranslate nohighlight">\(y\)</span> is not purely random as stated in the Gauss-Markov assumption. At lag of approximately equal to 120, the autocorrelation is zero and starts to be negative. This is because the trend of the lagged data becomes negative in contrast to the positive trend of the data.</p>
<p>Here we see that after approximately <span class="math notranslate nohighlight">\(y_{t-320}\)</span>, the autocorrelation is zero. This is mainly because the overlap of the lagged data and the original data is minimal as less and less data are overlapped.</p>
<p>Now assuming that 4-6 are met, I will apply linear regression to the price of NFLX to predict the prices for the next month on a daily basis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let us another variable to manipulate rather than using the original data </span>

<span class="n">window</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">price2</span> <span class="o">=</span> <span class="n">price</span><span class="p">[[</span><span class="s1">&#39;Close&#39;</span><span class="p">]]</span><span class="c1">#.iloc[:-window]</span>
<span class="c1"># price2 = price[[&#39;Close&#39;]]</span>
<span class="n">price2</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_LinearTrendandMomentumForecasting_16_0.png" src="../_images/02_LinearTrendandMomentumForecasting_16_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># With the goal of predicting the future prices daily for a month (30days), we create a variable to contain the size</span>
<span class="c1"># it will be placed at the end of a variable &#39;Prediction&#39; in the dataframe that is shifted by 30 days</span>

<span class="n">price2</span><span class="p">[</span><span class="s1">&#39;Prediction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price2</span><span class="p">[[</span><span class="s1">&#39;Close&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="n">window</span><span class="p">)</span>

<span class="n">price2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_LinearTrendandMomentumForecasting_17_0.png" src="../_images/02_LinearTrendandMomentumForecasting_17_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now I will use the original data on prices as X, the predicted data as y and use 80% of the data as training set </span>
<span class="c1"># while 20% of the data as test set and use sklearn function to train and test the data.</span>
<span class="c1"># for both variables, the last 30 values are removed.</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">price2</span><span class="p">[[</span><span class="s1">&#39;Close&#39;</span><span class="p">]])</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="o">-</span><span class="n">window</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">price2</span><span class="p">[</span><span class="s1">&#39;Prediction&#39;</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="n">window</span><span class="p">]</span>
<span class="c1">#print(y)</span>

<span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">2020</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>413
</pre></div>
</div>
</div>
</div>
<p>Now the data is ready for linear regression training and fitting using sklearn.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LinearRegression()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># checking R^2</span>
<span class="n">R_sqd</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lr confidence: &quot;</span><span class="p">,</span> <span class="n">R_sqd</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>lr confidence:  0.720499481096278
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To show the relationship of the training set and the predicted prices.. we plot the following.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x_train&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y_train&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_train</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_train</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;regression line&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fbc11e11f10&gt;
</pre></div>
</div>
<img alt="../_images/02_LinearTrendandMomentumForecasting_22_1.png" src="../_images/02_LinearTrendandMomentumForecasting_22_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># An attempt to show that the difference between the training set and the predicted values are almost Gaussian</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_train</span><span class="p">)</span><span class="o">-</span><span class="n">y_train</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">125</span><span class="p">,</span> <span class="mi">126</span><span class="p">,</span> <span class="mi">25</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_LinearTrendandMomentumForecasting_23_0.png" src="../_images/02_LinearTrendandMomentumForecasting_23_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setting the last 30 rows of the original Close price as test data </span>
<span class="c1"># to predict the next values. </span>
<span class="n">x_forecast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">price2</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Prediction&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">))[</span><span class="o">-</span><span class="n">window</span><span class="p">:]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_forecast</span><span class="p">))</span>

<span class="c1"># # we predict the closing prices...</span>
<span class="n">lr_prediction</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_forecast</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lr_prediction</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>30
30
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x_test&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y_test&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_test</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">))</span>
<span class="c1"># plt.legend()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7fbc0f7c4b20&gt;]
</pre></div>
</div>
<img alt="../_images/02_LinearTrendandMomentumForecasting_25_1.png" src="../_images/02_LinearTrendandMomentumForecasting_25_1.png" />
</div>
</div>
<p>Now, we try to plot the predicted values over the original time series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">price2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">price2</span><span class="o">.</span><span class="n">Prediction</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;y_train&#39;</span><span class="p">)</span>
<span class="n">price2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">price2</span><span class="o">.</span><span class="n">Prediction</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;y_test&#39;</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">price2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">price2</span><span class="o">.</span><span class="n">Prediction</span><span class="o">.</span><span class="n">isnull</span><span class="p">()][[</span><span class="s1">&#39;Close&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> 
          <span class="n">index</span><span class="o">=</span><span class="n">price2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">price2</span><span class="o">.</span><span class="n">Prediction</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
          <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Pred_LR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;y_pred from regression&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fbc10e5c0a0&gt;
</pre></div>
</div>
<img alt="../_images/02_LinearTrendandMomentumForecasting_27_1.png" src="../_images/02_LinearTrendandMomentumForecasting_27_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># checking R^2</span>
<span class="n">R_sqd_train</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_pred</span><span class="o">=</span><span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_train</span><span class="p">),</span> <span class="n">y_true</span><span class="o">=</span><span class="n">y_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Train set R^2: &quot;</span><span class="p">,</span> <span class="n">R_sqd_train</span><span class="p">)</span>

<span class="c1">## R^2 of the predicted vs the actual closing price...</span>
<span class="n">R_sqd_test</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_pred</span><span class="o">=</span><span class="n">lr_prediction</span><span class="p">,</span> <span class="n">y_true</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="n">window</span><span class="p">:])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test set R^2: &quot;</span><span class="p">,</span> <span class="n">R_sqd_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Train set R^2:  0.7682299277930607
Test set R^2:  0.9187750163794522
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="compare-with-model-where-x-x-t-1">
<h3>Compare with model where <span class="math notranslate nohighlight">\(X=X_{t-1}\)</span><a class="headerlink" href="#compare-with-model-where-x-x-t-1" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r2_score</span><span class="p">(</span><span class="n">price</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">price</span><span class="o">.</span><span class="n">Close</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9814904294769093
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setting the last 30 rows of the original Close price as x_forecast as test data </span>
<span class="c1"># to predict the next values. </span>
<span class="n">x_forecast2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">price2</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Prediction&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">))[</span><span class="o">-</span><span class="n">window</span><span class="p">:]</span>
<span class="c1"># print(len(x_forecast))</span>

<span class="c1"># # we predict the closing prices...</span>
<span class="n">lr_prediction2</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_forecast2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lr_prediction</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>30
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">linregress</span>
<span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r_value</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">x_forecast</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">lr_prediction2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_forecast2</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">lr_prediction2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7fbc1217c1c0&gt;]
</pre></div>
</div>
<img alt="../_images/02_LinearTrendandMomentumForecasting_33_1.png" src="../_images/02_LinearTrendandMomentumForecasting_33_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_forecast2</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([469.959991, 487.350006, 491.170013, 470.609985, 473.079987,
       482.880005, 490.649994, 493.480011, 500.029999, 527.51001 ,
       503.059998, 520.650024, 505.869995, 534.659973, 531.789978,
       539.440002, 539.809998, 554.090027, 541.450012, 541.940002,
       530.789978, 530.719971, 525.419983, 489.049988, 485.230011,
       488.279999, 488.23999 , 488.929993, 486.23999 , 504.209991])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lr_prediction2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([477.67525528, 494.71929127, 498.46329821, 478.31231748,
       480.73317812, 490.33822214, 497.95362512, 500.72733818,
       507.14701241, 534.08030122, 510.11672877, 527.35679648,
       512.87082012, 541.08801379, 538.27511811, 545.77294283,
       546.13557766, 560.13150166, 547.74296315, 548.22320466,
       537.29501338, 537.22639919, 532.03185587, 496.38545167,
       492.64147414, 495.63078181, 495.5915688 , 496.26784401,
       493.63135934, 511.24384235])
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="lr-for-multivariate-regression">
<h2>LR for Multivariate Regression<a class="headerlink" href="#lr-for-multivariate-regression" title="Permalink to this headline">¶</a></h2>
<p>To demonstrate LR for the case where there are more than 1 independent variable, I use a simple data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#creating dataframe for simple data on cars</span>
<span class="n">cars</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/cars.csv&#39;</span><span class="p">)</span>
<span class="n">cars</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Car</th>
      <th>Model</th>
      <th>Volume</th>
      <th>Weight</th>
      <th>CO2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Toyoty</td>
      <td>Aygo</td>
      <td>1000</td>
      <td>790</td>
      <td>99</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Mitsubishi</td>
      <td>Space Star</td>
      <td>1200</td>
      <td>1160</td>
      <td>95</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Skoda</td>
      <td>Citigo</td>
      <td>1000</td>
      <td>929</td>
      <td>95</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Fiat</td>
      <td>500</td>
      <td>900</td>
      <td>865</td>
      <td>90</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Mini</td>
      <td>Cooper</td>
      <td>1500</td>
      <td>1140</td>
      <td>105</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cars</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Volume</th>
      <th>Weight</th>
      <th>CO2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>36.000000</td>
      <td>36.000000</td>
      <td>36.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1611.111111</td>
      <td>1292.277778</td>
      <td>102.027778</td>
    </tr>
    <tr>
      <th>std</th>
      <td>388.975047</td>
      <td>242.123889</td>
      <td>7.454571</td>
    </tr>
    <tr>
      <th>min</th>
      <td>900.000000</td>
      <td>790.000000</td>
      <td>90.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1475.000000</td>
      <td>1117.250000</td>
      <td>97.750000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1600.000000</td>
      <td>1329.000000</td>
      <td>99.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>2000.000000</td>
      <td>1418.250000</td>
      <td>105.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2500.000000</td>
      <td>1746.000000</td>
      <td>120.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="k">import</span> <span class="n">LinearRegression</span>

<span class="c1"># We will model C02 emission (as y variable) using the parameters volume and weight as predictors (x variable)</span>
<span class="c1"># for a multi-variate linear regression</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Volume&#39;</span><span class="p">,</span> <span class="s1">&#39;Weight&#39;</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">cars</span><span class="p">[</span><span class="n">params</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">cars</span><span class="p">[</span><span class="s1">&#39;CO2&#39;</span><span class="p">]</span>

<span class="c1"># Using scikitlearn function, train and fit the model</span>
<span class="n">lrm</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">lrm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1">#coefficients of Linear regression model are:</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">intercept_</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">coef_</span>

<span class="c1"># Multivariate LR equation: y = m1x1 + m2x2 +b</span>
<span class="c1"># print(&#39;y=&#39;, m, &#39;x + &#39;, b, &#39;\n&#39;)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Our model using Multivariate Linear Regression is given by: &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CO2= &#39;</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;x1 + &#39;</span><span class="p">,</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;x2 + &#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="c1">#We want to predict CO2 emission given specific weight and volume -- both 1000</span>
<span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">([[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Our model using Multivariate Linear Regression is given by: 
CO2=  0.007805257527747122 x1 +  0.007550947270300685 x2 +  79.6947192911594
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([95.05092409])
</pre></div>
</div>
</div>
</div>
<p>Interpretation of coefficients:</p>
<p>The slope for volume and weight of the cars are equal to 0.00781 and 0.00755, respectively. This means that for every 1 unit change in volume (weight) of cars, the expected increase in CO2 emission is 0.00781% (0.00755%).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="k">import</span> <span class="n">metrics</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">lrm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean Absolute Error:&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean Squared Error:&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Root Mean Squared Error:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Absolute Error: 5.67040550265231
Mean Squared Error: 40.86282453680151
Root Mean Squared Error: 6.392403658781375
</pre></div>
</div>
</div>
</div>
<p>Interpretation of metrics:</p>
<p>We can see that the value of root mean squared error is 6.392403658781375, which is less than 6% of the mean value of the CO2 emission. This means that our prediction is good.</p>
<p>For multi-variate linear regression, sometimes we do not know which among the parameters are relevant to the prediction. Thus in order to make our predictions more accurate, we need to penalize the less relevant parameters (or basically decrease their effect on our predictions and at times, let them approach zero). This is usually done using the concepts of regularization.</p>
<div class="section" id="l1-lasso-and-l2-ridge-regularization-for-multi-variate-linear-regression">
<h3>L1 (Lasso) and L2 (Ridge) regularization for multi-variate linear regression<a class="headerlink" href="#l1-lasso-and-l2-ridge-regularization-for-multi-variate-linear-regression" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>proper contraining the allowed values of variables will increase the accuracy</p></li>
</ul>
<p>Lasso Regularization</p>
<ul class="simple">
<li><p>put constraints on the absolute value of the coefficients</p></li>
</ul>
<p>Ridge Regularization</p>
<ul class="simple">
<li><p>put contraints on the square of the coefficients</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ridge Regularization... alpha=0 is equivalent to linear regression</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="k">import</span> <span class="n">Ridge</span>
<span class="n">ridgereg</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model2</span> <span class="o">=</span> <span class="n">ridgereg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1">#coefficients of Linear regression model are:</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">model2</span><span class="o">.</span><span class="n">intercept_</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">model2</span><span class="o">.</span><span class="n">coef_</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Our model using Multivariate L2 Linear Regression is given by: &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CO2= &#39;</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;x1 + &#39;</span><span class="p">,</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;x2 + &#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Our model using Multivariate L2 Linear Regression is given by: 
CO2=  0.007019810017740837 x1 +  0.007728894654883425 x2 +  80.73020505101513
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="k">import</span> <span class="n">metrics</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">ridgereg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean Absolute Error:&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean Squared Error:&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Root Mean Squared Error:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Absolute Error: 5.610220319986732
Mean Squared Error: 41.142435087764326
Root Mean Squared Error: 6.414236906114735
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lasso Regularization... alpha=0 is equivalent to linear regression</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="k">import</span> <span class="n">Lasso</span>
<span class="n">lassoreg</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model3</span> <span class="o">=</span> <span class="n">lassoreg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>


<span class="c1">#coefficients of Linear regression model are:</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">model3</span><span class="o">.</span><span class="n">intercept_</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">model3</span><span class="o">.</span><span class="n">coef_</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Our model using Multivariate L2 Linear Regression is given by: &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CO2= &#39;</span><span class="p">,</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;x1 + &#39;</span><span class="p">,</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;x2 + &#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Our model using Multivariate L2 Linear Regression is given by: 
CO2=  0.007716758354774066 x1 +  0.007406759259298172 x2 +  80.02363225450095
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">lassoreg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean Absolute Error:&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean Squared Error:&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Root Mean Squared Error:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Absolute Error: 5.65574080048904
Mean Squared Error: 40.92513568631857
Root Mean Squared Error: 6.397275645641555
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="multi-variate-linear-regression-on-climate-data">
<h2>Multi-variate Linear Regression on Climate Data<a class="headerlink" href="#multi-variate-linear-regression-on-climate-data" title="Permalink to this headline">¶</a></h2>
<p>In this section, we use the climate data to demonstrate forecasting using linear regression and regularization…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/jena_climate_2009_2016.csv&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date Time</th>
      <th>p (mbar)</th>
      <th>T (degC)</th>
      <th>Tpot (K)</th>
      <th>Tdew (degC)</th>
      <th>rh (%)</th>
      <th>VPmax (mbar)</th>
      <th>VPact (mbar)</th>
      <th>VPdef (mbar)</th>
      <th>sh (g/kg)</th>
      <th>H2OC (mmol/mol)</th>
      <th>rho (g/m**3)</th>
      <th>wv (m/s)</th>
      <th>max. wv (m/s)</th>
      <th>wd (deg)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01.01.2009 00:10:00</td>
      <td>996.52</td>
      <td>-8.02</td>
      <td>265.40</td>
      <td>-8.90</td>
      <td>93.3</td>
      <td>3.33</td>
      <td>3.11</td>
      <td>0.22</td>
      <td>1.94</td>
      <td>3.12</td>
      <td>1307.75</td>
      <td>1.03</td>
      <td>1.75</td>
      <td>152.3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>01.01.2009 00:20:00</td>
      <td>996.57</td>
      <td>-8.41</td>
      <td>265.01</td>
      <td>-9.28</td>
      <td>93.4</td>
      <td>3.23</td>
      <td>3.02</td>
      <td>0.21</td>
      <td>1.89</td>
      <td>3.03</td>
      <td>1309.80</td>
      <td>0.72</td>
      <td>1.50</td>
      <td>136.1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>01.01.2009 00:30:00</td>
      <td>996.53</td>
      <td>-8.51</td>
      <td>264.91</td>
      <td>-9.31</td>
      <td>93.9</td>
      <td>3.21</td>
      <td>3.01</td>
      <td>0.20</td>
      <td>1.88</td>
      <td>3.02</td>
      <td>1310.24</td>
      <td>0.19</td>
      <td>0.63</td>
      <td>171.6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>01.01.2009 00:40:00</td>
      <td>996.51</td>
      <td>-8.31</td>
      <td>265.12</td>
      <td>-9.07</td>
      <td>94.2</td>
      <td>3.26</td>
      <td>3.07</td>
      <td>0.19</td>
      <td>1.92</td>
      <td>3.08</td>
      <td>1309.19</td>
      <td>0.34</td>
      <td>0.50</td>
      <td>198.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>01.01.2009 00:50:00</td>
      <td>996.51</td>
      <td>-8.27</td>
      <td>265.15</td>
      <td>-9.04</td>
      <td>94.1</td>
      <td>3.27</td>
      <td>3.08</td>
      <td>0.19</td>
      <td>1.92</td>
      <td>3.09</td>
      <td>1309.00</td>
      <td>0.32</td>
      <td>0.63</td>
      <td>214.3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>p (mbar)</th>
      <th>T (degC)</th>
      <th>Tpot (K)</th>
      <th>Tdew (degC)</th>
      <th>rh (%)</th>
      <th>VPmax (mbar)</th>
      <th>VPact (mbar)</th>
      <th>VPdef (mbar)</th>
      <th>sh (g/kg)</th>
      <th>H2OC (mmol/mol)</th>
      <th>rho (g/m**3)</th>
      <th>wv (m/s)</th>
      <th>max. wv (m/s)</th>
      <th>wd (deg)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>420551.000000</td>
      <td>420551.000000</td>
      <td>420551.000000</td>
      <td>420551.000000</td>
      <td>420551.000000</td>
      <td>420551.000000</td>
      <td>420551.000000</td>
      <td>420551.000000</td>
      <td>420551.000000</td>
      <td>420551.000000</td>
      <td>420551.000000</td>
      <td>420551.000000</td>
      <td>420551.000000</td>
      <td>420551.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>989.212776</td>
      <td>9.450147</td>
      <td>283.492743</td>
      <td>4.955854</td>
      <td>76.008259</td>
      <td>13.576251</td>
      <td>9.533756</td>
      <td>4.042412</td>
      <td>6.022408</td>
      <td>9.640223</td>
      <td>1216.062748</td>
      <td>1.702224</td>
      <td>3.056555</td>
      <td>174.743738</td>
    </tr>
    <tr>
      <th>std</th>
      <td>8.358481</td>
      <td>8.423365</td>
      <td>8.504471</td>
      <td>6.730674</td>
      <td>16.476175</td>
      <td>7.739020</td>
      <td>4.184164</td>
      <td>4.896851</td>
      <td>2.656139</td>
      <td>4.235395</td>
      <td>39.975208</td>
      <td>65.446714</td>
      <td>69.016932</td>
      <td>86.681693</td>
    </tr>
    <tr>
      <th>min</th>
      <td>913.600000</td>
      <td>-23.010000</td>
      <td>250.600000</td>
      <td>-25.010000</td>
      <td>12.950000</td>
      <td>0.950000</td>
      <td>0.790000</td>
      <td>0.000000</td>
      <td>0.500000</td>
      <td>0.800000</td>
      <td>1059.450000</td>
      <td>-9999.000000</td>
      <td>-9999.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>984.200000</td>
      <td>3.360000</td>
      <td>277.430000</td>
      <td>0.240000</td>
      <td>65.210000</td>
      <td>7.780000</td>
      <td>6.210000</td>
      <td>0.870000</td>
      <td>3.920000</td>
      <td>6.290000</td>
      <td>1187.490000</td>
      <td>0.990000</td>
      <td>1.760000</td>
      <td>124.900000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>989.580000</td>
      <td>9.420000</td>
      <td>283.470000</td>
      <td>5.220000</td>
      <td>79.300000</td>
      <td>11.820000</td>
      <td>8.860000</td>
      <td>2.190000</td>
      <td>5.590000</td>
      <td>8.960000</td>
      <td>1213.790000</td>
      <td>1.760000</td>
      <td>2.960000</td>
      <td>198.100000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>994.720000</td>
      <td>15.470000</td>
      <td>289.530000</td>
      <td>10.070000</td>
      <td>89.400000</td>
      <td>17.600000</td>
      <td>12.350000</td>
      <td>5.300000</td>
      <td>7.800000</td>
      <td>12.490000</td>
      <td>1242.770000</td>
      <td>2.860000</td>
      <td>4.740000</td>
      <td>234.100000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1015.350000</td>
      <td>37.280000</td>
      <td>311.340000</td>
      <td>23.110000</td>
      <td>100.000000</td>
      <td>63.770000</td>
      <td>28.320000</td>
      <td>46.010000</td>
      <td>18.130000</td>
      <td>28.820000</td>
      <td>1393.540000</td>
      <td>28.490000</td>
      <td>23.500000</td>
      <td>360.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;p (mbar)&#39;</span><span class="p">,</span> <span class="s1">&#39;Tdew (degC)&#39;</span><span class="p">,</span> <span class="s1">&#39;H2OC (mmol/mol)&#39;</span><span class="p">,</span> <span class="s1">&#39;rh (%)&#39;</span><span class="p">]]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">2020</span><span class="p">)</span>
<span class="n">lr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LinearRegression()
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean Absolute Error:&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean Squared Error:&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Root Mean Squared Error:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Absolute Error: 0.4932830452108559
Mean Squared Error: 0.44533245141822714
Root Mean Squared Error: 0.6673323395567062
</pre></div>
</div>
</div>
</div>
<p>We can see that the value of root mean squared error is 0.6673323395567062, which is less than 1% of the mean. This means that linear regression is good for this dataset with four parameters.</p>
<div class="section" id="l2-regularization">
<h3>L2 Regularization<a class="headerlink" href="#l2-regularization" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ridge Regularization... alpha=0 is equivalent to linear regression</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="k">import</span> <span class="n">Ridge</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">2020</span><span class="p">)</span>
<span class="n">ridgereg2</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model_temp</span> <span class="o">=</span> <span class="n">ridgereg2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred2</span> <span class="o">=</span> <span class="n">ridgereg2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean Absolute Error:&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean Squared Error:&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Root Mean Squared Error:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred2</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Absolute Error: 0.5059669706097649
Mean Squared Error: 0.4901795271214341
Root Mean Squared Error: 0.7001282219146961
</pre></div>
</div>
</div>
</div>
<p>Using L2 regularization, penalizing the other parameters didn’t lead to significant improvement in the prediction.</p>
</div>
<div class="section" id="l1-regularization">
<h3>L1 Regularization<a class="headerlink" href="#l1-regularization" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lasso Regularization... alpha=0 is equivalent to linear regression</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="k">import</span> <span class="n">Lasso</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">2020</span><span class="p">)</span>
<span class="n">lassoreg2</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model_temp2</span> <span class="o">=</span> <span class="n">lassoreg2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred3</span> <span class="o">=</span> <span class="n">lassoreg2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean Absolute Error:&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean Squared Error:&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Root Mean Squared Error:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred3</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Absolute Error: 6.873065720640884
Mean Squared Error: 71.19952837905379
Root Mean Squared Error: 8.437981297624082
</pre></div>
</div>
</div>
</div>
<p>L1 Regularization has the worst performance having large errors, based on the metrics.</p>
</div>
</div>
<div class="section" id="momentum-and-trend-forecasting-strategies-in-stock-market">
<h2>Momentum and Trend Forecasting Strategies in Stock Market<a class="headerlink" href="#momentum-and-trend-forecasting-strategies-in-stock-market" title="Permalink to this headline">¶</a></h2>
<p>Now let us move to common tools in forecasting. I will discuss by considering its application in technical analysis in stock trading. The most common used tools are</p>
<ol class="simple">
<li><p>Moving Average</p></li>
<li><p>Momentum</p></li>
</ol>
<div class="section" id="moving-average-ma">
<h3>Moving Average MA<a class="headerlink" href="#moving-average-ma" title="Permalink to this headline">¶</a></h3>
<p>MA trading rule is the most popular trading tool for traders. The trading signal or indicator is normally derived by first computing for the average closing price over a window of size <span class="math notranslate nohighlight">\(n\)</span>, with the following formula:</p>
<p><span class="math notranslate nohighlight">\(MA_{n}(t) = \frac{w_{0}P_{t}+ w_{1}P_{t-1}+ w_{2}P_{t-2}+...+ w_{n-1}P_{t-n+1}}{w_{0}+ w_{1}+ w_{2}+... + w_{n-1}}\)</span> (1)</p>
<p><span class="math notranslate nohighlight">\(MA_{n}(t) = \frac{\sum\limits _{i=0} ^{n-1} w_{i}P_{t-i}}{\sum\limits _{i=0} ^{n-1} w_{i}}\)</span> (2)</p>
<p>There are three types of MA and they are as follows:</p>
<ol class="simple">
<li><p>Simple Moving Average (SMA) - for this case, all prices are weighted equally such that <span class="math notranslate nohighlight">\(w_{i}=1\)</span> in equations (1, 2).</p></li>
<li><p>Linear Moving Average (LMA) - for this case, the weights change putting more relevance to the prices closer to the current price such that <span class="math notranslate nohighlight">\(w_{i}= n-i\)</span></p></li>
<li><p>Exponential Moving Average (EMA) - similar to LMA, bigger weights are assigned to more recent prices and the weights drop exponentially. There are several ways proposed to compute the weights in EMA. I will discuss here the general formulation of EMA given as:</p></li>
</ol>
<p><span class="math notranslate nohighlight">\(EMA(n) = \frac{2}{n+1}P_{t} + (1- \frac{2}{n+1}) P_{t-1}\)</span></p>
<p>Using these tools, if the current price is higher that a moving average over past <span class="math notranslate nohighlight">\(n\)</span> periods, the signal is buy.</p>
<p>Momentum on the other hand, in its simplest form, is just the difference in the current price and the price <span class="math notranslate nohighlight">\(n\)</span> days ago. In other definitiions it can also be a change in the simple moving average with a scale factor of <span class="math notranslate nohighlight">\(N+1\)</span>:</p>
<p><span class="math notranslate nohighlight">\(\frac{MOM}{N+1} = SMA_{today}- SMA_{yesterday}\)</span></p>
<p>In trading, the indicators for both tools is given as:</p>
<ol class="simple">
<li><p>Moving average:
<span class="math notranslate nohighlight">\(I_{t}(n) = P_{t}- MA_{n}\)</span></p></li>
<li><p>Momentum
<span class="math notranslate nohighlight">\(I_{t}(n) = P_{t}-P_{t-n+1}\)</span></p></li>
</ol>
<p>The trader is suggested to buy if <span class="math notranslate nohighlight">\(I&gt;0\)</span> and sell otherwise.</p>
</div>
<div class="section" id="extracting-the-trend-in-climate-data-using-ma">
<h3>Extracting the Trend in Climate Data using MA<a class="headerlink" href="#extracting-the-trend-in-climate-data-using-ma" title="Permalink to this headline">¶</a></h3>
<p>Let us try to apply MA to see the trend of the temperature measurements in the climate data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3420 data is equivalent to 1 month while 83220 is equivalent to two years, 124830 for 3 years</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;MA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">6840</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;EMA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="mi">3420</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">data</span><span class="p">[</span><span class="s1">&#39;T (degC)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span> <span class="s1">&#39;Temp&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;MA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span> <span class="s1">&#39;6840MA&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;EMA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span> <span class="s1">&#39;3420EMA&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">83220</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fbc121929d0&gt;
</pre></div>
</div>
<img alt="../_images/02_LinearTrendandMomentumForecasting_66_1.png" src="../_images/02_LinearTrendandMomentumForecasting_66_1.png" />
</div>
</div>
<p>Indeed there is a seasonal trend of temperature measurements and at this point, we might be interested to know which among the factors in the data are causing this trend in temperature. This concept is called causation and it will be discussed at a later chapter.</p>
</div>
<div class="section" id="momentum-strategies">
<h3>Momentum Strategies<a class="headerlink" href="#momentum-strategies" title="Permalink to this headline">¶</a></h3>
<p>Momentum is used as a measure of strength of the current or future trend regardless of the direction, i.e., whether it will go up or down. It is purely a technical analysis technique and does not consider the fundamentals of the company. Traders use momentum strategy for short-term, when the trends are strong or when the price action momentum is high. An indicator of high momentum is the price advancing or declining over a wide range in a short period of time. High levels of momentum indicates increased volatility, too.</p>
<p>Momentum investors tries to understand and anticipate the behavior of the market, since awareness of the biases and emotions of other investors make the momentum investing strategy to work better.</p>
<p>Momentum strategy:</p>
<ol class="simple">
<li><p>A trader checks the existence of trends using indicators such as trend lines, moving averages, and  ADX to identify the existence of a trend.</p></li>
<li><p>As the trend gains momentum – strengthens – the trader decides what position to take following the direction of the trend (buy an uptrend; sell a downtrend).</p></li>
<li><p>A trader exits when the momentum of the trend shows signs of weakening. Divergence between price action and the movement of momentum indicators such as the MACD or RSI is a usual indicator.</p></li>
</ol>
</div>
<div class="section" id="momentum-trading-strategy-using-two-ma-s">
<h3>Momentum Trading Strategy Using Two MA’s<a class="headerlink" href="#momentum-trading-strategy-using-two-ma-s" title="Permalink to this headline">¶</a></h3>
<p>As mentioned above, momentum strategy can be applied after checking for trends using moving averages. SMA and EMA are widely used in technical analysis of stock prices and in generating buy/sell signals. The basic idea is to use two different windows (short and long observation window) and see where the two MA’s cross over. A shorter window reacts faster to price changes than a longer window. Thus if MA(n=short) &gt; MA(n=long), the trading strategy or signal is to buy. Otherwise, the signal is to sell.</p>
<p>SMA works fine in technical analysis however, it’s behavior lags the current price by <span class="math notranslate nohighlight">\(n/2\)</span> days. This means that the changes in the trend can only be seen after the lag days making the strategy being delayed. EMA reduces this lag significantly as weights are decaying exponentially. The same strategy of looking for crossovers between two EMAs with short and long window of observation. A signal to buy/sell is generated when the EMA with shorter/longer window crosses above/below the EMA with longer observation window.</p>
<p>Now let me demonstrate using the Netflix data, how to use MA and EMA in making signals or decisions whether to buy or sell the stock.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Recall Netflix data we used above in forecasting using linear regression (LR)</span>
<span class="n">price</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Price&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Price&#39;)
</pre></div>
</div>
<img alt="../_images/02_LinearTrendandMomentumForecasting_70_1.png" src="../_images/02_LinearTrendandMomentumForecasting_70_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## In pandas, the rolling windows is available in computing for the mean of a window sized-n. </span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;20MA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;65MA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">65</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We will try to locate the crossover of the two MAs and create an ‘indicator’ of crossover. Note that this indicator is not exactly the same as the indicator I above. Afterwhich, we will create our strategy based on the generated indicators.. The strategy is based on the movement of price.</p>
<p>If MA20&gt; MA65, we have indicator equal to +1.0, otherwise indicator equal to 0.0. Once there is a crossover, there is a reversal of the positions of MA20 and MA65. Thus getting the difference between the indicators (<span class="math notranslate nohighlight">\(I_{diff} = I_{t} - I{t-1}\)</span>) for two consecutive times will tell us if the reversal is positive (buy) or negative (sell).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Indicator&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;Indicator&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;20MA&#39;</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;65MA&#39;</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

<span class="c1"># To get the difference of the indicators, we use function diff in pandas.</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;Indicator&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
<span class="c1"># print(price)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Decision=+1 means buy, while Decision=-1 means sell</span>
<span class="c1"># plotting them all together </span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span> <span class="s1">&#39;Close&#39;</span><span class="p">)</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;20MA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;20MA&#39;</span><span class="p">)</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;65MA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;65MA&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;20MA&#39;</span><span class="p">][</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;buy&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;20MA&#39;</span><span class="p">][</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>  <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;sell&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fbbf74abac0&gt;
</pre></div>
</div>
<img alt="../_images/02_LinearTrendandMomentumForecasting_74_1.png" src="../_images/02_LinearTrendandMomentumForecasting_74_1.png" />
</div>
</div>
<p>Using two MA’s and getting their crossover or difference as indicator, we can decide whether to buy (green) the stock or sell (red). We can do the same process we did above using EMA.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># In pandas, the rolling window equivalent for EMA is </span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;20EMA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;65EMA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="mi">65</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                 Close        20MA        65MA  Indicator  Decision  \
Date                                                                  
2019-01-30  340.660004  340.660004  340.660004        0.0       NaN   
2019-01-31  339.500000  340.080002  340.080002        0.0       0.0   
2019-02-01  339.850006  340.003337  340.003337        0.0       0.0   
2019-02-04  351.339996  342.837502  342.837502        0.0       0.0   
2019-02-05  355.809998  345.432001  345.432001        0.0       0.0   
...                ...         ...         ...        ...       ...   
2020-10-23  488.279999  518.695998  502.764923        1.0       0.0   
2020-10-26  488.239990  518.575497  502.884768        1.0       0.0   
2020-10-27  488.929993  518.347997  502.781384        1.0       0.0   
2020-10-28  486.239990  517.658496  502.746460        1.0       0.0   
2020-10-29  504.209991  516.493495  503.049999        1.0       0.0   

                 20EMA       65EMA  
Date                                
2019-01-30  340.660004  340.660004  
2019-01-31  340.549527  340.624852  
2019-02-01  340.482906  340.601372  
2019-02-04  341.516915  340.926785  
2019-02-05  342.878161  341.377791  
...                ...         ...  
2020-10-23  513.255302  500.243794  
2020-10-26  510.872891  499.880043  
2020-10-27  508.783091  499.548223  
2020-10-28  506.636129  499.144943  
2020-10-29  506.405069  499.298430  

[443 rows x 7 columns]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Like how we used MA above, we will try to locate the crossover of the two EMAs and create an indicator of crossover </span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;Indicator_EMA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;Indicator_EMA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;20EMA&#39;</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;65EMA&#39;</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

<span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision_EMA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;Indicator_EMA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
<span class="c1"># print(price)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Decision=+1 means buy, while Decision=-1 means sell</span>
<span class="c1"># plotting them all together </span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span> <span class="s1">&#39;Close&#39;</span><span class="p">)</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;20EMA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;20EMA&#39;</span><span class="p">)</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;65EMA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;65EMA&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision_EMA&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;20EMA&#39;</span><span class="p">][</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision_EMA&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;buy&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision_EMA&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;20EMA&#39;</span><span class="p">][</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Decision_EMA&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>  <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span> <span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;sell&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fbbf7e2cb80&gt;
</pre></div>
</div>
<img alt="../_images/02_LinearTrendandMomentumForecasting_79_1.png" src="../_images/02_LinearTrendandMomentumForecasting_79_1.png" />
</div>
</div>
<p>For this cases, the momentum indicators generally helps us generate decisions whether to buy or not. The crossover is a sign of reversal of trend. In the context of technical analysis, “To buy” predicts that the price will increase, while “To Sell” predicts that the price will decrease.</p>
<p>These tools work in general but there are more sophisticated tools that can be used in doing technical analysis.</p>
</div>
<div class="section" id="other-momentum-indicators-macd">
<h3>Other Momentum Indicators: MACD<a class="headerlink" href="#other-momentum-indicators-macd" title="Permalink to this headline">¶</a></h3>
<p>The Moving Average Convergence Divergence (MACD) is one of the most popular momentum indicators, which makes use of the difference between two exponential moving averages (12-day and 26-day) and compare it with another EMA (9-day).</p>
<ol class="simple">
<li><p>bullish crossover (buy) -  occurs when MACD crosses above the signal line.</p></li>
<li><p>bearish signal (sell) - MACD crosses below the signal line.</p></li>
<li><p>overbought or oversold - crossover has a high sloping MACD, depending on if the crossover is bullish or bearish respectively. A correction or reversal of direction will soon follow.</p></li>
<li><p>on movement - weak movement, indicated by the small slope of MACD has a high chance to correct while a strong movement highly probable to continue.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;exp1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;exp2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="mi">26</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;macd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;exp1&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;exp2&#39;</span><span class="p">]</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;exp3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span><span class="p">[</span><span class="s1">&#39;macd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">adjust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">price</span><span class="p">[</span><span class="s1">&#39;macd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;MACD&#39;</span><span class="p">)</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;exp3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Signal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_LinearTrendandMomentumForecasting_82_0.png" src="../_images/02_LinearTrendandMomentumForecasting_82_0.png" />
</div>
</div>
<p>In the plot above, we can see the dates where a bullish (or a bearish) crossover happened. Now we want to examine the strength and identify overbought and oversold conditions. Here we use the same parameters, but we plot the original price and its MACD.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span> <span class="s1">&#39;Close&#39;</span><span class="p">)</span>
<span class="n">price</span><span class="p">[</span><span class="s1">&#39;macd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;MACD&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_LinearTrendandMomentumForecasting_84_0.png" src="../_images/02_LinearTrendandMomentumForecasting_84_0.png" />
</div>
</div>
<p>Here, MACD stays somehow flat but notice that there are times where the MACD curve is steeper than other times, indicative of overbought or oversold conditions (e.g. before 2020-04).  Zooming-in to the MACD plot to see the slopes, we have the ff:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;MACD and Close&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;Close&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Close&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">price</span><span class="p">[</span><span class="s1">&#39;macd&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;macd&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02_LinearTrendandMomentumForecasting_86_0.png" src="../_images/02_LinearTrendandMomentumForecasting_86_0.png" />
</div>
</div>
<p>From the above plots, the steep slopes of MACD happened before 2020-04 (oversold) and 2020-10 (overbought). Note that there are still some steep sloped in MACD after 2020-07 and could be indicative of other instances of overbuying and overselling.</p>
<p>Finally, as discussed above, there are other momentum indicators that are used in trading such as RSI and ADX. The reader is left to explore on them following the procedure presented in this notebook.</p>
</div>
</div>
<div class="section" id="preview-to-the-next-chapter">
<h2>Preview to the next chapter…<a class="headerlink" href="#preview-to-the-next-chapter" title="Permalink to this headline">¶</a></h2>
<p>In this chapter we discussed and demonstrated how we can use forecasting tools such as linear, trend, and momentum. Compared to the previous chapter, we noted here that there is no need to check for the stationarity of the time series not for differencing. We also showed that linear regression (and multi-variate LR) is limited and performs poorly when applied to some data such as the climate data. Following this, the next chapter will introduce us to the concept of vector autoregressive model (VAR) which is pressumed to be a better tool in forecasting time series data since it can incorportate information from the previous time step of another data.</p>
<p>Finally we emphasized that while other forecasting tools require the removal of trends, in this notebook we showed that trends can be utilized to predict the future direction of the data.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./02_LinearForecastingTrendandMomentumForecasting"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="../01_AutoRegressiveIntegratedMovingAverage/01_AutoRegressiveIntegratedMovingAverage.html" title="previous page">Chapter 1: AutoRegressive Integrated Moving Average (ARIMA)</a>
    <a class='right-next' id="next-link" href="../03_VectorAutoregressiveModels/03_VectorAutoregressiveMethods.html" title="next page">Chapter 3: Vector Autoregressive Methods</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Asian Institute of Management PhD in Data Science<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>